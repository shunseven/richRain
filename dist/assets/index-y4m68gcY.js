(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();const J=e=>`data:image/svg+xml,${encodeURIComponent(e)}`;function Jt(e,t){const i=e.charAt(0);return J(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="${t}"/><circle cx="50" cy="35" r="16" fill="#fff" opacity="0.9"/><ellipse cx="50" cy="72" rx="26" ry="18" fill="#fff" opacity="0.9"/><text x="50" y="92" text-anchor="middle" font-size="14" fill="${t}" font-weight="bold" font-family="sans-serif">${i}</text></svg>`)}const oe={hongbaoyu:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="15" width="60" height="70" rx="5" fill="#e74c3c"/><rect x="20" y="40" width="60" height="10" fill="#c0392b"/><circle cx="50" cy="45" r="12" fill="#f39c12" stroke="#c0392b" stroke-width="2"/><text x="50" y="50" text-anchor="middle" font-size="12" fill="#c0392b" font-weight="bold">$</text><circle cx="30" cy="20" r="4" fill="#f39c12" opacity="0.6"/><circle cx="70" cy="10" r="3" fill="#f39c12" opacity="0.5"/><circle cx="55" cy="8" r="2" fill="#f39c12" opacity="0.4"/></svg>'),shitoujiandaobu:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="30" cy="50" r="22" fill="#e74c3c" opacity="0.8"/><path d="M22 45 L30 38 L38 45 L35 55 L25 55Z" fill="#fff"/><circle cx="70" cy="50" r="22" fill="#3498db" opacity="0.8"/><rect x="62" y="40" width="16" height="20" rx="3" fill="#fff"/><line x1="45" y1="30" x2="55" y2="70" stroke="#ffd700" stroke-width="3" stroke-dasharray="4"/></svg>'),caishuzi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="15" y="15" width="70" height="70" rx="10" fill="#9b59b6"/><text x="50" y="55" text-anchor="middle" font-size="36" fill="#fff" font-weight="bold">?</text><text x="30" y="78" text-anchor="middle" font-size="16" fill="#ffd700">1</text><text x="50" y="78" text-anchor="middle" font-size="16" fill="#ffd700">2</text><text x="70" y="78" text-anchor="middle" font-size="16" fill="#ffd700">3</text></svg>'),qiangdengzi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="25" y="40" width="50" height="35" rx="3" fill="#e67e22"/><rect x="30" y="35" width="40" height="5" rx="2" fill="#d35400"/><rect x="35" y="75" width="10" height="15" fill="#8B4513"/><rect x="55" y="75" width="10" height="15" fill="#8B4513"/><circle cx="50" cy="25" r="8" fill="#f39c12"/><line x1="50" y1="12" x2="50" y2="6" stroke="#f39c12" stroke-width="2"/><line x1="62" y1="20" x2="68" y2="16" stroke="#f39c12" stroke-width="2"/><line x1="38" y1="20" x2="32" y2="16" stroke="#f39c12" stroke-width="2"/></svg>'),jiyifanpai:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="10" y="20" width="35" height="45" rx="5" fill="#3498db"/><text x="27" y="48" text-anchor="middle" font-size="20" fill="#fff">â™ </text><rect x="55" y="20" width="35" height="45" rx="5" fill="#e74c3c"/><text x="72" y="48" text-anchor="middle" font-size="20" fill="#fff">â™¥</text><text x="50" y="85" text-anchor="middle" font-size="14" fill="#ffd700">=?</text></svg>'),bidaxiao:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="30" cy="50" r="25" fill="#2ecc71"/><text x="30" y="58" text-anchor="middle" font-size="28" fill="#fff" font-weight="bold">6</text><circle cx="70" cy="50" r="25" fill="#e74c3c"/><text x="70" y="58" text-anchor="middle" font-size="28" fill="#fff" font-weight="bold">3</text><text x="50" y="56" text-anchor="middle" font-size="20" fill="#ffd700" font-weight="bold">></text></svg>'),jieshuiguo:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="25" y="70" width="50" height="20" rx="5" fill="#8B4513"/><circle cx="35" cy="45" r="12" fill="#e74c3c"/><path d="M33 35 Q35 28 37 35" fill="#2ecc71"/><circle cx="55" cy="50" r="10" fill="#f39c12"/><circle cx="70" cy="40" r="8" fill="#9b59b6"/><path d="M40 65 L45 55" stroke="#aaa" stroke-width="1" stroke-dasharray="2"/><path d="M55" y="65 L58 58" stroke="#aaa" stroke-width="1" stroke-dasharray="2"/></svg>'),tiaosheng:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><ellipse cx="50" cy="55" rx="30" ry="35" fill="none" stroke="#e74c3c" stroke-width="3" stroke-dasharray="5"/><circle cx="50" cy="35" r="8" fill="#3498db"/><rect x="45" y="43" width="10" height="20" rx="3" fill="#3498db"/><line x1="40" y1="48" x2="35" y2="55" stroke="#3498db" stroke-width="3" stroke-linecap="round"/><line x1="60" y1="48" x2="65" y2="55" stroke="#3498db" stroke-width="3" stroke-linecap="round"/></svg>'),kuaisujisuan:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="15" width="60" height="70" rx="8" fill="#2c3e50"/><rect x="25" y="20" width="50" height="18" rx="3" fill="#2ecc71"/><text x="50" y="34" text-anchor="middle" font-size="12" fill="#fff">1+2=?</text><circle cx="35" cy="52" r="6" fill="#e74c3c"/><circle cx="50" cy="52" r="6" fill="#3498db"/><circle cx="65" cy="52" r="6" fill="#f39c12"/><circle cx="35" cy="68" r="6" fill="#9b59b6"/><circle cx="50" cy="68" r="6" fill="#1abc9c"/><circle cx="65" cy="68" r="6" fill="#e67e22"/></svg>'),caiquandashi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="#e74c3c" opacity="0.2"/><rect x="35" y="30" width="30" height="35" rx="5" fill="#f5cba7"/><rect x="35" y="55" width="8" height="15" rx="3" fill="#f5cba7"/><rect x="44" y="55" width="8" height="18" rx="3" fill="#f5cba7"/><rect x="53" y="55" width="8" height="16" rx="3" fill="#f5cba7"/><rect x="62" y="55" width="8" height="13" rx="3" fill="#f5cba7"/><text x="50" y="92" text-anchor="middle" font-size="11" fill="#ffd700" font-weight="bold">ğŸ‘ŠâœŒï¸ğŸ–ï¸</text></svg>'),chuanhua:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="25" cy="50" r="12" fill="#3498db"/><circle cx="50" cy="50" r="12" fill="#2ecc71"/><circle cx="75" cy="50" r="12" fill="#e74c3c"/><path d="M37 48 Q43 42 48 48" fill="none" stroke="#ffd700" stroke-width="2"/><polygon points="47,46 50,48 47,50" fill="#ffd700"/><path d="M62 48 Q68 42 73 48" fill="none" stroke="#ffd700" stroke-width="2"/><polygon points="72,46 75,48 72,50" fill="#ffd700"/><text x="25" y="75" text-anchor="middle" font-size="10" fill="#aaa">ğŸ—£ï¸</text></svg>'),shousubi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="30" width="60" height="40" rx="5" fill="#3498db" opacity="0.3"/><circle cx="35" cy="50" r="10" fill="#e74c3c"/><circle cx="65" cy="50" r="10" fill="#2ecc71"/><path d="M35 50 L65 50" stroke="#ffd700" stroke-width="3" stroke-dasharray="5"/><text x="50" y="48" text-anchor="middle" font-size="16" fill="#ffd700">âš¡</text><text x="35" y="80" text-anchor="middle" font-size="10" fill="#aaa">ç‚¹!</text><text x="65" y="80" text-anchor="middle" font-size="10" fill="#aaa">ç‚¹!</text></svg>')},le={xiaolingshi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="30" width="25" height="40" rx="5" fill="#e74c3c"/><rect x="55" y="35" width="25" height="35" rx="12" fill="#f39c12"/><circle cx="42" cy="25" r="8" fill="#2ecc71"/><path d="M38 20 Q42 12 46 20" fill="#2ecc71"/><text x="32" y="55" text-anchor="middle" font-size="10" fill="#fff">ç³–</text></svg>'),hongbao:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="22" y="15" width="56" height="70" rx="5" fill="#e74c3c"/><rect x="22" y="42" width="56" height="8" fill="#c0392b"/><circle cx="50" cy="46" r="14" fill="#f39c12" stroke="#c0392b" stroke-width="2"/><text x="50" y="51" text-anchor="middle" font-size="14" fill="#c0392b" font-weight="bold">ç¦</text></svg>'),xiwan:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><ellipse cx="50" cy="55" rx="30" ry="15" fill="#dfe6e9"/><ellipse cx="50" cy="55" rx="30" ry="15" fill="none" stroke="#b2bec3" stroke-width="2"/><ellipse cx="50" cy="40" rx="25" ry="12" fill="#74b9ff"/><path d="M25 55 Q25 75 50 75 Q75 75 75 55" fill="none" stroke="#b2bec3" stroke-width="2"/><circle cx="40" cy="35" r="4" fill="#fff" opacity="0.6"/><circle cx="55" cy="38" r="3" fill="#fff" opacity="0.5"/></svg>'),saodi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><line x1="50" y1="10" x2="50" y2="60" stroke="#8B4513" stroke-width="4" stroke-linecap="round"/><path d="M30 60 Q35 55 40 60 Q45 55 50 60 Q55 55 60 60 Q65 55 70 60 L70 80 Q50 85 30 80Z" fill="#f39c12"/><line x1="35" y1="65" x2="35" y2="78" stroke="#e67e22" stroke-width="1"/><line x1="45" y1="63" x2="45" y2="80" stroke="#e67e22" stroke-width="1"/><line x1="55" y1="63" x2="55" y2="80" stroke="#e67e22" stroke-width="1"/><line x1="65" y1="65" x2="65" y2="78" stroke="#e67e22" stroke-width="1"/></svg>'),tiechunlian:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="15" y="10" width="30" height="80" rx="2" fill="#e74c3c"/><rect x="55" y="10" width="30" height="80" rx="2" fill="#e74c3c"/><text x="30" y="55" text-anchor="middle" font-size="14" fill="#ffd700" font-weight="bold" writing-mode="tb">æ˜¥åˆ°ç¦æ¥</text><text x="70" y="55" text-anchor="middle" font-size="14" fill="#ffd700" font-weight="bold" writing-mode="tb">å¹´å¹´æœ‰ä½™</text></svg>'),fangbianpao:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="40" y="20" width="12" height="35" rx="3" fill="#e74c3c"/><rect x="48" y="20" width="12" height="35" rx="3" fill="#e74c3c"/><line x1="46" y1="20" x2="46" y2="10" stroke="#8B4513" stroke-width="1.5"/><line x1="54" y1="20" x2="54" y2="10" stroke="#8B4513" stroke-width="1.5"/><circle cx="50" cy="8" r="3" fill="#f39c12"/><text x="50" y="75" text-anchor="middle" font-size="10" fill="#ffd700">ğŸ’¥ç °!</text><circle cx="30" cy="30" r="4" fill="#f39c12" opacity="0.5"/><circle cx="70" cy="25" r="3" fill="#e74c3c" opacity="0.5"/><circle cx="25" cy="45" r="2" fill="#ffd700" opacity="0.4"/></svg>'),baojiaozi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><ellipse cx="50" cy="55" rx="30" ry="18" fill="#f5cba7"/><path d="M20 55 Q35 30 50 55 Q65 30 80 55" fill="none" stroke="#d4a574" stroke-width="2.5"/><circle cx="40" cy="52" r="2" fill="#e74c3c" opacity="0.5"/><circle cx="55" cy="50" r="2" fill="#2ecc71" opacity="0.5"/><path d="M25 60 Q30 65 35 60" fill="none" stroke="#d4a574" stroke-width="1.5"/><path d="M45 62 Q50 67 55 62" fill="none" stroke="#d4a574" stroke-width="1.5"/><path d="M65 60 Q70 65 75 60" fill="none" stroke="#d4a574" stroke-width="1.5"/></svg>'),bainian:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="30" r="14" fill="#f5cba7"/><rect x="38" y="44" width="24" height="30" rx="5" fill="#e74c3c"/><line x1="38" y1="55" x2="25" y2="45" stroke="#e74c3c" stroke-width="5" stroke-linecap="round"/><line x1="62" y1="55" x2="75" y2="45" stroke="#e74c3c" stroke-width="5" stroke-linecap="round"/><text x="50" y="90" text-anchor="middle" font-size="11" fill="#ffd700">æ­å–œå‘è´¢!</text></svg>'),shousui:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="45" r="30" fill="#2c3e50"/><circle cx="50" cy="45" r="27" fill="#34495e"/><line x1="50" y1="45" x2="50" y2="25" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><line x1="50" y1="45" x2="62" y2="50" stroke="#fff" stroke-width="2" stroke-linecap="round"/><circle cx="50" cy="45" r="2" fill="#e74c3c"/><text x="50" y="88" text-anchor="middle" font-size="10" fill="#ffd700">11:59 PM</text></svg>'),kanchunwan:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="15" y="20" width="70" height="50" rx="5" fill="#2c3e50"/><rect x="20" y="25" width="60" height="40" rx="2" fill="#3498db"/><rect x="35" y="72" width="30" height="5" rx="2" fill="#7f8c8d"/><rect x="30" y="77" width="40" height="3" rx="1" fill="#95a5a6"/><circle cx="50" cy="45" r="10" fill="#e74c3c" opacity="0.8"/><text x="50" y="49" text-anchor="middle" font-size="10" fill="#fff">æ˜¥</text></svg>'),chuanxinyi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M30 30 L50 25 L70 30 L70 75 L50 80 L30 75Z" fill="#e74c3c"/><path d="M30 30 L50 25 L50 35 L30 40Z" fill="#c0392b"/><path d="M70 30 L50 25 L50 35 L70 40Z" fill="#c0392b"/><line x1="50" y1="35" x2="50" y2="80" stroke="#c0392b" stroke-width="1"/><circle cx="50" cy="52" r="5" fill="#ffd700"/></svg>'),fayasuiqian:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="25" width="60" height="50" rx="5" fill="#e74c3c"/><rect x="20" y="45" width="60" height="6" fill="#c0392b"/><circle cx="50" cy="48" r="10" fill="#ffd700" stroke="#c0392b" stroke-width="2"/><text x="50" y="52" text-anchor="middle" font-size="10" fill="#c0392b" font-weight="bold">Â¥</text><circle cx="30" cy="15" r="4" fill="#ffd700" opacity="0.6"/><circle cx="70" cy="18" r="3" fill="#ffd700" opacity="0.5"/><circle cx="50" cy="12" r="2" fill="#ffd700" opacity="0.4"/></svg>')},ee={chuibei:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="60" cy="30" r="12" fill="#f5cba7"/><rect x="52" y="42" width="16" height="25" rx="4" fill="#3498db"/><circle cx="35" cy="50" r="8" fill="#f5cba7"/><path d="M35 58 L40 50 L45 58" fill="none" stroke="#e74c3c" stroke-width="2.5" stroke-linecap="round"/><circle cx="40" cy="45" r="3" fill="#ffd700" opacity="0.5"/><circle cx="38" cy="52" r="2" fill="#ffd700" opacity="0.3"/></svg>'),taohongbao:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="35" cy="35" r="12" fill="#f5cba7"/><rect x="27" y="47" width="16" height="22" rx="4" fill="#2ecc71"/><line x1="43" y1="55" x2="55" y2="45" stroke="#f5cba7" stroke-width="4" stroke-linecap="round"/><rect x="55" y="35" width="25" height="30" rx="3" fill="#e74c3c"/><circle cx="67" cy="50" r="6" fill="#ffd700"/><text x="67" y="53" text-anchor="middle" font-size="8" fill="#c0392b">$</text></svg>'),geihongbao:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="65" cy="35" r="12" fill="#f5cba7"/><rect x="57" y="47" width="16" height="22" rx="4" fill="#e74c3c"/><rect x="20" y="40" width="25" height="30" rx="3" fill="#e74c3c"/><circle cx="32" cy="55" r="6" fill="#ffd700"/><text x="32" y="58" text-anchor="middle" font-size="8" fill="#c0392b">ç¦</text><path d="M45 55 L55 50" stroke="#ffd700" stroke-width="2" stroke-dasharray="3"/><polygon points="53,47 57,50 53,53" fill="#ffd700"/></svg>'),peiliaotian:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="30" cy="50" r="12" fill="#f5cba7"/><circle cx="70" cy="50" r="12" fill="#f5cba7"/><path d="M42 40 L55 35 L55 45Z" fill="#74b9ff"/><path d="M58 55 L45 60 L45 50Z" fill="#55efc4"/><circle cx="48" cy="30" r="3" fill="#ffd700"/><circle cx="52" cy="65" r="3" fill="#ffd700"/></svg>'),duancha:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M25 45 L30 75 L70 75 L75 45Z" fill="#fff" stroke="#b2bec3" stroke-width="2"/><ellipse cx="50" cy="45" rx="25" ry="8" fill="#fff" stroke="#b2bec3" stroke-width="2"/><ellipse cx="50" cy="42" rx="18" ry="5" fill="#a8e6cf"/><path d="M75 50 Q85 50 85 60 Q85 68 75 65" fill="none" stroke="#b2bec3" stroke-width="2"/><path d="M45 35 Q43 28 48 30" fill="none" stroke="#b2bec3" stroke-width="1.5"/><path d="M52 33 Q50 25 55 28" fill="none" stroke="#b2bec3" stroke-width="1.5"/></svg>'),yiqibaojiaozi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="30" cy="30" r="10" fill="#f5cba7"/><circle cx="70" cy="30" r="10" fill="#f5cba7"/><rect x="23" y="40" width="14" height="18" rx="3" fill="#3498db"/><rect x="63" y="40" width="14" height="18" rx="3" fill="#e74c3c"/><ellipse cx="50" cy="75" rx="25" ry="12" fill="#f5cba7"/><path d="M25 75 Q37 60 50 75 Q63 60 75 75" fill="none" stroke="#d4a574" stroke-width="2"/></svg>'),jianggushi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="25" y="20" width="50" height="60" rx="3" fill="#f5cba7" stroke="#d4a574" stroke-width="2"/><rect x="28" y="23" width="8" height="57" fill="#8B4513" opacity="0.3"/><line x1="40" y1="35" x2="68" y2="35" stroke="#b2bec3" stroke-width="1.5"/><line x1="40" y1="45" x2="68" y2="45" stroke="#b2bec3" stroke-width="1.5"/><line x1="40" y1="55" x2="68" y2="55" stroke="#b2bec3" stroke-width="1.5"/><line x1="40" y1="65" x2="58" y2="65" stroke="#b2bec3" stroke-width="1.5"/></svg>'),xiaxiangqi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="15" y="15" width="70" height="70" fill="#f5cba7" stroke="#8B4513" stroke-width="2"/><line x1="15" y1="50" x2="85" y2="50" stroke="#8B4513" stroke-width="1.5"/><line x1="50" y1="15" x2="50" y2="85" stroke="#8B4513" stroke-width="1.5"/><circle cx="35" cy="35" r="12" fill="#e74c3c"/><text x="35" y="39" text-anchor="middle" font-size="12" fill="#fff" font-weight="bold">å°†</text><circle cx="65" cy="65" r="12" fill="#2c3e50"/><text x="65" y="69" text-anchor="middle" font-size="12" fill="#fff" font-weight="bold">å¸…</text></svg>'),changge:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="45" cy="60" r="15" fill="#2c3e50"/><circle cx="45" cy="60" r="5" fill="#fff"/><rect x="58" y="25" width="4" height="38" fill="#2c3e50"/><rect x="55" y="22" width="15" height="8" rx="2" fill="#2c3e50"/><circle cx="25" cy="30" r="5" fill="#ffd700" opacity="0.5"/><circle cx="72" cy="40" r="4" fill="#e74c3c" opacity="0.5"/><text x="28" y="33" text-anchor="middle" font-size="8" fill="#ffd700">â™ª</text><text x="75" y="43" text-anchor="middle" font-size="8" fill="#e74c3c">â™«</text></svg>'),tiaowu:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="22" r="10" fill="#f5cba7"/><rect x="43" y="32" width="14" height="22" rx="4" fill="#e74c3c"/><line x1="43" y1="40" x2="28" y2="30" stroke="#e74c3c" stroke-width="4" stroke-linecap="round"/><line x1="57" y1="40" x2="72" y2="28" stroke="#e74c3c" stroke-width="4" stroke-linecap="round"/><line x1="46" y1="54" x2="32" y2="78" stroke="#3498db" stroke-width="4" stroke-linecap="round"/><line x1="54" y1="54" x2="68" y2="78" stroke="#3498db" stroke-width="4" stroke-linecap="round"/><circle cx="20" cy="60" r="3" fill="#ffd700" opacity="0.4"/><circle cx="80" cy="55" r="3" fill="#ffd700" opacity="0.4"/></svg>'),caidengmi:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><ellipse cx="50" cy="45" rx="22" ry="28" fill="#e74c3c" opacity="0.8"/><rect x="42" y="15" width="16" height="8" rx="3" fill="#ffd700"/><line x1="50" y1="73" x2="50" y2="85" stroke="#ffd700" stroke-width="2"/><line x1="42" y1="80" x2="58" y2="80" stroke="#ffd700" stroke-width="1.5"/><line x1="45" y1="85" x2="55" y2="85" stroke="#ffd700" stroke-width="1.5"/><text x="50" y="50" text-anchor="middle" font-size="14" fill="#ffd700" font-weight="bold">è°œ</text></svg>'),xieshufa:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="15" width="60" height="70" fill="#f5f0e1" stroke="#8B4513" stroke-width="1.5"/><line x1="50" y1="18" x2="50" y2="82" stroke="#ddd" stroke-width="0.5" stroke-dasharray="3"/><line x1="23" y1="50" x2="77" y2="50" stroke="#ddd" stroke-width="0.5" stroke-dasharray="3"/><text x="50" y="58" text-anchor="middle" font-size="32" fill="#2c3e50" font-weight="bold" font-family="serif">ç¦</text><rect x="72" y="30" width="4" height="40" rx="2" fill="#2c3e50"/><circle cx="74" cy="28" r="2" fill="#2c3e50"/></svg>'),yiqikanchunwan:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="15" width="60" height="40" rx="4" fill="#2c3e50"/><rect x="24" y="19" width="52" height="32" rx="2" fill="#3498db"/><circle cx="30" cy="70" r="8" fill="#f5cba7"/><circle cx="50" cy="72" r="8" fill="#f5cba7"/><circle cx="70" cy="70" r="8" fill="#f5cba7"/><rect x="25" y="78" width="10" height="12" rx="3" fill="#e74c3c"/><rect x="45" y="80" width="10" height="12" rx="3" fill="#2ecc71"/><rect x="65" y="78" width="10" height="12" rx="3" fill="#9b59b6"/></svg>')},mc={finalPrize:J('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="35" width="60" height="45" rx="5" fill="#e74c3c"/><rect x="45" y="35" width="10" height="45" fill="#ffd700"/><rect x="20" y="50" width="60" height="10" fill="#ffd700" opacity="0.5"/><path d="M30 35 Q30 15 50 20 Q70 15 70 35" fill="#e74c3c"/><path d="M47 20 Q50 10 53 20" fill="#ffd700"/><circle cx="50" cy="10" r="5" fill="#ffd700"/></svg>')},Ia=["#e74c3c","#3498db","#2ecc71","#9b59b6","#e67e22","#1abc9c","#f39c12","#6c5ce7"],jr=["#636e72","#b2bec3","#00b894","#fdcb6e","#e17055","#74b9ff","#a29bfe"];let vc=Date.now();const Y=()=>`id_${vc++}`,xc=[{id:Y(),name:"çªçª",avatar:Jt("çª","#e74c3c"),color:"#e74c3c"},{id:Y(),name:"æ¶µæ¶µ",avatar:Jt("æ¶µ","#3498db"),color:"#3498db"},{id:Y(),name:"è¹è¹",avatar:Jt("è¹","#2ecc71"),color:"#2ecc71"}],wc=[{id:Y(),name:"çˆ·çˆ·",avatar:Jt("çˆ·","#636e72"),color:"#636e72"},{id:Y(),name:"å¥¶å¥¶",avatar:Jt("å¥¶","#b2bec3"),color:"#b2bec3"},{id:Y(),name:"é¡ºæ–‡",avatar:Jt("é¡º","#00b894"),color:"#00b894"},{id:Y(),name:"äº¦æ–‡",avatar:Jt("äº¦","#fdcb6e"),color:"#fdcb6e"},{id:Y(),name:"ç§‹å¹³",avatar:Jt("ç§‹","#e17055"),color:"#e17055"},{id:Y(),name:"æ·‘å¨Ÿ",avatar:Jt("æ·‘","#74b9ff"),color:"#74b9ff"},{id:Y(),name:"å¹¿æ–‡",avatar:Jt("å¹¿","#a29bfe"),color:"#a29bfe"}],bc=[{id:Y(),name:"çº¢åŒ…é›¨",icon:oe.hongbaoyu,probability:100,maxCount:1,remainingCount:1,winCondition:"æ‹¿åˆ°æœ€å¤šé’±çš„äººè·èƒœ"},{id:Y(),name:"çŸ³å¤´å‰ªåˆ€å¸ƒ",icon:oe.shitoujiandaobu,probability:50,maxCount:100,remainingCount:100,winCondition:"æœ€ç»ˆèƒœè€…è·èƒœ"},{id:Y(),name:"çŒœæ•°å­—",icon:oe.caishuzi,probability:50,maxCount:100,remainingCount:100,winCondition:"æœ€å…ˆçŒœä¸­æ•°å­—çš„äººè·èƒœ"},{id:Y(),name:"æŠ¢å‡³å­",icon:oe.qiangdengzi,probability:50,maxCount:100,remainingCount:100,winCondition:"æœ€åç•™åœ¨å‡³å­ä¸Šçš„äººè·èƒœ"},{id:Y(),name:"è®°å¿†ç¿»ç‰Œ",icon:oe.jiyifanpai,probability:50,maxCount:100,remainingCount:100,winCondition:"æ‰¾åˆ°æœ€å¤šé…å¯¹çš„äººè·èƒœ"},{id:Y(),name:"æ¯”å¤§å°",icon:oe.bidaxiao,probability:50,maxCount:100,remainingCount:100,winCondition:"æŠ½åˆ°æœ€å¤§æ•°å­—çš„äººè·èƒœ"},{id:Y(),name:"æ¥æ°´æœ",icon:oe.jieshuiguo,probability:50,maxCount:100,remainingCount:100,winCondition:"æ¥åˆ°æœ€å¤šæ°´æœçš„äººè·èƒœ"},{id:Y(),name:"è·³ç»³è®¡æ•°",icon:oe.tiaosheng,probability:50,maxCount:100,remainingCount:100,winCondition:"è·³ç»³æ¬¡æ•°æœ€å¤šçš„äººè·èƒœ"},{id:Y(),name:"å¿«é€Ÿè®¡ç®—",icon:oe.kuaisujisuan,probability:50,maxCount:100,remainingCount:100,winCondition:"æœ€å¿«ç®—å‡ºæ­£ç¡®ç­”æ¡ˆçš„äººè·èƒœ"},{id:Y(),name:"çŒœæ‹³å¤§å¸ˆ",icon:oe.caiquandashi,probability:50,maxCount:100,remainingCount:100,winCondition:"çŒœæ‹³è¿èƒœæœ€å¤šçš„äººè·èƒœ"},{id:Y(),name:"ä¼ è¯æ¸¸æˆ",icon:oe.chuanhua,probability:50,maxCount:100,remainingCount:100,winCondition:"ä¼ è¯æœ€å‡†ç¡®çš„é˜Ÿä¼è·èƒœ"},{id:Y(),name:"æ‰‹é€Ÿæ¯”æ‹¼",icon:oe.shousubi,probability:50,maxCount:100,remainingCount:100,winCondition:"ç‚¹å‡»é€Ÿåº¦æœ€å¿«çš„äººè·èƒœ"}],kc=[{id:Y(),name:"å°é›¶é£Ÿ",icon:le.xiaolingshi,type:"reward",description:"è·å¾—ç¾å‘³å°é›¶é£Ÿ"},{id:Y(),name:"çº¢åŒ…",icon:le.hongbao,type:"reward",description:"æ”¶åˆ°ä¸€ä¸ªçº¢åŒ…"},{id:Y(),name:"æ´—ç¢—ä¸€æ¬¡",icon:le.xiwan,type:"punishment",description:"éœ€è¦æ´—ç¢—ä¸€æ¬¡"},{id:Y(),name:"æ‰«åœ°ä¸€æ¬¡",icon:le.saodi,type:"punishment",description:"éœ€è¦æ‰«åœ°ä¸€æ¬¡"},{id:Y(),name:"è´´æ˜¥è”",icon:le.tiechunlian,type:"reward",description:"å¸®å¿™è´´æ˜¥è”"},{id:Y(),name:"æ”¾é­ç‚®",icon:le.fangbianpao,type:"reward",description:"æ”¾é­ç‚®åº†ç¥æ–°å¹´"},{id:Y(),name:"åŒ…é¥ºå­",icon:le.baojiaozi,type:"reward",description:"ä¸€èµ·åŒ…é¥ºå­ï¼Œå…¶ä¹èè"},{id:Y(),name:"æ‹œå¹´",icon:le.bainian,type:"reward",description:"ç»™é•¿è¾ˆæ‹œå¹´"},{id:Y(),name:"å®ˆå²",icon:le.shousui,type:"reward",description:"åšæŒå®ˆå²åˆ°å‡Œæ™¨"},{id:Y(),name:"çœ‹æ˜¥æ™š",icon:le.kanchunwan,type:"reward",description:"ä¸€èµ·çœ‹æ˜¥æ™š"},{id:Y(),name:"ç©¿æ–°è¡£",icon:le.chuanxinyi,type:"reward",description:"ç©¿ä¸Šæ–°è¡£æœçœŸå¼€å¿ƒ"},{id:Y(),name:"å‘å‹å²é’±",icon:le.fayasuiqian,type:"punishment",description:"ç»™å°æœ‹å‹å‘å‹å²é’±"}],Sc=[{id:Y(),name:"æ¶èƒŒ",icon:ee.chuibei,type:"reward",description:"å¸®é•¿è¾ˆæ¶èƒŒ"},{id:Y(),name:"è®¨çº¢åŒ…",icon:ee.taohongbao,type:"reward",description:"å‘NPCè®¨çº¢åŒ…"},{id:Y(),name:"ç»™çº¢åŒ…",icon:ee.geihongbao,type:"punishment",description:"ç»™NPCå‘çº¢åŒ…"},{id:Y(),name:"é™ªèŠå¤©",icon:ee.peiliaotian,type:"reward",description:"é™ªNPCèŠå¤©ï¼Œå¿ƒæƒ…æ„‰å¿«"},{id:Y(),name:"ç«¯èŒ¶",icon:ee.duancha,type:"reward",description:"ç»™é•¿è¾ˆç«¯èŒ¶"},{id:Y(),name:"ä¸€èµ·åŒ…é¥ºå­",icon:ee.yiqibaojiaozi,type:"reward",description:"å’ŒNPCä¸€èµ·åŒ…é¥ºå­"},{id:Y(),name:"è®²æ•…äº‹",icon:ee.jianggushi,type:"reward",description:"å¬NPCè®²æœ‰è¶£çš„æ•…äº‹"},{id:Y(),name:"ä¸‹è±¡æ£‹",icon:ee.xiaxiangqi,type:"reward",description:"å’ŒNPCä¸‹è±¡æ£‹"},{id:Y(),name:"å”±æ­Œ",icon:ee.changge,type:"reward",description:"å’ŒNPCä¸€èµ·å”±æ­Œ"},{id:Y(),name:"è·³èˆ",icon:ee.tiaowu,type:"reward",description:"å’ŒNPCä¸€èµ·è·³èˆ"},{id:Y(),name:"çŒœç¯è°œ",icon:ee.caidengmi,type:"reward",description:"çŒœå¯¹ç¯è°œ"},{id:Y(),name:"å†™ä¹¦æ³•",icon:ee.xieshufa,type:"reward",description:"å’ŒNPCä¸€èµ·å†™ä¹¦æ³•"},{id:Y(),name:"ä¸€èµ·çœ‹æ˜¥æ™š",icon:ee.yiqikanchunwan,type:"reward",description:"å’ŒNPCä¸€èµ·çœ‹æ˜¥æ™š"}],Tc={name:"æ–°æ˜¥å¤§å¥–",icon:mc.finalPrize};class Ec{constructor(){this._init()}_init(){localStorage.getItem("rr_characters")||this.saveCharacters(xc),localStorage.getItem("rr_npcs")||this.saveNpcs(wc),localStorage.getItem("rr_minigames")||this.saveMiniGames(bc),localStorage.getItem("rr_events")||this.saveEvents(kc),localStorage.getItem("rr_npcevents")||this.saveNpcEvents(Sc),localStorage.getItem("rr_finalprize")||this.saveFinalPrize(Tc)}getCharacters(){return JSON.parse(localStorage.getItem("rr_characters")||"[]")}saveCharacters(t){localStorage.setItem("rr_characters",JSON.stringify(t))}addCharacter(t){const i=this.getCharacters();return i.push({...t,id:Y()}),this.saveCharacters(i),i}updateCharacter(t,i){const s=this.getCharacters().map(r=>r.id===t?{...r,...i}:r);return this.saveCharacters(s),s}deleteCharacter(t){const i=this.getCharacters().filter(s=>s.id!==t);return this.saveCharacters(i),i}getNpcs(){return JSON.parse(localStorage.getItem("rr_npcs")||"[]")}saveNpcs(t){localStorage.setItem("rr_npcs",JSON.stringify(t))}addNpc(t){const i=this.getNpcs();return i.push({...t,id:Y()}),this.saveNpcs(i),i}updateNpc(t,i){const s=this.getNpcs().map(r=>r.id===t?{...r,...i}:r);return this.saveNpcs(s),s}deleteNpc(t){const i=this.getNpcs().filter(s=>s.id!==t);return this.saveNpcs(i),i}getMiniGames(){return JSON.parse(localStorage.getItem("rr_minigames")||"[]")}saveMiniGames(t){localStorage.setItem("rr_minigames",JSON.stringify(t))}addMiniGame(t){const i=this.getMiniGames();return i.push({...t,id:Y()}),this.saveMiniGames(i),i}updateMiniGame(t,i){const s=this.getMiniGames().map(r=>r.id===t?{...r,...i}:r);return this.saveMiniGames(s),s}deleteMiniGame(t){const i=this.getMiniGames().filter(s=>s.id!==t);return this.saveMiniGames(i),i}getEvents(){return JSON.parse(localStorage.getItem("rr_events")||"[]")}saveEvents(t){localStorage.setItem("rr_events",JSON.stringify(t))}addEvent(t){const i=this.getEvents();return i.push({...t,id:Y()}),this.saveEvents(i),i}updateEvent(t,i){const s=this.getEvents().map(r=>r.id===t?{...r,...i}:r);return this.saveEvents(s),s}deleteEvent(t){const i=this.getEvents().filter(s=>s.id!==t);return this.saveEvents(i),i}getNpcEvents(){return JSON.parse(localStorage.getItem("rr_npcevents")||"[]")}saveNpcEvents(t){localStorage.setItem("rr_npcevents",JSON.stringify(t))}addNpcEvent(t){const i=this.getNpcEvents();return i.push({...t,id:Y()}),this.saveNpcEvents(i),i}updateNpcEvent(t,i){const s=this.getNpcEvents().map(r=>r.id===t?{...r,...i}:r);return this.saveNpcEvents(s),s}deleteNpcEvent(t){const i=this.getNpcEvents().filter(s=>s.id!==t);return this.saveNpcEvents(i),i}getFinalPrize(){return JSON.parse(localStorage.getItem("rr_finalprize")||"{}")}saveFinalPrize(t){localStorage.setItem("rr_finalprize",JSON.stringify(t))}resetAll(){localStorage.removeItem("rr_characters"),localStorage.removeItem("rr_npcs"),localStorage.removeItem("rr_minigames"),localStorage.removeItem("rr_events"),localStorage.removeItem("rr_npcevents"),localStorage.removeItem("rr_finalprize"),this._init()}resetMiniGameCounts(){const t=this.getMiniGames().map(i=>({...i,remainingCount:i.maxCount}));return this.saveMiniGames(t),t}}const ot=new Ec,Cc="RichRainImages",Bc=1,es="images";let Us=null;function yh(){return Us?Promise.resolve(Us):new Promise((e,t)=>{const i=indexedDB.open(Cc,Bc);i.onupgradeneeded=s=>{const r=s.target.result;r.objectStoreNames.contains(es)||r.createObjectStore(es,{keyPath:"id"})},i.onsuccess=s=>{Us=s.target.result,e(Us)},i.onerror=s=>t(s.target.error)})}async function mh(e,t){const i=await yh();return new Promise((s,r)=>{const n=i.transaction(es,"readwrite");n.objectStore(es).put({id:e,data:t}),n.oncomplete=()=>s(e),n.onerror=a=>r(a.target.error)})}async function ka(e){const t=await yh();return new Promise((i,s)=>{const n=t.transaction(es,"readonly").objectStore(es).get(e);n.onsuccess=()=>{var a;return i(((a=n.result)==null?void 0:a.data)||null)},n.onerror=a=>s(a.target.error)})}function Sa(e){return typeof e=="string"&&e.startsWith("idb:")}function Pc(e){return e.slice(4)}async function Wt(e){if(!e)return;const t=e.querySelectorAll("img"),i=[];t.forEach(s=>{const r=s.getAttribute("src")||"";if(Sa(r)){const n=Pc(r);i.push(ka(n).then(a=>{a&&(s.src=a,s.removeAttribute("data-idb-pending"))}).catch(()=>{}))}}),i.length>0&&await Promise.all(i)}function vh(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsDataURL(e)})}let Rc=Date.now();function xh(){return`img_${Rc++}`}function Hs(e,t,i){return e.innerHTML=`
    <div class="editor-screen">
      <div class="editor-header">
        <button class="btn-back" id="btn-back">â† è¿”å›</button>
        <h2>${t}</h2>
        <button class="btn-add" id="btn-add">+ æ–°å¢</button>
      </div>
      <div class="editor-body">
        <div class="item-grid" id="item-grid"></div>
      </div>
    </div>
  `,e.querySelector("#btn-back").addEventListener("click",()=>i("menu")),{grid:e.querySelector("#item-grid"),addBtn:e.querySelector("#btn-add")}}function is(e,t,i,s,r,n){const a=document.createElement("div");a.className="modal-overlay";const o=i.map(h=>{const d=s[h.key]||h.default||"";return h.type==="select"?`<div class="form-group"><label>${h.label}</label><select name="${h.key}">${h.options.map(c=>`<option value="${c.value}" ${d===c.value?"selected":""}>${c.label}</option>`).join("")}</select></div>`:h.type==="textarea"?`<div class="form-group"><label>${h.label}</label><textarea name="${h.key}">${d}</textarea></div>`:h.type==="number"?`<div class="form-group"><label>${h.label}</label><input type="number" name="${h.key}" value="${d}" min="${h.min||0}" max="${h.max||9999}"/></div>`:h.type==="color"?`<div class="form-group"><label>${h.label}</label><div style="display:flex;gap:8px;flex-wrap:wrap">${h.colors.map(c=>`<div class="color-opt" data-color="${c}" style="width:32px;height:32px;border-radius:50%;background:${c};cursor:pointer;border:3px solid ${d===c?"#ffd700":"transparent"};transition:all 0.2s"></div>`).join("")}</div><input type="hidden" name="${h.key}" value="${d}"/></div>`:h.type==="icon-url"?`<div class="form-group"><label>${h.label}</label><div class="icon-selector"><div class="icon-preview-small" id="icon-preview-${h.key}"><img src="${d}" alt="å›¾æ ‡"/></div><input type="text" name="${h.key}" value="${d}" placeholder="è¾“å…¥å›¾ç‰‡URL æˆ–ç‚¹å‡»ä¸Šä¼ " style="flex:1"/><label class="btn-upload" for="upload-${h.key}">ğŸ“ ä¸Šä¼ </label><input type="file" id="upload-${h.key}" data-field="${h.key}" data-preview="icon-preview-${h.key}" class="file-upload-input" accept="image/*" style="display:none"/></div></div>`:h.type==="avatar-upload"?`<div class="form-group"><label>${h.label}</label><div class="avatar-upload-area"><div class="icon-preview-small" id="icon-preview-${h.key}"><img src="${d}" alt="å¤´åƒ"/></div><div class="avatar-upload-btns"><label class="btn-upload" for="upload-${h.key}">ğŸ“ ä¸Šä¼ å¤´åƒ</label><button type="button" class="btn-avatar-reset" data-field="${h.key}">ğŸ”„ æ¢å¤é»˜è®¤</button></div><input type="file" id="upload-${h.key}" data-field="${h.key}" data-preview="icon-preview-${h.key}" class="file-upload-input" accept="image/*" style="display:none"/><input type="hidden" name="${h.key}" value="${d}"/></div></div>`:`<div class="form-group"><label>${h.label}</label><input type="text" name="${h.key}" value="${d}"/></div>`}).join("");a.innerHTML=`
    <div class="modal">
      <h3>${t}</h3>
      ${o}
      <div class="form-actions">
        <button class="btn-cancel" id="modal-cancel">å–æ¶ˆ</button>
        <button class="btn-save" id="modal-save">ä¿å­˜</button>
      </div>
    </div>
  `,e.appendChild(a),a.querySelectorAll(".color-opt").forEach(h=>{h.addEventListener("click",()=>{const d=h.parentElement.parentElement.querySelector("input[type=hidden]").name;a.querySelectorAll(".color-opt").forEach(c=>c.style.border="3px solid transparent"),h.style.border="3px solid #ffd700",a.querySelector(`input[name="${d}"]`).value=h.dataset.color})}),a.querySelectorAll('.icon-selector input[type="text"]').forEach(h=>{h.addEventListener("input",()=>{const d=h.name,c=a.querySelector(`#icon-preview-${d} img`);if(c){const u=h.value;Sa(u)?ka(u.slice(4)).then(p=>{p&&(c.src=p)}):c.src=u}})}),a.querySelectorAll(".file-upload-input").forEach(h=>{h.addEventListener("change",async d=>{const c=d.target.files[0];if(c)try{const u=await vh(c),p=xh();await mh(p,u);const _=h.dataset.field,m=a.querySelector(`input[name="${_}"]`);m&&(m.value=`idb:${p}`);const v=h.dataset.preview,T=a.querySelector(`#${v} img`);T&&(T.src=u)}catch(u){console.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",u),alert("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}})}),a.querySelectorAll(".btn-avatar-reset").forEach(h=>{h.addEventListener("click",()=>{const d=h.dataset.field,c=a.querySelector(`input[name="${d}"]`);c&&(c.value="");const u=a.querySelector(`#icon-preview-${d} img`);u&&(u.src="")})}),Wt(a),a.querySelector("#modal-cancel").addEventListener("click",()=>{a.remove()}),a.querySelector("#modal-save").addEventListener("click",()=>{const h={};i.forEach(d=>{const c=a.querySelector(`[name="${d.key}"]`);c&&(h[d.key]=d.type==="number"?parseInt(c.value)||0:c.value)}),a.remove(),r(h)});const l=h=>{h.key==="Escape"&&(a.remove(),document.removeEventListener("keydown",l))};document.addEventListener("keydown",l)}function Lc(e,t){const{grid:i,addBtn:s}=Hs(e,"ğŸ‘¤ è§’è‰²ç¼–è¾‘",t);function r(){const a=ot.getCharacters();i.innerHTML=a.map(o=>`
      <div class="item-card">
        <div class="icon-preview"><img src="${o.avatar}" alt="${o.name}"/></div>
        <div class="item-name">${o.name}</div>
        <div class="item-info" style="color:${o.color}">â— ${o.color}</div>
        <div class="item-actions">
          <button class="btn-edit" data-id="${o.id}">ç¼–è¾‘</button>
          <button class="btn-delete" data-id="${o.id}">åˆ é™¤</button>
        </div>
      </div>
    `).join(""),Wt(i),i.querySelectorAll(".btn-edit").forEach(o=>{o.addEventListener("click",()=>{const l=a.find(h=>h.id===o.dataset.id);l&&n(l,h=>{(!h.avatar||!h.avatar.trim())&&(h.avatar=Jt(h.name,h.color)),ot.updateCharacter(l.id,h),r()})})}),i.querySelectorAll(".btn-delete").forEach(o=>{o.addEventListener("click",()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§’è‰²å—ï¼Ÿ")&&(ot.deleteCharacter(o.dataset.id),r())})})}function n(a={},o){is(e,a.id?"ç¼–è¾‘è§’è‰²":"æ–°å¢è§’è‰²",[{key:"name",label:"è§’è‰²åç§°",type:"text"},{key:"color",label:"è§’è‰²é¢œè‰²",type:"color",colors:Ia},{key:"avatar",label:"è‡ªå®šä¹‰å¤´åƒ (å¯é€‰ï¼Œä¸å¡«åˆ™è‡ªåŠ¨ç”Ÿæˆ)",type:"avatar-upload"}],a,o)}s.addEventListener("click",()=>{n({color:Ia[0]},a=>{if(!a.name){alert("è¯·è¾“å…¥è§’è‰²åç§°");return}(!a.avatar||!a.avatar.trim())&&(a.avatar=Jt(a.name,a.color)),ot.addCharacter(a),r()})}),r()}function Oc(e,t){const{grid:i,addBtn:s}=Hs(e,"ğŸ§“ NPCç¼–è¾‘",t);function r(){const n=ot.getNpcs();i.innerHTML=n.map(a=>`
      <div class="item-card">
        <div class="icon-preview"><img src="${a.avatar}" alt="${a.name}"/></div>
        <div class="item-name">${a.name}</div>
        <div class="item-info" style="color:${a.color}">â— ${a.color}</div>
        <div class="item-actions">
          <button class="btn-edit" data-id="${a.id}">ç¼–è¾‘</button>
          <button class="btn-delete" data-id="${a.id}">åˆ é™¤</button>
        </div>
      </div>
    `).join(""),Wt(i),i.querySelectorAll(".btn-edit").forEach(a=>{a.addEventListener("click",()=>{const o=n.find(l=>l.id===a.dataset.id);o&&is(e,"ç¼–è¾‘NPC",[{key:"name",label:"NPCåç§°",type:"text"},{key:"color",label:"NPCé¢œè‰²",type:"color",colors:jr},{key:"avatar",label:"è‡ªå®šä¹‰å¤´åƒ (å¯é€‰ï¼Œä¸å¡«åˆ™è‡ªåŠ¨ç”Ÿæˆ)",type:"avatar-upload"}],o,l=>{(!l.avatar||!l.avatar.trim())&&(l.avatar=Jt(l.name,l.color)),ot.updateNpc(o.id,l),r()})})}),i.querySelectorAll(".btn-delete").forEach(a=>{a.addEventListener("click",()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªNPCå—ï¼Ÿ")&&(ot.deleteNpc(a.dataset.id),r())})})}s.addEventListener("click",()=>{is(e,"æ–°å¢NPC",[{key:"name",label:"NPCåç§°",type:"text"},{key:"color",label:"NPCé¢œè‰²",type:"color",colors:jr},{key:"avatar",label:"è‡ªå®šä¹‰å¤´åƒ (å¯é€‰ï¼Œä¸å¡«åˆ™è‡ªåŠ¨ç”Ÿæˆ)",type:"avatar-upload"}],{color:jr[0]},n=>{if(!n.name){alert("è¯·è¾“å…¥NPCåç§°");return}(!n.avatar||!n.avatar.trim())&&(n.avatar=Jt(n.name,n.color)),ot.addNpc(n),r()})}),r()}function Mc(e,t){const{grid:i,addBtn:s}=Hs(e,"ğŸ® å°æ¸¸æˆç¼–è¾‘",t);function r(){const a=ot.getMiniGames();i.innerHTML=a.map(o=>`
      <div class="item-card">
        <div class="icon-preview"><img src="${o.icon}" alt="${o.name}"/></div>
        <div class="item-name">${o.name}</div>
        <div class="item-info">æ¦‚ç‡: ${o.probability}% | æ¬¡æ•°: ${o.maxCount}</div>
        <div class="item-info" style="color:#00cec9">${o.winCondition}</div>
        <div class="item-actions">
          <button class="btn-edit" data-id="${o.id}">ç¼–è¾‘</button>
          <button class="btn-delete" data-id="${o.id}">åˆ é™¤</button>
        </div>
      </div>
    `).join(""),Wt(i),i.querySelectorAll(".btn-edit").forEach(o=>{o.addEventListener("click",()=>{const l=a.find(h=>h.id===o.dataset.id);l&&n(l,h=>{h.remainingCount=h.maxCount,ot.updateMiniGame(l.id,h),r()})})}),i.querySelectorAll(".btn-delete").forEach(o=>{o.addEventListener("click",()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå°æ¸¸æˆå—ï¼Ÿ")&&(ot.deleteMiniGame(o.dataset.id),r())})})}function n(a={},o){is(e,a.id?"ç¼–è¾‘å°æ¸¸æˆ":"æ–°å¢å°æ¸¸æˆ",[{key:"name",label:"æ¸¸æˆåç§°",type:"text"},{key:"icon",label:"æ¸¸æˆå›¾æ ‡",type:"icon-url"},{key:"probability",label:"å‡ºç°æ¦‚ç‡ (1-100)",type:"number",min:1,max:100,default:50},{key:"maxCount",label:"æœ€å¤§å‡ºç°æ¬¡æ•°",type:"number",min:1,max:999,default:100},{key:"winCondition",label:"èƒœåˆ©æ¡ä»¶",type:"text"}],a,o)}s.addEventListener("click",()=>{n({probability:50,maxCount:100,icon:""},a=>{if(!a.name){alert("è¯·è¾“å…¥æ¸¸æˆåç§°");return}a.remainingCount=a.maxCount,ot.addMiniGame(a),r()})}),r()}function Ac(e,t){const{grid:i,addBtn:s}=Hs(e,"â— éšæœºäº‹ä»¶ç¼–è¾‘",t);function r(){const a=ot.getEvents();i.innerHTML=a.map(o=>`
      <div class="item-card">
        <div class="icon-preview"><img src="${o.icon}" alt="${o.name}"/></div>
        <div class="item-name">${o.name}</div>
        <div class="item-info">${o.type==="reward"?"ğŸ å¥–åŠ±":"ğŸ˜¤ æƒ©ç½š"}</div>
        <div class="item-info" style="color:rgba(255,255,255,0.5)">${o.description||""}</div>
        <div class="item-actions">
          <button class="btn-edit" data-id="${o.id}">ç¼–è¾‘</button>
          <button class="btn-delete" data-id="${o.id}">åˆ é™¤</button>
        </div>
      </div>
    `).join(""),Wt(i),i.querySelectorAll(".btn-edit").forEach(o=>{o.addEventListener("click",()=>{const l=a.find(h=>h.id===o.dataset.id);l&&n(l,h=>{ot.updateEvent(l.id,h),r()})})}),i.querySelectorAll(".btn-delete").forEach(o=>{o.addEventListener("click",()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº‹ä»¶å—ï¼Ÿ")&&(ot.deleteEvent(o.dataset.id),r())})})}function n(a={},o){is(e,a.id?"ç¼–è¾‘äº‹ä»¶":"æ–°å¢äº‹ä»¶",[{key:"name",label:"äº‹ä»¶åç§°",type:"text"},{key:"icon",label:"äº‹ä»¶å›¾æ ‡",type:"icon-url"},{key:"type",label:"äº‹ä»¶ç±»å‹",type:"select",options:[{value:"reward",label:"ğŸ å¥–åŠ±"},{value:"punishment",label:"ğŸ˜¤ æƒ©ç½š"}]},{key:"description",label:"æè¿°",type:"text"}],a,o)}s.addEventListener("click",()=>{n({type:"reward",icon:""},a=>{if(!a.name){alert("è¯·è¾“å…¥äº‹ä»¶åç§°");return}ot.addEvent(a),r()})}),r()}function $c(e,t){const{grid:i,addBtn:s}=Hs(e,"ğŸ‘¥ NPCäº‹ä»¶ç¼–è¾‘",t);function r(){const a=ot.getNpcEvents();i.innerHTML=a.map(o=>`
      <div class="item-card">
        <div class="icon-preview"><img src="${o.icon}" alt="${o.name}"/></div>
        <div class="item-name">${o.name}</div>
        <div class="item-info">${o.type==="reward"?"ğŸ å¥–åŠ±":"ğŸ˜¤ æƒ©ç½š"}</div>
        <div class="item-info" style="color:rgba(255,255,255,0.5)">${o.description||""}</div>
        <div class="item-actions">
          <button class="btn-edit" data-id="${o.id}">ç¼–è¾‘</button>
          <button class="btn-delete" data-id="${o.id}">åˆ é™¤</button>
        </div>
      </div>
    `).join(""),Wt(i),i.querySelectorAll(".btn-edit").forEach(o=>{o.addEventListener("click",()=>{const l=a.find(h=>h.id===o.dataset.id);l&&n(l,h=>{ot.updateNpcEvent(l.id,h),r()})})}),i.querySelectorAll(".btn-delete").forEach(o=>{o.addEventListener("click",()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªNPCäº‹ä»¶å—ï¼Ÿ")&&(ot.deleteNpcEvent(o.dataset.id),r())})})}function n(a={},o){is(e,a.id?"ç¼–è¾‘NPCäº‹ä»¶":"æ–°å¢NPCäº‹ä»¶",[{key:"name",label:"äº‹ä»¶åç§°",type:"text"},{key:"icon",label:"äº‹ä»¶å›¾æ ‡",type:"icon-url"},{key:"type",label:"äº‹ä»¶ç±»å‹",type:"select",options:[{value:"reward",label:"ğŸ å¥–åŠ±"},{value:"punishment",label:"ğŸ˜¤ æƒ©ç½š"}]},{key:"description",label:"æè¿°",type:"text"}],a,o)}s.addEventListener("click",()=>{n({type:"reward",icon:""},a=>{if(!a.name){alert("è¯·è¾“å…¥NPCäº‹ä»¶åç§°");return}ot.addNpcEvent(a),r()})}),r()}function Ic(e,t){e.innerHTML=`
    <div class="editor-screen">
      <div class="editor-header">
        <button class="btn-back" id="btn-back">â† è¿”å›</button>
        <h2>ğŸ† æœ€ç»ˆå¤§å¥–è®¾å®š</h2>
        <div></div>
      </div>
      <div class="editor-body" style="display:flex;align-items:center;justify-content:center">
        <div id="prize-form" style="text-align:center"></div>
      </div>
    </div>
  `,e.querySelector("#btn-back").addEventListener("click",()=>t("menu"));const i=ot.getFinalPrize(),s=e.querySelector("#prize-form");s.innerHTML=`
    <div style="margin-bottom:30px">
      <div class="icon-preview" style="width:150px;height:150px;margin:0 auto 20px;border-radius:20px;border:2px solid rgba(255,215,0,0.3);background:rgba(255,255,255,0.05)">
        <img id="prize-icon-preview" src="${i.icon}" alt="å¤§å¥–" style="width:100%;height:100%"/>
      </div>
    </div>
    <div class="form-group" style="max-width:400px;margin:0 auto">
      <label>å¤§å¥–åç§°</label>
      <input type="text" id="prize-name" value="${i.name||""}" />
    </div>
    <div class="form-group" style="max-width:400px;margin:15px auto 0">
      <label>å›¾æ ‡ (è¾“å…¥URL æˆ–ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡)</label>
      <div class="icon-selector">
        <input type="text" id="prize-icon" value="${i.icon||""}" style="flex:1"/>
        <label class="btn-upload" for="prize-icon-upload">ğŸ“ ä¸Šä¼ </label>
        <input type="file" id="prize-icon-upload" accept="image/*" style="display:none"/>
      </div>
    </div>
    <button class="btn-save" id="prize-save" style="margin-top:25px;padding:12px 40px;font-size:1.1em">ä¿å­˜è®¾å®š</button>
  `,Wt(s);const r=s.querySelector("#prize-icon");r.addEventListener("input",()=>{const n=r.value,a=s.querySelector("#prize-icon-preview");Sa(n)?ka(n.slice(4)).then(o=>{o&&(a.src=o)}):a.src=n}),s.querySelector("#prize-icon-upload").addEventListener("change",async n=>{const a=n.target.files[0];if(a)try{const o=await vh(a),l=xh();await mh(l,o),r.value=`idb:${l}`,s.querySelector("#prize-icon-preview").src=o}catch(o){console.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",o),alert("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}}),s.querySelector("#prize-save").addEventListener("click",()=>{const n=s.querySelector("#prize-name").value,a=s.querySelector("#prize-icon").value;if(!n){alert("è¯·è¾“å…¥å¤§å¥–åç§°");return}ot.saveFinalPrize({name:n,icon:a}),alert("âœ… å¤§å¥–è®¾å®šå·²ä¿å­˜ï¼")})}var Da;(function(e){e[e.No=0]="No",e[e.Yes=1]="Yes",e[e.NoAndSkip=2]="NoAndSkip",e[e.YesAndSkip=3]="YesAndSkip"})(Da||(Da={}));const Dc={};function G(e){return e===void 0}function ye(e){return e==null}function Et(e){return typeof e=="string"}const{isFinite:ia}=Number;function St(e){return typeof e=="number"}const{isArray:Lt}=Array;function _t(e){return e&&typeof e=="object"}function Wc(e){return JSON.stringify(e)==="{}"}const gt={default:(e,t)=>(Ks(t,e),Ks(e,t),e),assign(e,t,i){let s;Object.keys(t).forEach(r=>{var n,a;if(s=t[r],(s==null?void 0:s.constructor)===Object&&((n=e[r])===null||n===void 0?void 0:n.constructor)===Object)return Ks(e[r],t[r],i&&i[r]);i&&r in i?((a=i[r])===null||a===void 0?void 0:a.constructor)===Object&&Ks(e[r]={},t[r],i[r]):e[r]=t[r]})},copyAttrs:(e,t,i)=>(i.forEach(s=>{G(t[s])||(e[s]=t[s])}),e),clone:e=>JSON.parse(JSON.stringify(e)),toMap(e){const t={};for(let i=0,s=e.length;i<s;i++)t[e[i]]=!0;return t},stintSet(e,t,i){i||(i=void 0),e[t]!==i&&(e[t]=i)}},{assign:Ks}=gt;class wh{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&t.length===6&&t[0]===1}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:t}=this;return t==="pass-through"?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const i=this.__input[t];if(!G(i))return i}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:i}=this;let s;for(let r in this)r[0]!=="_"&&(s=i?i[r]:void 0,t[r]=G(s)?this[r]:s);return t}__setInput(t,i){this.__input||(this.__input={}),this.__input[t]=i}__getInput(t){if(this.__input){const i=this.__input[t];if(!G(i))return i}if(t!=="path"||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&!G(this.__input[t])&&(this.__input[t]=void 0)}__getInputData(t,i){const s={};if(t)if(Lt(t))for(let r of t)s[r]=this.__getInput(r);else for(let r in t)s[r]=this.__getInput(r);else{let r,n,{__input:a}=this;s.tag=this.__leaf.tag;for(let o in this)if(o[0]!=="_"&&(r=this["_"+o],!G(r))){if(o==="path"&&!this.__pathInputed)continue;n=a?a[o]:void 0,s[o]=G(n)?r:n}}if(i&&i.matrix){const{a:r,b:n,c:a,d:o,e:l,f:h}=this.__leaf.__localMatrix;s.matrix={a:r,b:n,c:a,d:o,e:l,f:h}}return s}__setMiddle(t,i){this.__middle||(this.__middle={}),this.__middle[t]=i}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if(t.blendMode==="pass-through"){const i=this.__leaf;t.opacity<1&&(i.isBranch||t.__hasMultiPaint)||i.__hasEraser||t.eraser||t.filter?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const ti={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(e){const{types:t}=Nc;return t[e]?t[e]++:(t[e]=1,0)}},Nc=ti;let qt,Xt,Ur;const{max:ls}=Math,Kr=[0,0,0,0],Fr={zero:[...Kr],tempFour:Kr,set:(e,t,i,s,r)=>(i===void 0&&(i=s=r=t),e[0]=t,e[1]=i,e[2]=s,e[3]=r,e),setTemp:(e,t,i,s)=>Qs(Kr,e,t,i,s),toTempAB(e,t,i){Ur=i?St(e)?t:e:[],St(e)?(qt=Wa(e),Xt=t):St(t)?(qt=e,Xt=Wa(t)):(qt=e,Xt=t),qt.length!==4&&(qt=Qr(qt)),Xt.length!==4&&(Xt=Qr(Xt))},get(e,t){let i;if(!St(e))switch(e.length){case 4:i=G(t)?e:[...e];break;case 2:i=[e[0],e[1],e[0],e[1]];break;case 3:i=[e[0],e[1],e[2],e[1]];break;case 1:e=e[0];break;default:e=0}if(i||(i=[e,e,e,e]),!G(t))for(let s=0;s<4;s++)i[s]>t&&(i[s]=t);return i},max:(e,t,i)=>St(e)&&St(t)?ls(e,t):(Na(e,t,i),Qs(Ur,ls(qt[0],Xt[0]),ls(qt[1],Xt[1]),ls(qt[2],Xt[2]),ls(qt[3],Xt[3]))),add:(e,t,i)=>St(e)&&St(t)?e+t:(Na(e,t,i),Qs(Ur,qt[0]+Xt[0],qt[1]+Xt[1],qt[2]+Xt[2],qt[3]+Xt[3])),swapAndScale(e,t,i,s){if(St(e))return t===i?e*t:[e*i,e*t];const r=s?e:[],[n,a,o,l]=e.length===4?e:Qr(e);return Qs(r,o*i,l*t,n*i,a*t)}},{set:Qs,get:Qr,setTemp:Wa,toTempAB:Na}=Fr,{round:zc,pow:Fc,max:Hc,floor:Yc,PI:Ta}=Math,Nt={within:(e,t,i)=>(_t(t)&&(i=t.max,t=t.min),!G(t)&&e<t&&(e=t),!G(i)&&e>i&&(e=i),e),fourNumber:Fr.get,formatRotation:(e,t)=>(e%=360,t?e<0&&(e+=360):(e>180&&(e-=360),e<-180&&(e+=360)),Nt.float(e)),getGapRotation(e,t,i=0){let s=e+i;if(t>1){const r=Math.abs(s%t);(r<1||r>t-1)&&(s=Math.round(s/t)*t)}return s-i},float(e,t){const i=G(t)?1e12:Fc(10,t);return(e=zc(e*i)/i)===-0?0:e},sign:e=>e<0?-1:1,getScaleData(e,t,i,s){if(s||(s={}),t){const r=(St(t)?t:t.width||0)/i.width,n=(St(t)?t:t.height||0)/i.height;s.scaleX=r||n||1,s.scaleY=n||r||1}else e&&Nt.assignScale(s,e);return s},assignScale(e,t){St(t)?e.scaleX=e.scaleY=t:(e.scaleX=t.x,e.scaleY=t.y)},getFloorScale:(e,t=1)=>Hc(Yc(e),t)/e,randInt:Js,randColor:e=>`rgba(${Js(255)},${Js(255)},${Js(255)},${e||1})`};function Js(e){return Math.round(Math.random()*e)}const pt=Ta/180,ve=2*Ta,Qi=Ta/2;function Vc(){return{x:0,y:0}}function bh(){return{x:0,y:0,width:0,height:0}}function kh(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:Jr,cos:Zr,acos:Zs,sqrt:tn}=Math,{float:Ii}=Nt,Di={};function za(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const K={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:za(),tempMatrix:{},set(e,t=1,i=0,s=0,r=1,n=0,a=0){e.a=t,e.b=i,e.c=s,e.d=r,e.e=n,e.f=a},get:kh,getWorld:za,copy(e,t){e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f},translate(e,t,i){e.e+=t,e.f+=i},translateInner(e,t,i,s){e.e+=e.a*t+e.c*i,e.f+=e.b*t+e.d*i,s&&(e.e-=t,e.f-=i)},scale(e,t,i=t){e.a*=t,e.b*=t,e.c*=i,e.d*=i},pixelScale(e,t,i){i||(i=e),i.a=e.a*t,i.b=e.b*t,i.c=e.c*t,i.d=e.d*t,i.e=e.e*t,i.f=e.f*t},scaleOfOuter(e,t,i,s){xt.toInnerPoint(e,t,Di),xt.scaleOfInner(e,Di,i,s)},scaleOfInner(e,t,i,s=i){xt.translateInner(e,t.x,t.y),xt.scale(e,i,s),xt.translateInner(e,-t.x,-t.y)},rotate(e,t){const{a:i,b:s,c:r,d:n}=e,a=Zr(t*=pt),o=Jr(t);e.a=i*a-s*o,e.b=i*o+s*a,e.c=r*a-n*o,e.d=r*o+n*a},rotateOfOuter(e,t,i){xt.toInnerPoint(e,t,Di),xt.rotateOfInner(e,Di,i)},rotateOfInner(e,t,i){xt.translateInner(e,t.x,t.y),xt.rotate(e,i),xt.translateInner(e,-t.x,-t.y)},skew(e,t,i){const{a:s,b:r,c:n,d:a}=e;i&&(i*=pt,e.a=s+n*i,e.b=r+a*i),t&&(t*=pt,e.c=n+s*t,e.d=a+r*t)},skewOfOuter(e,t,i,s){xt.toInnerPoint(e,t,Di),xt.skewOfInner(e,Di,i,s)},skewOfInner(e,t,i,s=0){xt.translateInner(e,t.x,t.y),xt.skew(e,i,s),xt.translateInner(e,-t.x,-t.y)},multiply(e,t){const{a:i,b:s,c:r,d:n,e:a,f:o}=e;e.a=t.a*i+t.b*r,e.b=t.a*s+t.b*n,e.c=t.c*i+t.d*r,e.d=t.c*s+t.d*n,e.e=t.e*i+t.f*r+a,e.f=t.e*s+t.f*n+o},multiplyParent(e,t,i,s,r){const{e:n,f:a}=e;if(i||(i=e),G(s)&&(s=e.a!==1||e.b||e.c||e.d!==1),s){const{a:o,b:l,c:h,d}=e;i.a=o*t.a+l*t.c,i.b=o*t.b+l*t.d,i.c=h*t.a+d*t.c,i.d=h*t.b+d*t.d,r&&(i.scaleX=t.scaleX*r.scaleX,i.scaleY=t.scaleY*r.scaleY)}else i.a=t.a,i.b=t.b,i.c=t.c,i.d=t.d,r&&(i.scaleX=t.scaleX,i.scaleY=t.scaleY);i.e=n*t.a+a*t.c+t.e,i.f=n*t.b+a*t.d+t.f},divide(e,t){xt.multiply(e,xt.tempInvert(t))},divideParent(e,t){xt.multiplyParent(e,xt.tempInvert(t))},tempInvert(e){const{tempMatrix:t}=xt;return xt.copy(t,e),xt.invert(t),t},invert(e){const{a:t,b:i,c:s,d:r,e:n,f:a}=e;if(i||s){const o=1/(t*r-i*s);e.a=r*o,e.b=-i*o,e.c=-s*o,e.d=t*o,e.e=-(n*r-a*s)*o,e.f=-(a*t-n*i)*o}else if(t===1&&r===1)e.e=-n,e.f=-a;else{const o=1/(t*r);e.a=r*o,e.d=t*o,e.e=-n*r*o,e.f=-a*t*o}},toOuterPoint(e,t,i,s){const{x:r,y:n}=t;i||(i=t),i.x=r*e.a+n*e.c,i.y=r*e.b+n*e.d,s||(i.x+=e.e,i.y+=e.f)},toInnerPoint(e,t,i,s){const{a:r,b:n,c:a,d:o}=e,l=1/(r*o-n*a),{x:h,y:d}=t;if(i||(i=t),i.x=(h*o-d*a)*l,i.y=(d*r-h*n)*l,!s){const{e:c,f:u}=e;i.x-=(c*o-u*a)*l,i.y-=(u*r-c*n)*l}},setLayout(e,t,i,s,r){const{x:n,y:a,scaleX:o,scaleY:l}=t;if(G(r)&&(r=t.rotation||t.skewX||t.skewY),r){const{rotation:h,skewX:d,skewY:c}=t,u=h*pt,p=Zr(u),_=Jr(u);if(d||c){const m=d*pt,v=c*pt;e.a=(p+v*-_)*o,e.b=(_+v*p)*o,e.c=(m*p-_)*l,e.d=(p+m*_)*l}else e.a=p*o,e.b=_*o,e.c=-_*l,e.d=p*l}else e.a=o,e.b=0,e.c=0,e.d=l;e.e=n,e.f=a,(i=i||s)&&xt.translateInner(e,-i.x,-i.y,!s)},getLayout(e,t,i,s){const{a:r,b:n,c:a,d:o,e:l,f:h}=e;let d,c,u,p,_,m=l,v=h;if(n||a){const T=r*o-n*a;if(a&&!s){d=tn(r*r+n*n),c=T/d;const X=r/d;u=n>0?Zs(X):-Zs(X)}else{c=tn(a*a+o*o),d=T/c;const X=a/c;u=Qi-(o>0?Zs(-X):-Zs(X))}const $=Ii(Zr(u)),B=Jr(u);d=Ii(d),c=Ii(c),p=$?Ii((a/c+B)/$/pt,9):0,_=$?Ii((n/d-B)/$/pt,9):0,u=Ii(u/pt)}else d=r,c=o,u=p=_=0;return(t=i||t)&&(m+=t.x*r+t.y*a,v+=t.x*n+t.y*o,i||(m-=t.x,v-=t.y)),{x:m,y:v,scaleX:d,scaleY:c,rotation:u,skewX:p,skewY:_}},withScale(e,t,i=t){const s=e;if(!t||!i){const{a:r,b:n,c:a,d:o}=e;n||a?i=(r*o-n*a)/(t=tn(r*r+n*n)):(t=r,i=o)}return s.scaleX=t,s.scaleY=i,s},reset(e){xt.set(e)}},xt=K,{float:tr}=Nt,{toInnerPoint:en,toOuterPoint:Fa}=K,{sin:Ha,cos:Ya,abs:Va,sqrt:qc,atan2:Xc,min:Gc,round:er}=Math,Q={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(e,t=0,i=0){e.x=t,e.y=i},setRadius(e,t,i){e.radiusX=t,e.radiusY=G(i)?t:i},copy(e,t){e.x=t.x,e.y=t.y},copyFrom(e,t,i){e.x=t,e.y=i},round(e,t){e.x=t?er(e.x-.5)+.5:er(e.x),e.y=t?er(e.y-.5)+.5:er(e.y)},move(e,t,i){_t(t)?(e.x+=t.x,e.y+=t.y):(e.x+=t,e.y+=i)},scale(e,t,i=t){e.x&&(e.x*=t),e.y&&(e.y*=i)},scaleOf(e,t,i,s=i){e.x+=(e.x-t.x)*(i-1),e.y+=(e.y-t.y)*(s-1)},rotate(e,t,i){i||(i=Si.defaultPoint);const s=Ya(t*=pt),r=Ha(t),n=e.x-i.x,a=e.y-i.y;e.x=i.x+n*s-a*r,e.y=i.y+n*r+a*s},tempToInnerOf(e,t){const{tempPoint:i}=Si;return ir(i,e),en(t,i,i),i},tempToOuterOf(e,t){const{tempPoint:i}=Si;return ir(i,e),Fa(t,i,i),i},tempToInnerRadiusPointOf(e,t){const{tempRadiusPoint:i}=Si;return ir(i,e),Si.toInnerRadiusPointOf(e,t,i),i},copyRadiusPoint:(e,t,i,s)=>(ir(e,t),jc(e,i,s),e),toInnerRadiusPointOf(e,t,i){i||(i=e),en(t,e,i),i.radiusX=Math.abs(e.radiusX/t.scaleX),i.radiusY=Math.abs(e.radiusY/t.scaleY)},toInnerOf(e,t,i){en(t,e,i)},toOuterOf(e,t,i){Fa(t,e,i)},getCenter:(e,t)=>({x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}),getCenterX:(e,t)=>e+(t-e)/2,getCenterY:(e,t)=>e+(t-e)/2,getDistance:(e,t)=>sn(e.x,e.y,t.x,t.y),getDistanceFrom(e,t,i,s){const r=Va(i-e),n=Va(s-t);return qc(r*r+n*n)},getMinDistanceFrom:(e,t,i,s,r,n)=>Gc(sn(e,t,i,s),sn(i,s,r,n)),getAngle:(e,t)=>qa(e,t)/pt,getRotation:(e,t,i,s)=>(s||(s=t),Si.getRadianFrom(e.x,e.y,t.x,t.y,i.x,i.y,s.x,s.y)/pt),getRadianFrom(e,t,i,s,r,n,a,o){G(a)&&(a=i,o=s);const l=e-i,h=t-s,d=r-a,c=n-o;return Math.atan2(l*c-h*d,l*d+h*c)},getAtan2:(e,t)=>Xc(t.y-e.y,t.x-e.x),getDistancePoint(e,t,i,s,r){const n=qa(e,t);return r&&(e=t),s||(t={}),t.x=e.x+Ya(n)*i,t.y=e.y+Ha(n)*i,t},toNumberPoints(e){let t=e;return _t(e[0])&&(t=[],e.forEach(i=>t.push(i.x,i.y))),t},isSame:(e,t)=>tr(e.x)===tr(t.x)&&tr(e.y)===tr(t.y),reset(e){}},Si=Q,{getDistanceFrom:sn,copy:ir,setRadius:jc,getAtan2:qa}=Si;let Uc=class Lr{constructor(t,i){this.set(t,i)}set(t,i){return _t(t)?Q.copy(this,t):Q.set(this,t,i),this}get(){const{x:t,y:i}=this;return{x:t,y:i}}clone(){return new Lr(this)}move(t,i){return Q.move(this,t,i),this}scale(t,i){return Q.scale(this,t,i),this}scaleOf(t,i,s){return Q.scaleOf(this,t,i,s),this}rotate(t,i){return Q.rotate(this,t,i),this}rotateOf(t,i){return Q.rotate(this,i,t),this}getRotation(t,i,s){return Q.getRotation(this,t,i,s)}toInnerOf(t,i){return Q.toInnerOf(this,t,i),this}toOuterOf(t,i){return Q.toOuterOf(this,t,i),this}getCenter(t){return new Lr(Q.getCenter(this,t))}getDistance(t){return Q.getDistance(this,t)}getDistancePoint(t,i,s,r){return new Lr(Q.getDistancePoint(this,t,i,s,r))}getAngle(t){return Q.getAngle(this,t)}getAtan2(t){return Q.getAtan2(this,t)}isSame(t){return Q.isSame(this,t)}reset(){return this}};new Uc;let Li=class Sh{constructor(t,i,s,r,n,a){this.set(t,i,s,r,n,a)}set(t,i,s,r,n,a){return _t(t)?K.copy(this,t):K.set(this,t,i,s,r,n,a),this}setWith(t){return K.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:i,c:s,d:r,e:n,f:a}=this;return{a:t,b:i,c:s,d:r,e:n,f:a}}clone(){return new Sh(this)}translate(t,i){return K.translate(this,t,i),this}translateInner(t,i){return K.translateInner(this,t,i),this}scale(t,i){return K.scale(this,t,i),this}scaleWith(t,i){return K.scale(this,t,i),this.scaleX*=t,this.scaleY*=i||t,this}pixelScale(t){return K.pixelScale(this,t),this}scaleOfOuter(t,i,s){return K.scaleOfOuter(this,t,i,s),this}scaleOfInner(t,i,s){return K.scaleOfInner(this,t,i,s),this}rotate(t){return K.rotate(this,t),this}rotateOfOuter(t,i){return K.rotateOfOuter(this,t,i),this}rotateOfInner(t,i){return K.rotateOfInner(this,t,i),this}skew(t,i){return K.skew(this,t,i),this}skewOfOuter(t,i,s){return K.skewOfOuter(this,t,i,s),this}skewOfInner(t,i,s){return K.skewOfInner(this,t,i,s),this}multiply(t){return K.multiply(this,t),this}multiplyParent(t){return K.multiplyParent(this,t),this}divide(t){return K.divide(this,t),this}divideParent(t){return K.divideParent(this,t),this}invert(){return K.invert(this),this}invertWith(){return K.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,i,s){K.toOuterPoint(this,t,i,s)}toInnerPoint(t,i,s){K.toInnerPoint(this,t,i,s)}setLayout(t,i,s){return K.setLayout(this,t,i,s),this}getLayout(t,i,s){return K.getLayout(this,t,i,s)}withScale(t,i){return K.withScale(this,t,i)}reset(){K.reset(this)}};new Li;const Hr={tempPointBounds:{},setPoint(e,t,i){e.minX=e.maxX=t,e.minY=e.maxY=i},addPoint(e,t,i){e.minX=t<e.minX?t:e.minX,e.minY=i<e.minY?i:e.minY,e.maxX=t>e.maxX?t:e.maxX,e.maxY=i>e.maxY?i:e.maxY},addBounds(e,t,i,s,r){Xa(e,t,i),Xa(e,t+s,i+r)},copy(e,t){e.minX=t.minX,e.minY=t.minY,e.maxX=t.maxX,e.maxY=t.maxY},addPointBounds(e,t){e.minX=t.minX<e.minX?t.minX:e.minX,e.minY=t.minY<e.minY?t.minY:e.minY,e.maxX=t.maxX>e.maxX?t.maxX:e.maxX,e.maxY=t.maxY>e.maxY?t.maxY:e.maxY},toBounds(e,t){t.x=e.minX,t.y=e.minY,t.width=e.maxX-e.minX,t.height=e.maxY-e.minY}},{addPoint:Xa}=Hr;var sa,ra;(function(e){e[e.top=0]="top",e[e.right=1]="right",e[e.bottom=2]="bottom",e[e.left=3]="left"})(sa||(sa={})),(function(e){e[e.topLeft=0]="topLeft",e[e.top=1]="top",e[e.topRight=2]="topRight",e[e.right=3]="right",e[e.bottomRight=4]="bottomRight",e[e.bottom=5]="bottom",e[e.bottomLeft=6]="bottomLeft",e[e.left=7]="left",e[e.center=8]="center",e[e["top-left"]=0]="top-left",e[e["top-right"]=2]="top-right",e[e["bottom-right"]=4]="bottom-right",e[e["bottom-left"]=6]="bottom-left"})(ra||(ra={}));const Ea=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];Ea.forEach(e=>e.type="percent");const Mi={directionData:Ea,tempPoint:{},get:Ga,toPoint(e,t,i,s,r,n){const a=Ga(e);i.x=a.x,i.y=a.y,a.type==="percent"&&(i.x*=t.width,i.y*=t.height,r&&(n||(i.x-=r.x,i.y-=r.y),a.x&&(i.x-=a.x===1?r.width:a.x===.5?a.x*r.width:0),a.y&&(i.y-=a.y===1?r.height:a.y===.5?a.y*r.height:0))),s||(i.x+=t.x,i.y+=t.y)},getPoint:(e,t,i)=>(i||(i={}),Mi.toPoint(e,t,i,!0),i)};function Ga(e){return Et(e)?Ea[ra[e]]:e}const{toPoint:Kc}=Mi,Th={toPoint(e,t,i,s,r,n){Kc(e,i,s,r,t,n)}},{tempPointBounds:ii,setPoint:ja,addPoint:sr,toBounds:Ua}=Hr,{toOuterPoint:rr}=K,{float:nr,fourNumber:Qc}=Nt,{floor:Ka,ceil:ar}=Math;let Pe,Re,_i,yi;const ze={},he={},mi={},I={tempBounds:mi,set(e,t=0,i=0,s=0,r=0){e.x=t,e.y=i,e.width=s,e.height=r},copy(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},copyAndSpread(e,t,i,s,r){const{x:n,y:a,width:o,height:l}=t;if(Lt(i)){const h=Qc(i);s?ct.set(e,n+h[3],a+h[0],o-h[1]-h[3],l-h[2]-h[0]):ct.set(e,n-h[3],a-h[0],o+h[1]+h[3],l+h[2]+h[0])}else s&&(i=-i),ct.set(e,n-i,a-i,o+2*i,l+2*i);r&&(r==="width"?(e.y=a,e.height=l):(e.x=n,e.width=o))},minX:e=>e.width>0?e.x:e.x+e.width,minY:e=>e.height>0?e.y:e.y+e.height,maxX:e=>e.width>0?e.x+e.width:e.x,maxY:e=>e.height>0?e.y+e.height:e.y,move(e,t,i){e.x+=t,e.y+=i},scroll(e,t){e.x+=t.scrollX,e.y+=t.scrollY},getByMove:(e,t,i)=>(e=Object.assign({},e),ct.move(e,t,i),e),toOffsetOutBounds(e,t,i){t?Ja(t,e):t=e,i||(i=e),t.offsetX=ct.maxX(i),t.offsetY=ct.maxY(i),ct.move(t,-t.offsetX,-t.offsetY)},scale(e,t,i=t,s){s||Q.scale(e,t,i),e.width*=t,e.height*=i},scaleOf(e,t,i,s=i){Q.scaleOf(e,t,i,s),e.width*=i,e.height*=s},tempToOuterOf:(e,t)=>(ct.copy(mi,e),ct.toOuterOf(mi,t),mi),getOuterOf:(e,t)=>(e=Object.assign({},e),ct.toOuterOf(e,t),e),toOuterOf(e,t,i){if(i||(i=e),t.b===0&&t.c===0){const{a:s,d:r,e:n,f:a}=t;s>0?(i.width=e.width*s,i.x=n+e.x*s):(i.width=e.width*-s,i.x=n+e.x*s-i.width),r>0?(i.height=e.height*r,i.y=a+e.y*r):(i.height=e.height*-r,i.y=a+e.y*r-i.height)}else ze.x=e.x,ze.y=e.y,rr(t,ze,he),ja(ii,he.x,he.y),ze.x=e.x+e.width,rr(t,ze,he),sr(ii,he.x,he.y),ze.y=e.y+e.height,rr(t,ze,he),sr(ii,he.x,he.y),ze.x=e.x,rr(t,ze,he),sr(ii,he.x,he.y),Ua(ii,i)},toInnerOf(e,t,i){i||(i=e),ct.move(i,-t.e,-t.f),ct.scale(i,1/t.a,1/t.d)},getFitMatrix(e,t,i=1){const s=Math.min(i,ct.getFitScale(e,t));return new Li(s,0,0,s,-t.x*s,-t.y*s)},getFitScale(e,t,i){const s=e.width/t.width,r=e.height/t.height;return i?Math.max(s,r):Math.min(s,r)},put(e,t,i="center",s=1,r=!0,n){n||(n=t),Et(s)&&(s=ct.getFitScale(e,t,s==="cover")),mi.width=r?t.width*=s:t.width*s,mi.height=r?t.height*=s:t.height*s,Th.toPoint(i,mi,e,n,!0,!0)},getSpread(e,t,i){const s={};return ct.copyAndSpread(s,e,t,!1,i),s},spread(e,t,i){ct.copyAndSpread(e,e,t,!1,i)},shrink(e,t,i){ct.copyAndSpread(e,e,t,!0,i)},ceil(e){const{x:t,y:i}=e;e.x=Ka(e.x),e.y=Ka(e.y),e.width=t>e.x?ar(e.width+t-e.x):ar(e.width),e.height=i>e.y?ar(e.height+i-e.y):ar(e.height)},unsign(e){e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height)},float(e,t){e.x=nr(e.x,t),e.y=nr(e.y,t),e.width=nr(e.width,t),e.height=nr(e.height,t)},add(e,t,i){Pe=e.x+e.width,Re=e.y+e.height,_i=t.x,yi=t.y,i||(_i+=t.width,yi+=t.height),Pe=Pe>_i?Pe:_i,Re=Re>yi?Re:yi,e.x=e.x<t.x?e.x:t.x,e.y=e.y<t.y?e.y:t.y,e.width=Pe-e.x,e.height=Re-e.y},addList(e,t){ct.setListWithFn(e,t,void 0,!0)},setList(e,t,i=!1){ct.setListWithFn(e,t,void 0,i)},addListWithFn(e,t,i){ct.setListWithFn(e,t,i,!0)},setListWithFn(e,t,i,s=!1){let r,n=!0;for(let a=0,o=t.length;a<o;a++)r=i?i(t[a],a):t[a],r&&(r.width||r.height)&&(n?(n=!1,s||Ja(e,r)):Qa(e,r));n&&ct.reset(e)},setPoints(e,t){t.forEach((i,s)=>s===0?ja(ii,i.x,i.y):sr(ii,i.x,i.y)),Ua(ii,e)},setPoint(e,t){ct.set(e,t.x,t.y)},addPoint(e,t){Qa(e,t,!0)},getPoints(e){const{x:t,y:i,width:s,height:r}=e;return[{x:t,y:i},{x:t+s,y:i},{x:t+s,y:i+r},{x:t,y:i+r}]},hitRadiusPoint:(e,t,i)=>(i&&(t=Q.tempToInnerRadiusPointOf(t,i)),t.x>=e.x-t.radiusX&&t.x<=e.x+e.width+t.radiusX&&t.y>=e.y-t.radiusY&&t.y<=e.y+e.height+t.radiusY),hitPoint:(e,t,i)=>(i&&(t=Q.tempToInnerOf(t,i)),t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height),hit:(e,t,i)=>(i&&(t=ct.tempToOuterOf(t,i)),!(e.y+e.height<t.y||t.y+t.height<e.y||e.x+e.width<t.x||t.x+t.width<e.x)),includes:(e,t,i)=>(i&&(t=ct.tempToOuterOf(t,i)),e.x<=t.x&&e.y<=t.y&&e.x+e.width>=t.x+t.width&&e.y+e.height>=t.y+t.height),getIntersectData(e,t,i){if(i&&(t=ct.tempToOuterOf(t,i)),!ct.hit(e,t))return{x:0,y:0,width:0,height:0};let{x:s,y:r,width:n,height:a}=t;return Pe=s+n,Re=r+a,_i=e.x+e.width,yi=e.y+e.height,s=s>e.x?s:e.x,r=r>e.y?r:e.y,Pe=Pe<_i?Pe:_i,Re=Re<yi?Re:yi,n=Pe-s,a=Re-r,{x:s,y:r,width:n,height:a}},intersect(e,t,i){ct.copy(e,ct.getIntersectData(e,t,i))},isSame:(e,t)=>e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height,isEmpty:e=>e.x===0&&e.y===0&&e.width===0&&e.height===0,hasSize:e=>e.width&&e.height,reset(e){ct.set(e)}},ct=I,{add:Qa,copy:Ja}=ct;let Ot=class na{get minX(){return I.minX(this)}get minY(){return I.minY(this)}get maxX(){return I.maxX(this)}get maxY(){return I.maxY(this)}constructor(t,i,s,r){this.set(t,i,s,r)}set(t,i,s,r){return _t(t)?I.copy(this,t):I.set(this,t,i,s,r),this}get(){const{x:t,y:i,width:s,height:r}=this;return{x:t,y:i,width:s,height:r}}clone(){return new na(this)}move(t,i){return I.move(this,t,i),this}scale(t,i,s){return I.scale(this,t,i,s),this}scaleOf(t,i,s){return I.scaleOf(this,t,i,s),this}toOuterOf(t,i){return I.toOuterOf(this,t,i),this}toInnerOf(t,i){return I.toInnerOf(this,t,i),this}getFitMatrix(t,i){return I.getFitMatrix(this,t,i)}put(t,i,s){I.put(this,t,i,s)}spread(t,i){return I.spread(this,t,i),this}shrink(t,i){return I.shrink(this,t,i),this}ceil(){return I.ceil(this),this}unsign(){return I.unsign(this),this}float(t){return I.float(this,t),this}add(t){return I.add(this,t),this}addList(t){return I.setList(this,t,!0),this}setList(t){return I.setList(this,t),this}addListWithFn(t,i){return I.setListWithFn(this,t,i,!0),this}setListWithFn(t,i){return I.setListWithFn(this,t,i),this}setPoint(t){return I.setPoint(this,t),this}setPoints(t){return I.setPoints(this,t),this}addPoint(t){return I.addPoint(this,t),this}getPoints(){return I.getPoints(this)}hitPoint(t,i){return I.hitPoint(this,t,i)}hitRadiusPoint(t,i){return I.hitRadiusPoint(this,t,i)}hit(t,i){return I.hit(this,t,i)}includes(t,i){return I.includes(this,t,i)}intersect(t,i){return I.intersect(this,t,i),this}getIntersect(t,i){return new na(I.getIntersectData(this,t,i))}isSame(t){return I.isSame(this,t)}isEmpty(){return I.isEmpty(this)}reset(){I.reset(this)}};const Bi=new Ot;let Jc=class{constructor(t,i,s,r,n,a){_t(t)?this.copy(t):this.set(t,i,s,r,n,a)}set(t=0,i=0,s=0,r=0,n=0,a=0){this.top=t,this.right=i,this.bottom=s,this.left=r,this.width=n,this.height=a}copy(t){const{top:i,right:s,bottom:r,left:n,width:a,height:o}=t;this.set(i,s,r,n,a,o)}getBoundsFrom(t){const{top:i,right:s,bottom:r,left:n,width:a,height:o}=this;return new Ot(n,i,a||t.width-n-s,o||t.height-i-r)}};const Eh={number:(e,t)=>_t(e)?e.type==="percent"?e.value*t:e.value:e},Zc={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Za,max:to}=Math,A={toURL(e,t){let i=encodeURIComponent(e);return t==="text"?i="data:text/plain;charset=utf-8,"+i:t==="svg"&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:(e,t,i,s)=>e.width*e.height*(t?t*i:1)>(s||hs.maxCacheSize),isSuperLarge:(e,t,i)=>hs.isLarge(e,t,i,hs.maxPatternSize),getRealURL(e){const{prefix:t,suffix:i}=hs;return!i||e.startsWith("data:")||e.startsWith("blob:")||(e+=(e.includes("?")?"&":"?")+i),t&&e[0]==="/"&&(e=t+e),e},resize(e,t,i,s,r,n,a,o,l,h){const d=to(Za(t+(s||0)),1),c=to(Za(i+(r||0)),1);let u,p,_;h&&(_=Eh.number(h.offset,(u=h.type==="x")?t:i))&&(u||(p=!0));const m=A.origin.createCanvas(p?2*d:d,u?2*c:c),v=m.getContext("2d");if(o&&(v.globalAlpha=o),v.imageSmoothingEnabled=a!==!1,hs.canUse(e)){if(n){const T=t/n.width,$=i/n.height;v.setTransform(T,0,0,$,-n.x*T,-n.y*$),v.drawImage(e,0,0,e.width,e.height)}else v.drawImage(e,0,0,t,i);_&&(v.drawImage(m,0,0,d,c,u?_-d:d,u?c:_-c,d,c),v.drawImage(m,0,0,d,c,u?_:d,u?c:_,d,c))}return m},canUse:e=>e&&e.width&&!e.__closed,setPatternTransform(e,t,i){try{t&&e.setTransform&&(e.setTransform(t),t=void 0)}catch{}i&&gt.stintSet(i,"transform",t)}}},{image:hs}=A,{randColor:eo}=Nt;let yt=class aa{constructor(t){this.repeatMap={},this.name=t}static get(t){return new aa(t)}static set filter(t){this.filterList=io(t)}static set exclude(t){this.excludeList=io(t)}static drawRepaint(t,i){const s=eo();t.fillWorld(i,s.replace("1)",".1)")),t.strokeWorld(i,s)}static drawBounds(t,i,s){const r=aa.showBounds==="hit",n=t.__nowWorld,a=eo();r&&(i.setWorld(n),t.__drawHitPath(i),i.fillStyle=a.replace("1)",".2)"),i.fill()),i.resetTransform(),i.setStroke(a,2),r?i.stroke():i.strokeWorld(n,a)}log(...t){if(vi.enable){if(vi.filterList.length&&vi.filterList.every(i=>i!==this.name)||vi.excludeList.length&&vi.excludeList.some(i=>i===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){vi.enable&&this.warn(...t)}warn(...t){vi.showWarn&&console.warn(this.name,...t)}repeat(t,...i){this.repeatMap[t]||(this.warn("repeat:"+t,...i),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(i){console.error(this.name,...t,i)}}};function io(e){return e?Et(e)&&(e=[e]):e=[],e}yt.filterList=[],yt.excludeList=[],yt.showWarn=!0;const vi=yt,td=yt.get("RunTime"),Te={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(e,t){const i=ti.create(ti.RUNTIME);return ce.currentId=ce.idMap[i]=t?performance.now():Date.now(),ce.currentName=ce.nameMap[i]=e,ce.nameToIdMap[e]=i,i},end(e,t){const i=ce.idMap[e],s=ce.nameMap[e],r=t?(performance.now()-i)/1e3:Date.now()-i;ce.idMap[e]=ce.nameMap[e]=ce.nameToIdMap[s]=void 0,td.log(s,r,"ms")},endOfName(e,t){const i=ce.nameToIdMap[e];G(i)||ce.end(i,t)}},ce=Te,Ch=[],Zt={list:{},add(e,...t){this.list[e]=!0,Ch.push(...t)},has(e,t){const i=this.list[e];return!i&&t&&this.need(e),i},need(e){console.error("please install and import plugin: "+(e.includes("-x")?"":"@leafer-in/")+e)}};setTimeout(()=>Ch.forEach(e=>Zt.has(e,!0)));const Tt={editor:e=>Zt.need("editor")},so=yt.get("UICreator"),Ys={list:{},register(e){const{__tag:t}=e.prototype;or[t]&&so.repeat(t),or[t]=e},get(e,t,i,s,r,n){or[e]||so.error("not register "+e);const a=new or[e](t);return G(i)||(a.x=i,s&&(a.y=s),r&&(a.width=r),n&&(a.height=n)),a}},{list:or}=Ys,ed=yt.get("EventCreator"),ss={nameList:{},register(e){let t;Object.keys(e).forEach(i=>{t=e[i],Et(t)&&(cs[t]&&ed.repeat(t),cs[t]=e)})},changeName(e,t){const i=cs[e];if(i){const s=Object.keys(i).find(r=>i[r]===e);s&&(i[s]=t,cs[t]=i)}},has(e){return!!this.nameList[e]},get:(e,...t)=>new cs[e](...t)},{nameList:cs}=ss;let Bh=class{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let i;const{list:s}=this;for(let n=0,a=s.length;n<a;n++)if(i=s[n],i.recycled&&i.isSameSize(t))return i.recycled=!1,i.manager||(i.manager=this),i;const r=Tt.canvas(t);return this.add(r),r}recycle(t){t.recycled=!0}clearRecycled(){let t;const i=[];for(let s=0,r=this.list.length;s<r;s++)t=this.list[s],t.recycled?t.destroy():i.push(t);this.list=i}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}};function W(e,t,i,s){var r,n=arguments.length,a=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}function Ph(e,t,i,s){return new(i||(i=Promise))(function(r,n){function a(h){try{l(s.next(h))}catch(d){n(d)}}function o(h){try{l(s.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof i?d:new i(function(c){c(d)})).then(a,o)}l((s=s.apply(e,[])).next())})}function mt(e){return(t,i)=>{e||(e=i);const s={get(){return this.context[e]},set(r){this.context[e]=r}};i==="strokeCap"&&(s.set=function(r){this.context[e]=r==="none"?"butt":r}),Object.defineProperty(t,i,s)}}const Rh=[];function st(){return(e,t)=>{Rh.push(t)}}const id=[];let N=class{set blendMode(t){t==="normal"&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||id)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Rh.forEach(i=>{t=this.context[i],t&&(this[i]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,i,s,r,n,a){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,i,s,r,n,a){_t(t)?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,i,s,r,n,a)}translate(t,i){}scale(t,i){}rotate(t){}fill(t,i){}stroke(t){}clip(t,i){}fillRect(t,i,s,r){}strokeRect(t,i,s,r){}clearRect(t,i,s,r){}drawImage(t,i,s,r,n,a,o,l,h){switch(arguments.length){case 9:if(i<0){const d=-i/r*l;r+=i,i=0,a+=d,l-=d}if(s<0){const d=-s/n*h;n+=s,s=0,o+=d,h-=d}this.context.drawImage(t,i,s,r,n,a,o,l,h);break;case 5:this.context.drawImage(t,i,s,r,n);break;case 3:this.context.drawImage(t,i,s)}}beginPath(){}moveTo(t,i){}lineTo(t,i){}bezierCurveTo(t,i,s,r,n,a){}quadraticCurveTo(t,i,s,r){}closePath(){}arc(t,i,s,r,n,a){}arcTo(t,i,s,r,n){}ellipse(t,i,s,r,n,a,o,l){}rect(t,i,s,r){}roundRect(t,i,s,r,n){}createConicGradient(t,i,s){}createLinearGradient(t,i,s,r){}createPattern(t,i){}createRadialGradient(t,i,s,r,n,a){}fillText(t,i,s,r){}measureText(t){}strokeText(t,i,s,r){}destroy(){this.context=null}};W([mt("imageSmoothingEnabled")],N.prototype,"smooth",void 0),W([mt("imageSmoothingQuality")],N.prototype,"smoothLevel",void 0),W([mt("globalAlpha")],N.prototype,"opacity",void 0),W([mt()],N.prototype,"fillStyle",void 0),W([mt()],N.prototype,"strokeStyle",void 0),W([mt("lineWidth")],N.prototype,"strokeWidth",void 0),W([mt("lineCap")],N.prototype,"strokeCap",void 0),W([mt("lineJoin")],N.prototype,"strokeJoin",void 0),W([mt("lineDashOffset")],N.prototype,"dashOffset",void 0),W([mt()],N.prototype,"miterLimit",void 0),W([mt()],N.prototype,"shadowBlur",void 0),W([mt()],N.prototype,"shadowColor",void 0),W([mt()],N.prototype,"shadowOffsetX",void 0),W([mt()],N.prototype,"shadowOffsetY",void 0),W([mt()],N.prototype,"filter",void 0),W([mt()],N.prototype,"font",void 0),W([mt()],N.prototype,"fontKerning",void 0),W([mt()],N.prototype,"fontStretch",void 0),W([mt()],N.prototype,"fontVariantCaps",void 0),W([mt()],N.prototype,"textAlign",void 0),W([mt()],N.prototype,"textBaseline",void 0),W([mt()],N.prototype,"textRendering",void 0),W([mt()],N.prototype,"wordSpacing",void 0),W([mt()],N.prototype,"letterSpacing",void 0),W([mt()],N.prototype,"direction",void 0),W([st()],N.prototype,"setTransform",null),W([st()],N.prototype,"resetTransform",null),W([st()],N.prototype,"getTransform",null),W([st()],N.prototype,"save",null),W([st()],N.prototype,"restore",null),W([st()],N.prototype,"translate",null),W([st()],N.prototype,"scale",null),W([st()],N.prototype,"rotate",null),W([st()],N.prototype,"fill",null),W([st()],N.prototype,"stroke",null),W([st()],N.prototype,"clip",null),W([st()],N.prototype,"fillRect",null),W([st()],N.prototype,"strokeRect",null),W([st()],N.prototype,"clearRect",null),W([st()],N.prototype,"beginPath",null),W([st()],N.prototype,"moveTo",null),W([st()],N.prototype,"lineTo",null),W([st()],N.prototype,"bezierCurveTo",null),W([st()],N.prototype,"quadraticCurveTo",null),W([st()],N.prototype,"closePath",null),W([st()],N.prototype,"arc",null),W([st()],N.prototype,"arcTo",null),W([st()],N.prototype,"ellipse",null),W([st()],N.prototype,"rect",null),W([st()],N.prototype,"roundRect",null),W([st()],N.prototype,"createConicGradient",null),W([st()],N.prototype,"createLinearGradient",null),W([st()],N.prototype,"createPattern",null),W([st()],N.prototype,"createRadialGradient",null),W([st()],N.prototype,"fillText",null),W([st()],N.prototype,"measureText",null),W([st()],N.prototype,"strokeText",null);const{copy:sd,multiplyParent:rd,pixelScale:nd}=K,{round:lr}=Math,rt=new Ot,ro=new Ot,ad={width:1,height:1,pixelRatio:1},be=["width","height","pixelRatio"];let Lh=class extends N{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap(t){this.config.pixelSnap=t}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,i){super(),this.size={},this.worldTransform={},t||(t=ad),this.manager=i,this.innerId=ti.create(ti.CNAVAS);const{width:s,height:r,pixelRatio:n}=t;this.autoLayout=!s||!r,this.size.pixelRatio=n||A.devicePixelRatio,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:i}=this.config;this.context=i?t.getContext("2d",i):t.getContext("2d"),this.__bindContext()}export(t,i){}toBlob(t,i){}toDataURL(t,i){}saveAs(t,i){}resize(t,i=!0){if(this.isSameSize(t))return;let s;this.context&&!this.unreal&&i&&this.width&&(s=this.getSameCanvas(),s.copyWorld(this));const r=this.size;gt.copyAttrs(r,t,be),be.forEach(n=>r[n]||(r[n]=1)),this.bounds=new Ot(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&s&&(this.clearWorld(s.bounds),this.copyWorld(s),s.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,i){}stopAutoLayout(){}setCursor(t){}setWorld(t,i){const{pixelRatio:s,pixelSnap:r}=this,n=this.worldTransform;i&&rd(t,i,n),nd(t,s,n),r&&!t.ignorePixelSnap&&(t.half&&t.half*s%2?(n.e=lr(n.e-.5)+.5,n.f=lr(n.f-.5)+.5):(n.e=lr(n.e),n.f=lr(n.f))),this.setTransform(n.a,n.b,n.c,n.d,n.e,n.f)}useWorldTransform(t){t&&(this.worldTransform=t);const i=this.worldTransform;i&&this.setTransform(i.a,i.b,i.c,i.d,i.e,i.f)}setStroke(t,i,s,r){i&&(this.strokeWidth=i),t&&(this.strokeStyle=t),s&&this.setStrokeOptions(s,r)}setStrokeOptions(t,i){let{strokeCap:s,strokeJoin:r,dashPattern:n,dashOffset:a,miterLimit:o}=t;i&&(i.strokeCap&&(s=i.strokeCap),i.strokeJoin&&(r=i.strokeJoin),G(i.dashPattern)||(n=i.dashPattern),G(i.dashOffset)||(a=i.dashOffset),i.miterLimit&&(o=i.miterLimit)),this.strokeCap=s,this.strokeJoin=r,this.dashPattern=n,this.dashOffset=a,this.miterLimit=o}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,i){return!0}hitStroke(t,i){return!0}hitPixel(t,i,s=1){return!0}setWorldShadow(t,i,s,r){const{pixelRatio:n}=this;this.shadowOffsetX=t*n,this.shadowOffsetY=i*n,this.shadowBlur=s*n,this.shadowColor=r||"black"}setWorldBlur(t){const{pixelRatio:i}=this;this.filter=`blur(${t*i}px)`}copyWorld(t,i,s,r,n){r&&(this.blendMode=r),i?(this.setTempPixelBounds(i,n),s?(this.setTempPixelBounds2(s,n),s=ro):s=rt,this.drawImage(t.view,rt.x,rt.y,rt.width,rt.height,s.x,s.y,s.width,s.height)):this.drawImage(t.view,0,0),r&&(this.blendMode="source-over")}copyWorldToInner(t,i,s,r,n){i.b||i.c?(this.save(),this.resetTransform(),this.copyWorld(t,i,I.tempToOuterOf(s,i),r,n),this.restore()):(r&&(this.blendMode=r),this.setTempPixelBounds(i,n),this.drawImage(t.view,rt.x,rt.y,rt.width,rt.height,s.x,s.y,s.width,s.height),r&&(this.blendMode="source-over"))}copyWorldByReset(t,i,s,r,n,a){this.resetTransform(),this.copyWorld(t,i,s,r,a),n||this.useWorldTransform()}useGrayscaleAlpha(t){let i,s;this.setTempPixelBounds(t,!0,!0);const{context:r}=this,n=r.getImageData(rt.x,rt.y,rt.width,rt.height),{data:a}=n;for(let o=0,l=a.length;o<l;o+=4)s=.299*a[o]+.587*a[o+1]+.114*a[o+2],(i=a[o+3])&&(a[o+3]=i===255?s:i*(s/255));r.putImageData(n,rt.x,rt.y)}useMask(t,i,s){this.copyWorld(t,i,s,"destination-in")}useEraser(t,i,s){this.copyWorld(t,i,s,"destination-out")}fillWorld(t,i,s,r){s&&(this.blendMode=s),this.fillStyle=i,this.setTempPixelBounds(t,r),this.fillRect(rt.x,rt.y,rt.width,rt.height),s&&(this.blendMode="source-over")}strokeWorld(t,i,s,r){s&&(this.blendMode=s),this.strokeStyle=i,this.setTempPixelBounds(t,r),this.strokeRect(rt.x,rt.y,rt.width,rt.height),s&&(this.blendMode="source-over")}clipWorld(t,i=!0){this.beginPath(),this.setTempPixelBounds(t,i),this.rect(rt.x,rt.y,rt.width,rt.height),this.clip()}clipUI(t){t.windingRule?this.clip(t.windingRule):this.clip()}clearWorld(t,i=!0){this.setTempPixelBounds(t,i),this.clearRect(rt.x,rt.y,rt.width,rt.height)}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}setTempPixelBounds(t,i,s){this.copyToPixelBounds(rt,t,i,s)}setTempPixelBounds2(t,i,s){this.copyToPixelBounds(ro,t,i,s)}copyToPixelBounds(t,i,s,r){t.set(i),r&&t.intersect(this.bounds),t.scale(this.pixelRatio),s&&t.ceil()}isSameSize(t){return this.width===t.width&&this.height===t.height&&(!t.pixelRatio||this.pixelRatio===t.pixelRatio)}getSameCanvas(t,i){const{size:s,pixelSnap:r}=this,n=this.manager?this.manager.get(s):Tt.canvas(Object.assign({},s));return n.save(),t&&(sd(n.worldTransform,this.worldTransform),n.useWorldTransform()),i&&(n.smooth=this.smooth),n.pixelSnap!==r&&(n.pixelSnap=r),n}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}};const Ae={creator:{},parse(e,t){},convertToCanvasData(e,t){}},Oh={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Be=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Oh),Mh={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ah={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},od=Object.assign(Object.assign({},Ah),Oh),Wr=Be,$h={};for(let e in Wr)$h[Wr[e]]=e;const Ca={};for(let e in Wr)Ca[Wr[e]]=Mh[e];const Ih={drawRoundRect(e,t,i,s,r,n){const a=Nt.fourNumber(n,Math.min(s/2,r/2)),o=t+s,l=i+r;a[0]?e.moveTo(t+a[0],i):e.moveTo(t,i),a[1]?e.arcTo(o,i,o,l,a[1]):e.lineTo(o,i),a[2]?e.arcTo(o,l,t,l,a[2]):e.lineTo(o,l),a[3]?e.arcTo(t,l,t,i,a[3]):e.lineTo(t,l),a[0]?e.arcTo(t,i,o,i,a[0]):e.lineTo(t,i)}},{sin:Wi,cos:ds,hypot:no,atan2:ao,ceil:ld,abs:oo,PI:lo,sqrt:ho,pow:hr}=Math,{setPoint:rn,addPoint:cr}=Hr,{set:dr,toNumberPoints:hd}=Q,{M:co,L:nn,C:an,Q:uo,Z:cd}=Be,on={},Ri={points(e,t,i,s){let r=hd(t);if(e.push(co,r[0],r[1]),i&&r.length>5){let n,a,o,l,h,d,c,u,p,_,m,v,T,$,B,X=r.length;const R=i===!0?.5:i;s&&(r=[r[X-2],r[X-1],...r,r[0],r[1],r[2],r[3]],X=r.length);for(let b=2;b<X-2;b+=2)n=r[b-2],a=r[b-1],o=r[b],l=r[b+1],h=r[b+2],d=r[b+3],m=o-n,v=l-a,T=ho(hr(m,2)+hr(v,2)),$=ho(hr(h-o,2)+hr(d-l,2)),(T||$)&&(B=T+$,T=R*T/B,$=R*$/B,h-=n,d-=a,c=o-T*h,u=l-T*d,b===2?s||e.push(uo,c,u,o,l):(m||v)&&e.push(an,p,_,c,u,o,l),p=o+$*h,_=l+$*d);s||e.push(uo,p,_,r[X-2],r[X-1])}else for(let n=2,a=r.length;n<a;n+=2)e.push(nn,r[n],r[n+1]);s&&e.push(cd)},rect(e,t,i,s,r){Ae.creator.path=e,Ae.creator.moveTo(t,i).lineTo(t+s,i).lineTo(t+s,i+r).lineTo(t,i+r).lineTo(t,i)},roundRect(e,t,i,s,r,n){Ae.creator.path=[],Ih.drawRoundRect(Ae.creator,t,i,s,r,n),e.push(...Ae.convertToCanvasData(Ae.creator.path,!0))},arcTo(e,t,i,s,r,n,a,o,l,h,d){const c=s-t,u=r-i,p=n-s,_=a-r;let m=ao(u,c),v=ao(_,p);const T=no(c,u),$=no(p,_);let B=v-m;if(B<0&&(B+=ve),T<1e-12||$<1e-12||B<1e-12||oo(B-lo)<1e-12)return e&&e.push(nn,s,r),l&&(rn(l,t,i),cr(l,s,r)),d&&dr(d,t,i),void(h&&dr(h,s,r));const X=c*_-p*u<0,R=X?-1:1,b=o/ds(B/2),E=s+b*ds(m+B/2+Qi*R),P=r+b*Wi(m+B/2+Qi*R);return m-=Qi*R,v-=Qi*R,go(e,E,P,o,o,0,m/pt,v/pt,X,l,h,d)},arc:(e,t,i,s,r,n,a,o,l,h)=>go(e,t,i,s,s,0,r,n,a,o,l,h),ellipse(e,t,i,s,r,n,a,o,l,h,d,c){const u=n*pt,p=Wi(u),_=ds(u);let m=a*pt,v=o*pt;m>lo&&(m-=ve),v<0&&(v+=ve);let T=v-m;T<0?T+=ve:T>ve&&(T-=ve),l&&(T-=ve);const $=ld(oo(T/Qi)),B=T/$,X=Wi(B/4),R=8/3*X*X/Wi(B/2);v=m+B;let b,E,P,C,z,O,M,D,H=ds(m),U=Wi(m),lt=P=_*s*H-p*r*U,Bt=C=p*s*H+_*r*U,et=t+P,ht=i+C;e&&e.push(e.length?nn:co,et,ht),h&&rn(h,et,ht),c&&dr(c,et,ht);for(let at=0;at<$;at++)b=ds(v),E=Wi(v),P=_*s*b-p*r*E,C=p*s*b+_*r*E,z=t+lt-R*(_*s*U+p*r*H),O=i+Bt-R*(p*s*U-_*r*H),M=t+P+R*(_*s*E+p*r*b),D=i+C+R*(p*s*E-_*r*b),e&&e.push(an,z,O,M,D,t+P,i+C),h&&fo(t+lt,i+Bt,z,O,M,D,t+P,i+C,h,!0),lt=P,Bt=C,H=b,U=E,m=v,v+=B;d&&dr(d,t+P,i+C)},quadraticCurveTo(e,t,i,s,r,n,a){e.push(an,(t+2*s)/3,(i+2*r)/3,(n+2*s)/3,(a+2*r)/3,n,a)},toTwoPointBoundsByQuadraticCurve(e,t,i,s,r,n,a,o){fo(e,t,(e+2*i)/3,(t+2*s)/3,(r+2*i)/3,(n+2*s)/3,r,n,a,o)},toTwoPointBounds(e,t,i,s,r,n,a,o,l,h){const d=[];let c,u,p,_,m,v,T,$,B=e,X=i,R=r,b=a;for(let E=0;E<2;++E)if(E==1&&(B=t,X=s,R=n,b=o),c=-3*B+9*X-9*R+3*b,u=6*B-12*X+6*R,p=3*X-3*B,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;_=-p/u,0<_&&_<1&&d.push(_)}else T=u*u-4*p*c,$=Math.sqrt(T),T<0||(m=(-u+$)/(2*c),0<m&&m<1&&d.push(m),v=(-u-$)/(2*c),0<v&&v<1&&d.push(v));h?cr(l,e,t):rn(l,e,t),cr(l,a,o);for(let E=0,P=d.length;E<P;E++)po(d[E],e,t,i,s,r,n,a,o,on),cr(l,on.x,on.y)},getPointAndSet(e,t,i,s,r,n,a,o,l,h){const d=1-e,c=d*d*d,u=3*d*d*e,p=3*d*e*e,_=e*e*e;h.x=c*t+u*s+p*n+_*o,h.y=c*i+u*r+p*a+_*l},getPoint(e,t,i,s,r,n,a,o,l){const h={};return po(e,t,i,s,r,n,a,o,l,h),h},getDerivative(e,t,i,s,r){const n=1-e;return 3*n*n*(i-t)+6*n*e*(s-i)+3*e*e*(r-s)}},{getPointAndSet:po,toTwoPointBounds:fo,ellipse:go}=Ri,{sin:dd,cos:ud,sqrt:_o,atan2:yo}=Math,{ellipse:pd}=Ri,fd={ellipticalArc(e,t,i,s,r,n,a,o,l,h,d){const c=(l-t)/2,u=(h-i)/2,p=n*pt,_=dd(p),m=ud(p),v=-m*c-_*u,T=-m*u+_*c,$=s*s,B=r*r,X=T*T,R=v*v,b=$*B-$*X-B*R;let E=0;if(b<0){const lt=_o(1-b/($*B));s*=lt,r*=lt}else E=(a===o?-1:1)*_o(b/($*X+B*R));const P=E*s*T/r,C=-E*r*v/s,z=yo((T-C)/r,(v-P)/s),O=yo((-T-C)/r,(-v-P)/s);let M=O-z;o===0&&M>0?M-=ve:o===1&&M<0&&(M+=ve);const D=t+c+m*P-_*C,H=i+u+_*P+m*C,U=M<0?1:0;d||A.ellipseToCurve?pd(e,D,H,s,r,n,z/pt,O/pt,U):s!==r||n?e.push(Be.G,D,H,s,r,n,z/pt,O/pt,U):e.push(Be.O,D,H,s,z/pt,O/pt,U)}},gd={toCommand:e=>[],toNode:e=>[]},{M:ln,m:_d,L:us,l:yd,H:md,h:vd,V:xd,v:wd,C:Ni,c:bd,S:hn,s:kd,Q:zi,q:Sd,T:cn,t:Td,A:Ed,a:Cd,Z:dn,z:Bd,N:Pd,D:Rd,X:Ld,G:Od,F:Md,O:Ad,P:$d,U:Id}=Be,{rect:Dd,roundRect:mo,arcTo:Wd,arc:vo,ellipse:xo,quadraticCurveTo:wo}=Ri,{ellipticalArc:Nd}=fd,zd=yt.get("PathConvert"),Fe={},Oi={current:{dot:0},stringify(e,t){let i,s,r,n=0,a=e.length,o="";for(;n<a;){s=e[n],i=Ca[s],o+=s===r?" ":$h[s];for(let l=1;l<i;l++)o+=Nt.float(e[n+l],t),l===i-1||(o+=" ");r=s,n+=i}return o},parse(e,t){let i,s,r,n="";const a=[],o=t?od:Ah;for(let l=0,h=e.length;l<h;l++)s=e[l],Zc[s]?(s==="."&&(de.dot&&(xi(a,n),n=""),de.dot++),n==="0"&&s!=="."&&(xi(a,n),n=""),n+=s):Be[s]?(n&&(xi(a,n),n=""),de.name=Be[s],de.length=Mh[s],de.index=0,xi(a,de.name),!i&&o[s]&&(i=!0)):s==="-"||s==="+"?r==="e"||r==="E"?n+=s:(n&&xi(a,n),n=s):n&&(xi(a,n),n=""),r=s;return n&&xi(a,n),i?Oi.toCanvasData(a,t):a},toCanvasData(e,t){let i,s,r,n,a,o=0,l=0,h=0,d=0,c=0,u=e.length;const p=[];for(;c<u;){switch(r=e[c],r){case _d:e[c+1]+=o,e[c+2]+=l;case ln:o=e[c+1],l=e[c+2],p.push(ln,o,l),c+=3;break;case vd:e[c+1]+=o;case md:o=e[c+1],p.push(us,o,l),c+=2;break;case wd:e[c+1]+=l;case xd:l=e[c+1],p.push(us,o,l),c+=2;break;case yd:e[c+1]+=o,e[c+2]+=l;case us:o=e[c+1],l=e[c+2],p.push(us,o,l),c+=3;break;case kd:e[c+1]+=o,e[c+2]+=l,e[c+3]+=o,e[c+4]+=l,r=hn;case hn:a=n===Ni||n===hn,h=a?2*o-i:e[c+1],d=a?2*l-s:e[c+2],i=e[c+1],s=e[c+2],o=e[c+3],l=e[c+4],p.push(Ni,h,d,i,s,o,l),c+=5;break;case bd:e[c+1]+=o,e[c+2]+=l,e[c+3]+=o,e[c+4]+=l,e[c+5]+=o,e[c+6]+=l,r=Ni;case Ni:i=e[c+3],s=e[c+4],o=e[c+5],l=e[c+6],p.push(Ni,e[c+1],e[c+2],i,s,o,l),c+=7;break;case Td:e[c+1]+=o,e[c+2]+=l,r=cn;case cn:a=n===zi||n===cn,i=a?2*o-i:e[c+1],s=a?2*l-s:e[c+2],t?wo(p,o,l,i,s,e[c+1],e[c+2]):p.push(zi,i,s,e[c+1],e[c+2]),o=e[c+1],l=e[c+2],c+=3;break;case Sd:e[c+1]+=o,e[c+2]+=l,e[c+3]+=o,e[c+4]+=l,r=zi;case zi:i=e[c+1],s=e[c+2],t?wo(p,o,l,i,s,e[c+3],e[c+4]):p.push(zi,i,s,e[c+3],e[c+4]),o=e[c+3],l=e[c+4],c+=5;break;case Cd:e[c+6]+=o,e[c+7]+=l;case Ed:Nd(p,o,l,e[c+1],e[c+2],e[c+3],e[c+4],e[c+5],e[c+6],e[c+7],t),o=e[c+6],l=e[c+7],c+=8;break;case Bd:case dn:p.push(dn),c++;break;case Pd:o=e[c+1],l=e[c+2],t?Dd(p,o,l,e[c+3],e[c+4]):si(p,e,c,5),c+=5;break;case Rd:o=e[c+1],l=e[c+2],t?mo(p,o,l,e[c+3],e[c+4],[e[c+5],e[c+6],e[c+7],e[c+8]]):si(p,e,c,9),c+=9;break;case Ld:o=e[c+1],l=e[c+2],t?mo(p,o,l,e[c+3],e[c+4],e[c+5]):si(p,e,c,6),c+=6;break;case Od:xo(t?p:si(p,e,c,9),e[c+1],e[c+2],e[c+3],e[c+4],e[c+5],e[c+6],e[c+7],e[c+8],null,Fe),o=Fe.x,l=Fe.y,c+=9;break;case Md:t?xo(p,e[c+1],e[c+2],e[c+3],e[c+4],0,0,360,!1):si(p,e,c,5),o=e[c+1]+e[c+3],l=e[c+2],c+=5;break;case Ad:vo(t?p:si(p,e,c,7),e[c+1],e[c+2],e[c+3],e[c+4],e[c+5],e[c+6],null,Fe),o=Fe.x,l=Fe.y,c+=7;break;case $d:t?vo(p,e[c+1],e[c+2],e[c+3],0,360,!1):si(p,e,c,4),o=e[c+1]+e[c+3],l=e[c+2],c+=4;break;case Id:Wd(t?p:si(p,e,c,6),o,l,e[c+1],e[c+2],e[c+3],e[c+4],e[c+5],null,Fe),o=Fe.x,l=Fe.y,c+=6;break;default:return zd.error(`command: ${r} [index:${c}]`,e),p}n=r}return p},objectToCanvasData(e){if(e[0].name.length>1)return gd.toCommand(e);{const t=[];return e.forEach(i=>{switch(i.name){case"M":t.push(ln,i.x,i.y);break;case"L":t.push(us,i.x,i.y);break;case"C":t.push(Ni,i.x1,i.y1,i.x2,i.y2,i.x,i.y);break;case"Q":t.push(zi,i.x1,i.y1,i.x,i.y);break;case"Z":t.push(dn)}}),t}},copyData(e,t,i,s){for(let r=i,n=i+s;r<n;r++)e.push(t[r])},pushData(e,t){de.index===de.length&&(de.index=1,e.push(de.name)),e.push(Number(t)),de.index++,de.dot=0}},{current:de,pushData:xi,copyData:si}=Oi,{M:un,L:Fd,C:Hd,Q:Yd,Z:Vd,N:bo,D:qd,X:Xd,G:Gd,F:jd,O:Ud,P:Kd,U:Qd}=Be,{getMinDistanceFrom:Jd,getRadianFrom:Zd}=Q,{tan:tu,min:ko,abs:eu}=Math,Fi={},Ai={beginPath(e){e.length=0},moveTo(e,t,i){e.push(un,t,i)},lineTo(e,t,i){e.push(Fd,t,i)},bezierCurveTo(e,t,i,s,r,n,a){e.push(Hd,t,i,s,r,n,a)},quadraticCurveTo(e,t,i,s,r){e.push(Yd,t,i,s,r)},closePath(e){e.push(Vd)},rect(e,t,i,s,r){e.push(bo,t,i,s,r)},roundRect(e,t,i,s,r,n){if(St(n))e.push(Xd,t,i,s,r,n);else{const a=Nt.fourNumber(n);a?e.push(qd,t,i,s,r,...a):e.push(bo,t,i,s,r)}},ellipse(e,t,i,s,r,n,a,o,l){if(s===r)return So(e,t,i,s,a,o,l);ye(n)?e.push(jd,t,i,s,r):(ye(a)&&(a=0),ye(o)&&(o=360),e.push(Gd,t,i,s,r,n,a,o,l?1:0))},arc(e,t,i,s,r,n,a){ye(r)?e.push(Kd,t,i,s):(ye(r)&&(r=0),ye(n)&&(n=360),e.push(Ud,t,i,s,r,n,a?1:0))},arcTo(e,t,i,s,r,n,a,o){if(!G(a)){const l=Jd(a,o,t,i,s,r);n=ko(n,ko(l/2,l/2*eu(tu(Zd(a,o,t,i,s,r)/2))))}e.push(Qd,t,i,s,r,n)},drawEllipse(e,t,i,s,r,n,a,o,l){Ri.ellipse(null,t,i,s,r,ye(n)?0:n,ye(a)?0:a,ye(o)?360:o,l,null,null,Fi),e.push(un,Fi.x,Fi.y),iu(e,t,i,s,r,n,a,o,l)},drawArc(e,t,i,s,r,n,a){Ri.arc(null,t,i,s,ye(r)?0:r,ye(n)?360:n,a,null,null,Fi),e.push(un,Fi.x,Fi.y),So(e,t,i,s,r,n,a)},drawPoints(e,t,i,s){Ri.points(e,t,i,s)}},{ellipse:iu,arc:So}=Ai,{moveTo:su,lineTo:ru,quadraticCurveTo:nu,bezierCurveTo:au,closePath:ou,beginPath:lu,rect:hu,roundRect:cu,ellipse:du,arc:uu,arcTo:pu,drawEllipse:fu,drawArc:gu,drawPoints:_u}=Ai;class Dh{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?Et(t)?Ae.parse(t):t:[],this}beginPath(){return lu(this.__path),this.paint(),this}moveTo(t,i){return su(this.__path,t,i),this.paint(),this}lineTo(t,i){return ru(this.__path,t,i),this.paint(),this}bezierCurveTo(t,i,s,r,n,a){return au(this.__path,t,i,s,r,n,a),this.paint(),this}quadraticCurveTo(t,i,s,r){return nu(this.__path,t,i,s,r),this.paint(),this}closePath(){return ou(this.__path),this.paint(),this}rect(t,i,s,r){return hu(this.__path,t,i,s,r),this.paint(),this}roundRect(t,i,s,r,n){return cu(this.__path,t,i,s,r,n),this.paint(),this}ellipse(t,i,s,r,n,a,o,l){return du(this.__path,t,i,s,r,n,a,o,l),this.paint(),this}arc(t,i,s,r,n,a){return uu(this.__path,t,i,s,r,n,a),this.paint(),this}arcTo(t,i,s,r,n){return pu(this.__path,t,i,s,r,n),this.paint(),this}drawEllipse(t,i,s,r,n,a,o,l){return fu(this.__path,t,i,s,r,n,a,o,l),this.paint(),this}drawArc(t,i,s,r,n,a){return gu(this.__path,t,i,s,r,n,a),this.paint(),this}drawPoints(t,i,s){return _u(this.__path,t,i,s),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:yu,L:mu,C:vu,Q:xu,Z:wu,N:bu,D:ku,X:Su,G:Tu,F:Eu,O:Cu,P:Bu,U:Pu}=Be,Ru=yt.get("PathDrawer"),Lu={drawPathByData(e,t){if(!t)return;let i,s=0,r=t.length;for(;s<r;)switch(i=t[s],i){case yu:e.moveTo(t[s+1],t[s+2]),s+=3;break;case mu:e.lineTo(t[s+1],t[s+2]),s+=3;break;case vu:e.bezierCurveTo(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6]),s+=7;break;case xu:e.quadraticCurveTo(t[s+1],t[s+2],t[s+3],t[s+4]),s+=5;break;case wu:e.closePath(),s+=1;break;case bu:e.rect(t[s+1],t[s+2],t[s+3],t[s+4]),s+=5;break;case ku:e.roundRect(t[s+1],t[s+2],t[s+3],t[s+4],[t[s+5],t[s+6],t[s+7],t[s+8]]),s+=9;break;case Su:e.roundRect(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]),s+=6;break;case Tu:e.ellipse(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]*pt,t[s+6]*pt,t[s+7]*pt,t[s+8]),s+=9;break;case Eu:e.ellipse(t[s+1],t[s+2],t[s+3],t[s+4],0,0,ve,!1),s+=5;break;case Cu:e.arc(t[s+1],t[s+2],t[s+3],t[s+4]*pt,t[s+5]*pt,t[s+6]),s+=7;break;case Bu:e.arc(t[s+1],t[s+2],t[s+3],0,ve,!1),s+=4;break;case Pu:e.arcTo(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]),s+=6;break;default:return void Ru.error(`command: ${i} [index:${s}]`,t)}}},{M:Ou,L:Mu,C:To,Q:Eo,Z:Co,N:Au,D:Bo,X:$u,G:Iu,F:Du,O:Wu,P:Nu,U:zu}=Be,{toTwoPointBounds:Fu,toTwoPointBoundsByQuadraticCurve:Hu,arcTo:Yu,arc:Vu,ellipse:qu}=Ri,{addPointBounds:ps,copy:pn,addPoint:Xu,setPoint:fn,addBounds:ur,toBounds:Gu}=Hr,ju=yt.get("PathBounds");let Hi,pr,gn;const ie={},Po={},He={},Wh={toBounds(e,t){Wh.toTwoPointBounds(e,Po),Gu(Po,t)},toTwoPointBounds(e,t){if(!e||!e.length)return fn(t,0,0);let i,s,r,n,a,o=0,l=0,h=0;const d=e.length;for(;o<d;)switch(a=e[o],o===0&&(a===Co||a===To||a===Eo?fn(t,l,h):fn(t,e[o+1],e[o+2])),a){case Ou:case Mu:l=e[o+1],h=e[o+2],Xu(t,l,h),o+=3;break;case To:r=e[o+5],n=e[o+6],Fu(l,h,e[o+1],e[o+2],e[o+3],e[o+4],r,n,ie),ps(t,ie),l=r,h=n,o+=7;break;case Eo:i=e[o+1],s=e[o+2],r=e[o+3],n=e[o+4],Hu(l,h,i,s,r,n,ie),ps(t,ie),l=r,h=n,o+=5;break;case Co:o+=1;break;case Au:l=e[o+1],h=e[o+2],ur(t,l,h,e[o+3],e[o+4]),o+=5;break;case Bo:case $u:l=e[o+1],h=e[o+2],ur(t,l,h,e[o+3],e[o+4]),o+=a===Bo?9:6;break;case Iu:qu(null,e[o+1],e[o+2],e[o+3],e[o+4],e[o+5],e[o+6],e[o+7],e[o+8],ie,He),o===0?pn(t,ie):ps(t,ie),l=He.x,h=He.y,o+=9;break;case Du:l=e[o+1],h=e[o+2],pr=e[o+3],gn=e[o+4],ur(t,l-pr,h-gn,2*pr,2*gn),l+=pr,o+=5;break;case Wu:Vu(null,e[o+1],e[o+2],e[o+3],e[o+4],e[o+5],e[o+6],ie,He),o===0?pn(t,ie):ps(t,ie),l=He.x,h=He.y,o+=7;break;case Nu:l=e[o+1],h=e[o+2],Hi=e[o+3],ur(t,l-Hi,h-Hi,2*Hi,2*Hi),l+=Hi,o+=4;break;case zu:Yu(null,l,h,e[o+1],e[o+2],e[o+3],e[o+4],e[o+5],ie,He),o===0?pn(t,ie):ps(t,ie),l=He.x,h=He.y,o+=6;break;default:return void ju.error(`command: ${a} [index:${o}]`,e)}}},{M:_n,L:fr,Z:fs}=Be,{getCenterX:Uu,getCenterY:Ku}=Q,{arcTo:yn}=Ai,Qu={smooth(e,t,i){let s,r,n,a=0,o=0,l=0,h=0,d=0,c=0,u=0,p=0,_=0;Lt(t)&&(t=t[0]||0);const m=e.length,v=[];for(;a<m;){switch(s=e[a],s){case _n:h=p=e[a+1],d=_=e[a+2],a+=3,e[a]===fr?(c=e[a+1],u=e[a+2],v.push(_n,Uu(h,c),Ku(d,u))):v.push(_n,h,d);break;case fr:switch(o=e[a+1],l=e[a+2],a+=3,e[a]){case fr:yn(v,o,l,e[a+1],e[a+2],t,p,_);break;case fs:yn(v,o,l,h,d,t,p,_);break;default:v.push(fr,o,l)}p=o,_=l;break;case fs:r!==fs&&(yn(v,h,d,c,u,t,p,_),v.push(fs)),a+=1;break;default:n=Ca[s];for(let T=0;T<n;T++)v.push(e[a+T]);a+=n}r=s}return s!==fs&&(v[1]=h,v[2]=d),v}};function Nh(e){return new Dh(e)}const gs=Nh();Ae.creator=Nh(),Ae.parse=Oi.parse,Ae.convertToCanvasData=Oi.toCanvasData;const{drawRoundRect:Ju}=Ih;function Ro(e){(function(t){t&&!t.roundRect&&(t.roundRect=function(i,s,r,n,a){Ju(this,i,s,r,n,a)})})(e)}const Ds={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:e=>!e||e.startsWith("image")?e:(e==="jpg"&&(e="jpeg"),"image/"+e),fileType(e){const t=e.split(".");return t[t.length-1]},isOpaqueImage(e){const t=oa.fileType(e);return["jpg","jpeg"].some(i=>i===t)},getExportOptions(e){switch(typeof e){case"object":return e;case"number":return{quality:e};case"boolean":return{blob:e};default:return{}}}},oa=Ds;oa.alphaPixelTypes.forEach(e=>oa.upperCaseTypeMap[e]=e.toUpperCase());const Zu=yt.get("TaskProcessor");let tp=class{constructor(t){this.parallel=!0,this.time=1,this.id=ti.create(ti.TASK),this.task=t}run(){return Ph(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch(t){Zu.error(t)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}},zh=class{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let i=0,s=0;for(let r=0;r<t;r++)r<=this.finishedIndex?(s+=this.list[r].time,r===this.finishedIndex&&(i=s)):i+=this.list[r].time;return this.isComplete?1:s/i}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&gt.assign(this.config,t),this.empty()}add(t,i,s){let r,n,a,o;const l=new tp(t);return l.parent=this,St(i)?o=i:i&&(n=i.parallel,r=i.start,a=i.time,o=i.delay,s||(s=i.canUse)),a&&(l.time=a),n===!1&&(l.parallel=!1),s&&(l.canUse=s),G(o)?this.push(l,r):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(l,r))},o)),this.isComplete=!1,l}push(t,i){this.list.push(t),i===!1||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then(()=>{this.onTask(t),this.index++,t.isCancel?this.runTask():this.nextTask()}).catch(i=>{this.onError(i)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(i=>{this.onParallelError(i)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;const{config:i,list:s,index:r}=this;this.parallelList=[],this.parallelSuccessNumber=0;let n=r+i.parallel;if(n>s.length&&(n=s.length),i.parallel>1)for(let a=r;a<n&&(t=s[a],t.parallel);a++)this.parallelList.push(t)}fillParallelTask(){let t;const i=this.parallelList;this.parallelSuccessNumber++,i.pop();const s=i.length,r=this.finishedIndex+s;if(i.length){if(!this.running)return;r<this.total&&(t=this.list[r],t&&t.parallel&&(i.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(i=>{i.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}};const ep=yt.get("Resource"),Pi={tasker:new zh,map:{},get isComplete(){return ri.tasker.isComplete},set(e,t){ri.map[e]&&ep.repeat(e),ri.map[e]=t},get:e=>ri.map[e],remove(e){const t=ri.map[e];t&&(t.destroy&&t.destroy(),delete ri.map[e])},loadImage(e,t){return new Promise((i,s)=>{const r=this.setImage(e,e,t);r.load(()=>i(r),n=>s(n))})},setImage(e,t,i){let s;return Et(t)?s={url:t}:t.url||(s={url:e,view:t}),s&&(i&&(s.format=i),t=Tt.image(s)),ri.set(e,t),t},destroy(){ri.map={}}},ri=Pi,Ee={maxRecycled:10,recycledList:[],patternTasker:new zh({parallel:1}),get(e){let t=Pi.get(e.url);return t||Pi.set(e.url,t=Tt.image(e)),t.use++,t},recycle(e){e.use--,setTimeout(()=>{e.use||(A.image.isLarge(e)?e.url&&Pi.remove(e.url):(e.clearLevels(),_s.recycledList.push(e)))})},recyclePaint(e){_s.recycle(e.image)},clearRecycled(e){const t=_s.recycledList;(t.length>_s.maxRecycled||e)&&(t.forEach(i=>(!i.use||e)&&i.url&&Pi.remove(i.url)),t.length=0)},clearLevels(){},hasAlphaPixel:e=>Ds.alphaPixelTypes.some(t=>_s.isFormat(t,e)),isFormat(e,t){if(t.format)return t.format===e;const{url:i}=t;if(i.startsWith("data:")){if(i.startsWith("data:"+Ds.mineType(e)))return!0}else if(i.includes("."+e)||i.includes("."+Ds.upperCaseTypeMap[e])||e==="png"&&!i.includes("."))return!0;return!1},destroy(){this.clearRecycled(!0)}},_s=Ee,{IMAGE:ip,create:sp}=ti;class Fh{get url(){return this.config.url}get crossOrigin(){const{crossOrigin:t}=this.config;return G(t)?A.image.crossOrigin:t}get completed(){return this.ready||!!this.error}constructor(t){if(this.use=0,this.waitComplete=[],this.innerId=sp(ip),this.config=t||(t={url:""}),t.view){const{view:i}=t;this.setView(i.config?i.view:i)}Ee.isFormat("svg",t)&&(this.isSVG=!0),Ee.hasAlphaPixel(t)&&(this.hasAlphaPixel=!0)}load(t,i,s){return this.loading||(this.loading=!0,Pi.tasker.add(()=>Ph(this,void 0,void 0,function*(){return yield A.origin.loadImage(this.getLoadUrl(s),this.crossOrigin,this).then(r=>{s&&this.setThumbView(r),this.setView(r)}).catch(r=>{this.error=r,this.onComplete(!1)})}))),this.waitComplete.push(t,i),this.waitComplete.length-2}unload(t,i){const s=this.waitComplete;if(i){const r=s[t+1];r&&r({type:"stop"})}s[t]=s[t+1]=void 0}setView(t){this.ready=!0,this.width||(this.width=t.width,this.height=t.height,this.view=t),this.onComplete(!0)}onComplete(t){let i;this.waitComplete.forEach((s,r)=>{i=r%2,s&&(t?i||s(this):i&&s(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(t){return this.view}getCanvas(t,i,s,r,n,a,o,l){if(t||(t=this.width),i||(i=this.height),this.cache){let{params:d,data:c}=this.cache;for(let u in d)if(d[u]!==arguments[u]){c=null;break}if(c)return c}const h=A.image.resize(this.view,t,i,n,a,void 0,o,s,r,l);return this.cache=this.use>1?{data:h,params:arguments}:null,h}getPattern(t,i,s,r){const n=A.canvas.createPattern(t,i);return A.image.setPatternTransform(n,s,r),n}getLoadUrl(t){return this.url}setThumbView(t){}getThumbSize(t){}getMinLevel(){}getLevelData(t,i,s){}clearLevels(t){}destroy(){this.clearLevels();const{view:t}=this;t&&t.close&&t.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}function as(e,t,i,s){i.configurable=i.enumerable=!0,Object.defineProperty(e,t,i)}function Hh(e,t){return Object.getOwnPropertyDescriptor(e,t)}function rp(e,t){const i="_"+e;return{get(){const s=this[i];return s??t},set(s){this[i]=s}}}function Ct(e,t){return(i,s)=>np(i,s,e,t&&t(s))}function np(e,t,i,s){as(e,t,Object.assign({get(){return this.__getAttr(t)},set(n){this.__setAttr(t,n)}},s||{})),Vh(e,t,i)}function Ut(e){return Ct(e)}function gr(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s,t)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function Lo(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s,t)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function Oo(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),os(this))}}))}function Mo(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s,t)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function mn(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s,t)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function tt(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s,t)&&os(this)}}))}function ap(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(os(this),this.__.__removeNaturalSize())}}))}function os(e){e.__layout.boxChanged||e.__layout.boxChange(),e.__hasAutoLayout&&(e.__layout.matrixChanged||e.__layout.matrixChange())}function op(e){return Ct(e,t=>({set(i){const s=this.__;s.__pathInputed!==2&&(s.__pathInputed=i?1:0),i||(s.__pathForRender=void 0),this.__setAttr(t,i),os(this)}}))}const Vt=tt;function Yr(e,t){return Ct(e,i=>({set(s){this.__setAttr(i,s)&&(lp(this),t&&(this.__.__useStroke=!0))}}))}function lp(e){e.__layout.strokeChanged||e.__layout.strokeChange(),e.__.__useArrow&&os(e)}const Le=Yr;function Ba(e){return Ct(e,t=>({set(i){this.__setAttr(t,i),this.__layout.renderChanged||this.__layout.renderChange()}}))}function li(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Ao(e){return Ct(e,t=>({set(i){if(this.__setAttr(t,i)){const s=this.__;gt.stintSet(s,"__useDim",s.dim||s.bright||s.dimskip),this.__layout.surfaceChange()}}}))}function hp(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&Yh(this)}}))}function cp(e){return Ct(e,t=>({set(i){const s=this.visible;if(s===!0&&i===0){if(this.animationOut)return this.__runAnimation("out",()=>$o(this,t,i,s))}else s===0&&i===!0&&this.animation&&this.__runAnimation("in");$o(this,t,i,s),this.mask&&Yh(this)}}))}function Yh(e){const{parent:t}=e;if(t){const{__hasMask:i}=t;t.__updateMask(),i!==t.__hasMask&&t.forceUpdate()}}function $o(e,t,i,s){e.__setAttr(t,i)&&(e.__layout.opacityChanged||e.__layout.opacityChange(),s!==0&&i!==0||os(e))}function dp(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function up(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(i)}))}}))}function pp(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&this.waitParent(()=>{this.parent.__updateEraser(i)})}}))}function Ti(e){return Ct(e,t=>({set(i){this.__setAttr(t,i)&&(this.__layout.hitCanvasChanged=!0,yt.showBounds==="hit"&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function fp(e){return Ct(e,t=>({set(i){this.__setAttr(t,i),this.leafer&&this.leafer.updateCursor()}}))}function zt(e){return(t,i)=>{as(t,"__DataProcessor",{get:()=>e})}}function Vh(e,t,i){const s=e.__DataProcessor.prototype,r="_"+t,n=(function(d){return"set"+d.charAt(0).toUpperCase()+d.slice(1)})(t),a=rp(t,i);if(G(i))a.get=function(){return this[r]};else if(typeof i=="function")a.get=function(){const d=this[r];return d??i(this.__leaf)};else if(_t(i)){const d=Wc(i);a.get=function(){const c=this[r];return c??(this[r]=d?{}:gt.clone(i))}}const o=e.isBranchLeaf;t==="width"?a.get=function(){const d=this[r];if(d==null){const c=this,u=c.__naturalWidth,p=c.__leaf;return!i||p.pathInputed?p.boxBounds.width:u?c._height&&c.__useNaturalRatio?c._height*u/c.__naturalHeight:u:o&&p.children.length?p.boxBounds.width:i}return d}:t==="height"&&(a.get=function(){const d=this[r];if(d==null){const c=this,u=c.__naturalHeight,p=c.__leaf;return!i||p.pathInputed?p.boxBounds.height:u?c._width&&c.__useNaturalRatio?c._width*u/c.__naturalWidth:u:o&&p.children.length?p.boxBounds.height:i}return d});let l,h=s;for(;!l&&h;)l=Hh(h,t),h=h.__proto__;l&&l.set&&(a.set=l.set),s[n]&&(a.set=s[n],delete s[n]),as(s,t,a)}const gp=new yt("rewrite"),Or=[],_p=["destroy","constructor"];function Ke(e){return(t,i)=>{Or.push({name:t.constructor.name+"."+i,run:()=>{t[i]=e}})}}function Vr(){return e=>{qh()}}function qh(e){Or.length&&(Or.forEach(t=>{e&&gp.error(t.name,"éœ€åœ¨Classä¸Šè£…é¥°@rewriteAble()"),t.run()}),Or.length=0)}function ke(e,t){return i=>{var s;(e.prototype?(s=e.prototype,Object.getOwnPropertyNames(s)):Object.keys(e)).forEach(r=>{_p.includes(r)||t&&t.includes(r)||(e.prototype?Hh(e.prototype,r).writable&&(i.prototype[r]=e.prototype[r]):i.prototype[r]=e[r])})}}function Ft(){return e=>{Ys.register(e)}}function ei(){return e=>{ss.register(e)}}setTimeout(()=>qh(!0));const{copy:Yi,toInnerPoint:yp,toOuterPoint:mp,scaleOfOuter:Io,rotateOfOuter:vp,skewOfOuter:xp,multiplyParent:Do,divideParent:Wo,getLayout:wp}=K,wt={},{round:No}=Math,At={updateAllMatrix(e,t,i){if(t&&e.__hasAutoLayout&&e.__layout.matrixChanged&&(i=!0),kp(e,t,i),e.isBranch){const{children:s}=e;for(let r=0,n=s.length;r<n;r++)bp(s[r],t,i)}},updateMatrix(e,t,i){const s=e.__layout;t?i&&(s.waitAutoLayout=!0,e.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&e.__updateLocalMatrix(),s.waitAutoLayout||e.__updateWorldMatrix()},updateBounds(e){const t=e.__layout;t.boundsChanged&&e.__updateLocalBounds(),t.waitAutoLayout||e.__updateWorldBounds()},updateAllWorldOpacity(e){if(e.__updateWorldOpacity(),e.isBranch){const{children:t}=e;for(let i=0,s=t.length;i<s;i++)zo(t[i])}},updateChange(e){const t=e.__layout;t.stateStyleChanged&&e.updateState(),t.opacityChanged&&zo(e),e.__updateChange()},updateAllChange(e){if(Tp(e),e.isBranch){const{children:t}=e;for(let i=0,s=t.length;i<s;i++)Sp(t[i])}},worldHittable(e){for(;e;){if(!e.__.hittable)return!1;e=e.parent}return!0},draggable:e=>(e.draggable||e.editable)&&e.hitSelf&&!e.locked,copyCanvasByWorld(e,t,i,s,r,n){s||(s=e.__nowWorld),e.__worldFlipped||A.fullImageShadow?t.copyWorldByReset(i,s,e.__nowWorld,r,n):t.copyWorldToInner(i,s,e.__layout.renderBounds,r)},moveWorld(e,t,i=0,s,r){const n=_t(t)?Object.assign({},t):{x:t,y:i};s?mp(e.localTransform,n,n,!0):e.parent&&yp(e.parent.scrollWorldTransform,n,n,!0),Pt.moveLocal(e,n.x,n.y,r)},moveLocal(e,t,i=0,s){_t(t)&&(i=t.y,t=t.x),t+=e.x,i+=e.y,e.leafer&&e.leafer.config.pointSnap&&(t=No(t),i=No(i)),s?e.animate({x:t,y:i},s):(e.x=t,e.y=i)},zoomOfWorld(e,t,i,s,r,n){Pt.zoomOfLocal(e,vn(e,t),i,s,r,n)},zoomOfLocal(e,t,i,s=i,r,n){const a=e.__localMatrix;if(St(s)||(s&&(n=s),s=i),Yi(wt,a),Io(wt,t,i,s),Pt.hasHighPosition(e))Pt.setTransform(e,wt,r,n);else{const o=e.x+wt.e-a.e,l=e.y+wt.f-a.f;n&&!r?e.animate({x:o,y:l,scaleX:e.scaleX*i,scaleY:e.scaleY*s},n):(e.x=o,e.y=l,e.scaleResize(i,s,r!==!0))}},rotateOfWorld(e,t,i,s){Pt.rotateOfLocal(e,vn(e,t),i,s)},rotateOfLocal(e,t,i,s){const r=e.__localMatrix;Yi(wt,r),vp(wt,t,i),Pt.hasHighPosition(e)?Pt.setTransform(e,wt,!1,s):e.set({x:e.x+wt.e-r.e,y:e.y+wt.f-r.f,rotation:Nt.formatRotation(e.rotation+i)},s)},skewOfWorld(e,t,i,s,r,n){Pt.skewOfLocal(e,vn(e,t),i,s,r,n)},skewOfLocal(e,t,i,s=0,r,n){Yi(wt,e.__localMatrix),xp(wt,t,i,s),Pt.setTransform(e,wt,r,n)},transformWorld(e,t,i,s){Yi(wt,e.worldTransform),Do(wt,t),e.parent&&Wo(wt,e.parent.scrollWorldTransform),Pt.setTransform(e,wt,i,s)},transform(e,t,i,s){Yi(wt,e.localTransform),Do(wt,t),Pt.setTransform(e,wt,i,s)},setTransform(e,t,i,s){const r=e.__,n=r.origin&&Pt.getInnerOrigin(e,r.origin),a=wp(t,n,r.around&&Pt.getInnerOrigin(e,r.around));if(Pt.hasOffset(e)&&(a.x-=r.offsetX,a.y-=r.offsetY),i){const o=a.scaleX/e.scaleX,l=a.scaleY/e.scaleY;if(delete a.scaleX,delete a.scaleY,n){I.scale(e.boxBounds,Math.abs(o),Math.abs(l));const h=Pt.getInnerOrigin(e,r.origin);Q.move(a,n.x-h.x,n.y-h.y)}e.set(a),e.scaleResize(o,l,!1)}else e.set(a,s)},getFlipTransform(e,t){const i={a:1,b:0,c:0,d:1,e:0,f:0},s=t==="x"?1:-1;return Io(i,Pt.getLocalOrigin(e,"center"),-1*s,1*s),i},getLocalOrigin:(e,t)=>Q.tempToOuterOf(Pt.getInnerOrigin(e,t),e.localTransform),getInnerOrigin(e,t){const i={};return Mi.toPoint(t,e.boxBounds,i),i},getRelativeWorld:(e,t,i)=>(Yi(wt,e.worldTransform),Wo(wt,t.scrollWorldTransform),i?wt:Object.assign({},wt)),drop(e,t,i,s){e.setTransform(Pt.getRelativeWorld(e,t,!0),s),t.add(e,i)},hasHighPosition:e=>e.origin||e.around||Pt.hasOffset(e),hasOffset:e=>e.offsetX||e.offsetY,hasParent(e,t){if(!t)return!1;for(;e;){if(t===e)return!0;e=e.parent}},animateMove(e,t,i=.3){if(t.x||t.y)if(Math.abs(t.x)<1&&Math.abs(t.y)<1)e.move(t);else{const s=t.x*i,r=t.y*i;t.x-=s,t.y-=r,e.move(s,r),A.requestRender(()=>Pt.animateMove(e,t,i))}}},Pt=At,{updateAllMatrix:bp,updateMatrix:kp,updateAllWorldOpacity:zo,updateAllChange:Sp,updateChange:Tp}=Pt;function vn(e,t){return e.updateLayout(),e.parent?Q.tempToInnerOf(t,e.parent.scrollWorldTransform):t}const qr={worldBounds:e=>e.__world,localBoxBounds:e=>e.__.eraser||e.__.visible===0?null:e.__local||e.__layout,localStrokeBounds:e=>e.__.eraser||e.__.visible===0?null:e.__layout.localStrokeBounds,localRenderBounds:e=>e.__.eraser||e.__.visible===0?null:e.__layout.localRenderBounds,maskLocalBoxBounds:(e,t)=>xn(e,t)&&e.__localBoxBounds,maskLocalStrokeBounds:(e,t)=>xn(e,t)&&e.__layout.localStrokeBounds,maskLocalRenderBounds:(e,t)=>xn(e,t)&&e.__layout.localRenderBounds,excludeRenderBounds:(e,t)=>!(!t.bounds||t.bounds.hit(e.__world,t.matrix))||!(!t.hideBounds||!t.hideBounds.includes(e.__world,t.matrix))};let ys;function xn(e,t){return t||(ys=0),e.__.mask&&(ys=1),ys<0?null:(ys&&(ys=-1),!0)}const{updateBounds:Fo}=At,Vs={sort:(e,t)=>e.__.zIndex===t.__.zIndex?e.__tempNumber-t.__tempNumber:e.__.zIndex-t.__.zIndex,pushAllChildBranch(e,t){if(e.__tempNumber=1,e.__.__childBranchNumber){const{children:i}=e;for(let s=0,r=i.length;s<r;s++)(e=i[s]).isBranch&&(e.__tempNumber=1,t.add(e),Ep(e,t))}},pushAllParent(e,t){const{keys:i}=t;if(i)for(;e.parent&&G(i[e.parent.innerId]);)t.add(e.parent),e=e.parent;else for(;e.parent;)t.add(e.parent),e=e.parent},pushAllBranchStack(e,t){let i=t.length;const{children:s}=e;for(let r=0,n=s.length;r<n;r++)s[r].isBranch&&t.push(s[r]);for(let r=i,n=t.length;r<n;r++)Ho(t[r],t)},updateBounds(e,t){const i=[e];Ho(e,i),Cp(i,t)},updateBoundsByBranchStack(e,t){let i,s;for(let r=e.length-1;r>-1;r--){i=e[r],s=i.children;for(let n=0,a=s.length;n<a;n++)Fo(s[n]);t&&t===i||Fo(i)}},move(e,t,i){let s;const{children:r}=e;for(let n=0,a=r.length;n<a;n++)s=(e=r[n]).__world,s.e+=t,s.f+=i,s.x+=t,s.y+=i,e.isBranch&&Bp(e,t,i)},scale(e,t,i,s,r,n,a){let o;const{children:l}=e,h=s-1,d=r-1;for(let c=0,u=l.length;c<u;c++)o=(e=l[c]).__world,o.a*=s,o.d*=r,(o.b||o.c)&&(o.b*=s,o.c*=r),o.e===o.x&&o.f===o.y?(o.x=o.e+=(o.e-n)*h+t,o.y=o.f+=(o.f-a)*d+i):(o.e+=(o.e-n)*h+t,o.f+=(o.f-a)*d+i,o.x+=(o.x-n)*h+t,o.y+=(o.y-a)*d+i),o.width*=s,o.height*=r,o.scaleX*=s,o.scaleY*=r,e.isBranch&&Pp(e,t,i,s,r,n,a)}},{pushAllChildBranch:Ep,pushAllBranchStack:Ho,updateBoundsByBranchStack:Cp,move:Bp,scale:Pp}=Vs,ms={run(e){if(e&&e.length){const t=e.length;for(let i=0;i<t;i++)e[i]();e.length===t?e.length=0:e.splice(0,t)}}},{getRelativeWorld:Yo,updateBounds:Rp}=At,{toOuterOf:_r,getPoints:Lp,copy:Op}=I,wn="_localContentBounds",bn="_worldContentBounds",kn="_worldBoxBounds",Sn="_worldStrokeBounds";class Mp{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(t){this._renderBounds=t}get localContentBounds(){return _r(this.contentBounds,this.leaf.__localMatrix,this[wn]||(this[wn]={})),this[wn]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return _r(this.contentBounds,this.leaf.__world,this[bn]||(this[bn]={})),this[bn]}get worldBoxBounds(){return _r(this.boxBounds,this.leaf.__world,this[kn]||(this[kn]={})),this[kn]}get worldStrokeBounds(){return _r(this.strokeBounds,this.leaf.__world,this[Sn]||(this[Sn]={})),this[Sn]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),t.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leaf:t}=this,{leafer:i}=t;if(t.isApp)return Rp(t);if(i)i.ready?i.watcher.changed&&i.layouter.layout():i.start();else{let s=t;for(;s.parent&&!s.parent.leafer;)s=s.parent;const r=s;if(r.__fullLayouting)return;r.__fullLayouting=!0,A.layout(r),delete r.__fullLayouting}}getTransform(t="world"){this.update();const{leaf:i}=this;switch(t){case"world":return i.__world;case"local":return i.__localMatrix;case"inner":return K.defaultMatrix;case"page":t=i.zoomLayer;default:return Yo(i,t)}}getBounds(t,i="world"){switch(this.update(),i){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":i=this.leaf.zoomLayer;default:return new Ot(this.getInnerBounds(t)).toOuterOf(this.getTransform(i))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,i="world",s){const{leaf:r}=this;let n,a,o,l=this.getInnerBounds(t);switch(i){case"world":n=r.getWorldPoint(l),a=r.__world;break;case"local":const{scaleX:h,scaleY:d,rotation:c,skewX:u,skewY:p}=r.__;o={scaleX:h,scaleY:d,rotation:c,skewX:u,skewY:p},n=r.getLocalPointByInner(l);break;case"inner":n=l,a=K.defaultMatrix;break;case"page":i=r.zoomLayer;default:n=r.getWorldPoint(l,i),a=Yo(r,i,!0)}if(o||(o=K.getLayout(a)),Op(o,l),Q.copy(o,n),s){const{scaleX:h,scaleY:d}=o,c=Math.abs(h),u=Math.abs(d);c===1&&u===1||(o.scaleX/=c,o.scaleY/=u,o.width*=c,o.height*=u)}return o}getLayoutPoints(t,i="world"){const{leaf:s}=this,r=Lp(this.getInnerBounds(t));let n;switch(i){case"world":n=null;break;case"local":n=s.parent;break;case"inner":break;case"page":i=s.zoomLayer;default:n=i}return G(n)||r.forEach(a=>s.innerToWorld(a,null,!1,n)),r}shrinkContent(){const{x:t,y:i,width:s,height:r}=this.boxBounds;this._contentBounds={x:t,y:i,width:s,height:r}}spreadStroke(){const{x:t,y:i,width:s,height:r}=this.strokeBounds;this._strokeBounds={x:t,y:i,width:s,height:r},this._localStrokeBounds={x:t,y:i,width:s,height:r},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:i,width:s,height:r}=this.renderBounds;this._renderBounds={x:t,y:i,width:s,height:r},this._localRenderBounds={x:t,y:i,width:s,height:r}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class $e{constructor(t,i){this.bubbles=!1,this.type=t,i&&(this.target=i)}stopDefault(){this.isStopDefault=!0,this.origin&&A.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&A.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&A.event.stop(this.origin)}}class Rt extends $e{constructor(t,i,s){super(t,i),this.parent=s,this.child=i}}Rt.ADD="child.add",Rt.REMOVE="child.remove",Rt.CREATED="created",Rt.MOUNTED="mounted",Rt.UNMOUNTED="unmounted",Rt.DESTROY="destroy";const la="property.scroll";class hi extends $e{constructor(t,i,s,r,n){super(t,i),this.attrName=s,this.oldValue=r,this.newValue=n}}hi.CHANGE="property.change",hi.LEAFER_CHANGE="property.leafer_change",hi.SCROLL=la;const Ap={scrollX:la,scrollY:la};class Ze extends $e{constructor(t,i){super(t),Object.assign(this,i)}}Ze.LOAD="image.load",Ze.LOADED="image.loaded",Ze.ERROR="image.error";class Je extends $e{static checkHas(t,i,s){s==="on"?i===Mr?t.__hasWorldEvent=!0:t.__hasLocalEvent=!0:(t.__hasLocalEvent=t.hasEvent(ha)||t.hasEvent(ca)||t.hasEvent(da),t.__hasWorldEvent=t.hasEvent(Mr))}static emitLocal(t){if(t.leaferIsReady){const{resized:i}=t.__layout;i!=="local"&&(t.emit(ha,t),i==="inner"&&t.emit(ca,t)),t.emit(da,t)}}static emitWorld(t){t.leaferIsReady&&t.emit(Mr,this)}}Je.RESIZE="bounds.resize",Je.INNER="bounds.inner",Je.LOCAL="bounds.local",Je.WORLD="bounds.world";const{RESIZE:ha,INNER:ca,LOCAL:da,WORLD:Mr}=Je,ua={};[ha,ca,da,Mr].forEach(e=>ua[e]=1);class ui extends $e{get bigger(){if(!this.old)return!0;const{width:t,height:i}=this.old;return this.width>=t&&this.height>=i}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,i){_t(t)?(super(ui.RESIZE),Object.assign(this,t)):super(t),this.old=i}static isResizing(t){return this.resizingKeys&&!G(this.resizingKeys[t.innerId])}}ui.RESIZE="resize";class ci extends $e{constructor(t,i){super(t),this.data=i}}ci.REQUEST="watch.request",ci.DATA="watch.data";class vt extends $e{constructor(t,i,s){super(t),i&&(this.data=i,this.times=s)}}vt.REQUEST="layout.request",vt.START="layout.start",vt.BEFORE="layout.before",vt.LAYOUT="layout",vt.AFTER="layout.after",vt.AGAIN="layout.again",vt.END="layout.end";class ut extends $e{constructor(t,i,s,r){super(t),i&&(this.times=i),s&&(this.renderBounds=s,this.renderOptions=r)}}ut.REQUEST="render.request",ut.CHILD_START="render.child_start",ut.CHILD_END="render.child_end",ut.START="render.start",ut.BEFORE="render.before",ut.RENDER="render",ut.AFTER="render.after",ut.AGAIN="render.again",ut.END="render.end",ut.NEXT="render.next";class nt extends $e{}nt.START="leafer.start",nt.BEFORE_READY="leafer.before_ready",nt.READY="leafer.ready",nt.AFTER_READY="leafer.after_ready",nt.VIEW_READY="leafer.view_ready",nt.VIEW_COMPLETED="leafer.view_completed",nt.STOP="leafer.stop",nt.RESTART="leafer.restart",nt.END="leafer.end",nt.UPDATE_MODE="leafer.update_mode",nt.TRANSFORM="leafer.transform",nt.MOVE="leafer.move",nt.SCALE="leafer.scale",nt.ROTATE="leafer.rotate",nt.SKEW="leafer.skew";const{MOVE:Vo,SCALE:qo,ROTATE:$p,SKEW:Xo}=nt,Ip={x:Vo,y:Vo,scaleX:qo,scaleY:qo,rotation:$p,skewX:Xo,skewY:Xo},Go={};class Dp{set event(t){this.on(t)}on(t,i,s){if(!i){let d;if(Lt(t))t.forEach(c=>this.on(c[0],c[1],c[2]));else for(let c in t)Lt(d=t[c])?this.on(c,d[0],d[1]):this.on(c,d);return}let r,n,a;s&&(s==="once"?n=!0:typeof s=="boolean"?r=s:(r=s.capture,n=s.once));const o=Tn(this,r,!0),l=Et(t)?t.split(" "):t,h=n?{listener:i,once:n}:{listener:i};l.forEach(d=>{d&&(a=o[d],a?a.findIndex(c=>c.listener===i)===-1&&a.push(h):o[d]=[h],ua[d]&&Je.checkHas(this,d,"on"))})}off(t,i,s){if(t){const r=Et(t)?t.split(" "):t;if(i){let n,a,o;s&&(n=typeof s=="boolean"?s:s!=="once"&&s.capture);const l=Tn(this,n);r.forEach(h=>{h&&(a=l[h],a&&(o=a.findIndex(d=>d.listener===i),o>-1&&a.splice(o,1),a.length||delete l[h],ua[h]&&Je.checkHas(this,h,"off")))})}else{const{__bubbleMap:n,__captureMap:a}=this;r.forEach(o=>{n&&delete n[o],a&&delete a[o]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,i,s,r){return i?this.on(t,s?i=i.bind(s):i,r):Lt(t)&&t.forEach(n=>this.on(n[0],n[2]?n[1]=n[1].bind(n[2]):n[1],n[3])),{type:t,current:this,listener:i,options:r}}off_(t){if(!t)return;const i=Lt(t)?t:[t];i.forEach(s=>{s&&(s.listener?s.current.off(s.type,s.listener,s.options):Lt(s.type)&&s.type.forEach(r=>s.current.off(r[0],r[1],r[3])))}),i.length=0}once(t,i,s,r){if(!i)return Lt(t)&&t.forEach(n=>this.once(n[0],n[1],n[2],n[3]));_t(s)?i=i.bind(s):r=s,this.on(t,i,{once:!0,capture:r})}emit(t,i,s){!i&&ss.has(t)&&(i=ss.get(t,{type:t,target:this,current:this}));const r=Tn(this,s)[t];if(r){let n;for(let a=0,o=r.length;a<o&&!((n=r[a])&&(n.listener(i),n.once&&(this.off(t,n.listener,s),a--,o--),i&&i.isStopNow));a++);}this.syncEventer&&this.syncEventer.emitEvent(i,s)}emitEvent(t,i){t.current=this,this.emit(t.type,t,i)}hasEvent(t,i){if(this.syncEventer&&this.syncEventer.hasEvent(t,i))return!0;const{__bubbleMap:s,__captureMap:r}=this,n=s&&s[t],a=r&&r[t];return!!(G(i)?n||a:i?a:n)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function Tn(e,t,i){if(t){const{__captureMap:s}=e;return s||(i?e.__captureMap={}:Go)}{const{__bubbleMap:s}=e;return s||(i?e.__bubbleMap={}:Go)}}const{on:Wp,on_:Np,off:zp,off_:Fp,once:Hp,emit:Yp,emitEvent:Vp,hasEvent:qp,destroy:Xp}=Dp.prototype,Gp={on:Wp,on_:Np,off:zp,off_:Fp,once:Hp,emit:Yp,emitEvent:Vp,hasEvent:qp,destroyEventer:Xp},jp=yt.get("setAttr"),Up={__setAttr(e,t,i){if(this.leaferIsCreated){const s=this.__.__getInput(e);if(!i||ia(t)||G(t)||(jp.warn(this.innerName,e,t),t=void 0),_t(t)||s!==t){if(this.__realSetAttr(e,t),this.isLeafer){this.emitEvent(new hi(hi.LEAFER_CHANGE,this,e,s,t));const n=Ip[e];n&&(this.emitEvent(new nt(n,this)),this.emitEvent(new nt(nt.TRANSFORM,this)))}this.emitPropertyEvent(hi.CHANGE,e,s,t);const r=Ap[e];return r&&this.emitPropertyEvent(r,e,s,t),!0}return!1}return this.__realSetAttr(e,t),!0},emitPropertyEvent(e,t,i,s){const r=new hi(e,this,t,i,s);this.isLeafer||this.hasEvent(e)&&this.emitEvent(r),this.leafer.emitEvent(r)},__realSetAttr(e,t){const i=this.__;i[e]=t,this.__proxyData&&this.setProxyAttr(e,t),i.normalStyle&&(this.lockNormalStyle||G(i.normalStyle[e])||(i.normalStyle[e]=t))},__getAttr(e){return this.__proxyData?this.getProxyAttr(e):this.__.__get(e)}},{setLayout:Kp,multiplyParent:Qp,translateInner:jo,defaultWorld:Jp}=K,{toPoint:Zp,tempPoint:En}=Mi,tf={__updateWorldMatrix(){const{parent:e,__layout:t,__world:i,__scrollWorld:s,__:r}=this;Qp(this.__local||t,e?e.__scrollWorld||e.__world:Jp,i,!!t.affectScaleOrRotation,r),s&&jo(Object.assign(s,i),r.scrollX,r.scrollY)},__updateLocalMatrix(){if(this.__local){const e=this.__layout,t=this.__local,i=this.__;e.affectScaleOrRotation&&(e.scaleChanged&&(e.resized||(e.resized="scale"))||e.rotationChanged)&&(Kp(t,i,null,null,e.affectRotation),e.scaleChanged=e.rotationChanged=void 0),t.e=i.x+i.offsetX,t.f=i.y+i.offsetY,(i.around||i.origin)&&(Zp(i.around||i.origin,e.boxBounds,En),jo(t,-En.x,-En.y,!i.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:ef,updateAllMatrix:Uo}=At,{updateBounds:Ko}=Vs,{toOuterOf:yr,copyAndSpread:Qo,copy:sf}=I,{toBounds:rf}=Wh,nf={__updateWorldBounds(){const{__layout:e,__world:t}=this;yr(e.renderBounds,t,t),e.resized&&(e.resized==="inner"&&this.__onUpdateSize(),this.__hasLocalEvent&&Je.emitLocal(this),e.resized=void 0),this.__hasWorldEvent&&Je.emitWorld(this)},__updateLocalBounds(){const e=this.__layout;e.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),e.resized="inner"),e.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),e.localBoxChanged=void 0,e.strokeSpread&&(e.strokeChanged=!0),e.renderSpread&&(e.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),e.boxChanged=void 0,e.strokeChanged&&(e.strokeSpread=this.__updateStrokeSpread(),e.strokeSpread?(e.strokeBounds===e.boxBounds&&e.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):e.spreadStrokeCancel(),e.strokeChanged=void 0,(e.renderSpread||e.strokeSpread!==e.strokeBoxSpread)&&(e.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),e.resized="inner"),e.renderChanged&&(e.renderSpread=this.__updateRenderSpread(),e.renderSpread?(e.renderBounds!==e.boxBounds&&e.renderBounds!==e.strokeBounds||e.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):e.spreadRenderCancel(),e.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),e.resized||(e.resized="local"),e.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),yr(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){yr(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){yr(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(e,t){const i=this.__layout.boxBounds,s=this.__;s.__usePathBox?rf(s.path,i):(i.x=0,i.y=0,i.width=s.width,i.height=s.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Uo(this),Ko(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Uo(this),Ko(this,this))):ef(this)},__updateNaturalSize(){const{__:e,__layout:t}=this;e.__naturalWidth=t.boxBounds.width,e.__naturalHeight=t.boxBounds.height},__updateStrokeBounds(e){const t=this.__layout;Qo(t.strokeBounds,t.boxBounds,t.strokeBoxSpread)},__updateRenderBounds(e){const t=this.__layout,{renderSpread:i}=t;St(i)&&i<=0?sf(t.renderBounds,t.strokeBounds):Qo(t.renderBounds,t.boxBounds,i)}},af={__render(e,t){if(t.shape)return this.__renderShape(e,t);if((!t.cellList||t.cellList.has(this))&&this.__worldOpacity){const i=this.__;if(i.bright&&!t.topRendering)return t.topList.add(this);if(e.setWorld(this.__nowWorld=this.__getNowWorld(t)),e.opacity=t.dimOpacity&&!i.dimskip?i.opacity*t.dimOpacity:i.opacity,this.__.__single){if(i.eraser==="path")return this.__renderEraser(e,t);const s=e.getSameCanvas(!0,!0);this.__draw(s,t,e),At.copyCanvasByWorld(this,e,s,this.__nowWorld,i.__blendMode,!0),s.recycle(this.__nowWorld)}else this.__draw(e,t);yt.showBounds&&yt.drawBounds(this,e,t)}},__renderShape(e,t){this.__worldOpacity&&(e.setWorld(this.__nowWorld=this.__getNowWorld(t)),this.__drawShape(e,t))},__clip(e,t){this.__worldOpacity&&(e.setWorld(this.__nowWorld=this.__getNowWorld(t)),this.__drawRenderPath(e),e.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Jo}=qr,{hasSize:of}=I,lf={__updateChange(){const{__layout:e}=this;e.childrenSortChanged&&(this.__updateSortChildren(),e.childrenSortChanged=!1),this.__.__checkSingle()},__render(e,t){const i=this.__nowWorld=this.__getNowWorld(t);if(this.__worldOpacity&&of(i)){const s=this.__;if(s.__useDim)if(s.dim)t.dimOpacity=s.dim===!0?.2:s.dim;else{if(s.bright&&!t.topRendering)return t.topList.add(this);s.dimskip&&t.dimOpacity&&(t.dimOpacity=0)}if(s.__single&&!this.isBranchLeaf){if(s.eraser==="path")return this.__renderEraser(e,t);const r=e.getSameCanvas(!1,!0);this.__renderBranch(r,t),e.opacity=t.dimOpacity?s.opacity*t.dimOpacity:s.opacity,e.copyWorldByReset(r,i,i,s.__blendMode,!0),r.recycle(i)}else this.__renderBranch(e,t)}},__renderBranch(e,t){if(this.__hasMask)this.__renderMask(e,t);else{const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Jo(i[s],t)||i[s].__render(e,t)}},__clip(e,t){if(this.__worldOpacity){const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Jo(i[s],t)||i[s].__clip(e,t)}}},Cn={},{LEAF:hf,create:cf}=ti,{stintSet:Zo}=gt,{toInnerPoint:df,toOuterPoint:uf,multiplyParent:pf}=K,{toOuterOf:tl}=I,{copy:el,move:il}=Q,{moveLocal:ff,zoomOfLocal:gf,rotateOfLocal:_f,skewOfLocal:yf,moveWorld:sl,zoomOfWorld:mf,rotateOfWorld:vf,skewOfWorld:xf,transform:rl,transformWorld:wf,setTransform:bf,getFlipTransform:kf,getLocalOrigin:Bn,getRelativeWorld:Sf,drop:Tf}=At;let rs=class{get tag(){return this.__tag}set tag(e){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return wh}get __LayoutProcessor(){return Mp}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(e){this.on(e)}constructor(e){this.innerId=cf(hf),this.reset(e),this.__bubbleMap&&this.__emitLifeEvent(Rt.CREATED)}reset(e){this.leafer&&this.leafer.forceRender(this.__world),e!==0&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},e!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),e&&(e.__&&(e=e.toJSON()),e.children?this.set(e):Object.assign(this,e))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(e,t){t&&(e=e.bind(t)),this.parent?e():this.on(Rt.ADD,e,"once")}waitLeafer(e,t){t&&(e=e.bind(t)),this.leafer?e():this.on(Rt.MOUNTED,e,"once")}nextRender(e,t,i){this.leafer?this.leafer.nextRender(e,t,i):this.waitLeafer(()=>this.leafer.nextRender(e,t,i))}removeNextRender(e){this.nextRender(e,null,"off")}__bindLeafer(e){if(this.isLeafer&&e!==null&&(e=this),this.leafer&&!e&&this.leafer.leafs--,this.leafer=e,e?(e.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(Rt.MOUNTED)):this.__emitLifeEvent(Rt.UNMOUNTED),this.isBranch){const{children:t}=this;for(let i=0,s=t.length;i<s;i++)t[i].__bindLeafer(e)}}set(e,t){}get(e){}setAttr(e,t){this[e]=t}getAttr(e){return this[e]}getComputedAttr(e){return this.__[e]}toJSON(e){return e&&this.__layout.update(),this.__.__getInputData(null,e)}toString(e){return JSON.stringify(this.toJSON(e))}toSVG(){}__SVG(e){}toHTML(){}__setAttr(e,t){return!0}__getAttr(e){}setProxyAttr(e,t){}getProxyAttr(e){}find(e,t){}findTag(e){}findOne(e,t){}findId(e){}focus(e){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(e){G(e)?e="width":e==="surface"&&(e="blendMode");const t=this.__.__getInput(e);this.__[e]=G(t)?null:void 0,this[e]=t}forceRender(e,t){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(e,t){}__updateContentBounds(){}__updateStrokeBounds(e){}__updateRenderBounds(e){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(e){this.__hasEraser=!!e||this.children.some(t=>t.__.eraser)}__renderEraser(e,t){e.save(),this.__clip(e,t);const{renderBounds:i}=this.__layout;e.clearRect(i.x,i.y,i.width,i.height),e.restore()}__updateMask(e){this.__hasMask=this.children.some(t=>t.__.mask&&t.__.visible&&t.__.opacity)}__renderMask(e,t){}__getNowWorld(e){if(e.matrix){this.__cameraWorld||(this.__cameraWorld={});const t=this.__cameraWorld,i=this.__world;return pf(i,e.matrix,t,void 0,i),tl(this.__layout.renderBounds,t,t),Zo(t,"half",i.half),Zo(t,"ignorePixelSnap",i.ignorePixelSnap),t}return this.__world}getClampRenderScale(){let{scaleX:e}=this.__nowWorld||this.__world;return e<0&&(e=-e),e>1?e:1}getRenderScaleData(e,t){let{scaleX:i,scaleY:s}=Ee.patternLocked?this.__world:this.__nowWorld;return e&&(i<0&&(i=-i),s<0&&(s=-s)),(t===!0||t==="zoom-in"&&i>1&&s>1)&&(i=s=1),Cn.scaleX=i,Cn.scaleY=s,Cn}getTransform(e){return this.__layout.getTransform(e||"local")}getBounds(e,t){return this.__layout.getBounds(e,t)}getLayoutBounds(e,t,i){return this.__layout.getLayoutBounds(e,t,i)}getLayoutPoints(e,t){return this.__layout.getLayoutPoints(e,t)}getWorldBounds(e,t,i){const s=t?Sf(this,t):this.worldTransform,r=i?e:{};return tl(e,s,r),r}worldToLocal(e,t,i,s){this.parent?this.parent.worldToInner(e,t,i,s):t&&el(t,e)}localToWorld(e,t,i,s){this.parent?this.parent.innerToWorld(e,t,i,s):t&&el(t,e)}worldToInner(e,t,i,s){s&&(s.innerToWorld(e,t,i),e=t||e),df(this.scrollWorldTransform,e,t,i)}innerToWorld(e,t,i,s){uf(this.scrollWorldTransform,e,t,i),s&&s.worldToInner(t||e,null,i)}getBoxPoint(e,t,i,s){return this.getBoxPointByInner(this.getInnerPoint(e,t,i,s),null,null,!0)}getBoxPointByInner(e,t,i,s){const r=s?e:Object.assign({},e),{x:n,y:a}=this.boxBounds;return il(r,-n,-a),r}getInnerPoint(e,t,i,s){const r=s?e:{};return this.worldToInner(e,r,i,t),r}getInnerPointByBox(e,t,i,s){const r=s?e:Object.assign({},e),{x:n,y:a}=this.boxBounds;return il(r,n,a),r}getInnerPointByLocal(e,t,i,s){return this.getInnerPoint(e,this.parent,i,s)}getLocalPoint(e,t,i,s){const r=s?e:{};return this.worldToLocal(e,r,i,t),r}getLocalPointByInner(e,t,i,s){return this.getWorldPoint(e,this.parent,i,s)}getPagePoint(e,t,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(e,t,i,s)}getWorldPoint(e,t,i,s){const r=s?e:{};return this.innerToWorld(e,r,i,t),r}getWorldPointByBox(e,t,i,s){return this.getWorldPoint(this.getInnerPointByBox(e,null,null,s),t,i,!0)}getWorldPointByLocal(e,t,i,s){const r=s?e:{};return this.localToWorld(e,r,i,t),r}getWorldPointByPage(e,t,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(e,t,i,s)}setTransform(e,t,i){bf(this,e,t,i)}transform(e,t,i){rl(this,e,t,i)}move(e,t,i){ff(this,e,t,i)}moveInner(e,t,i){sl(this,e,t,!0,i)}scaleOf(e,t,i,s,r){gf(this,Bn(this,e),t,i,s,r)}rotateOf(e,t,i){_f(this,Bn(this,e),t,i)}skewOf(e,t,i,s,r){yf(this,Bn(this,e),t,i,s,r)}transformWorld(e,t,i){wf(this,e,t,i)}moveWorld(e,t,i){sl(this,e,t,!1,i)}scaleOfWorld(e,t,i,s,r){mf(this,e,t,i,s,r)}rotateOfWorld(e,t){vf(this,e,t)}skewOfWorld(e,t,i,s,r){xf(this,e,t,i,s,r)}flip(e,t){rl(this,kf(this,e),!1,t)}scaleResize(e,t=e,i){this.scaleX*=e,this.scaleY*=t}__scaleResize(e,t){}resizeWidth(e){}resizeHeight(e){}hit(e,t){return!0}__hitWorld(e,t){return!0}__hit(e,t){return!0}__hitFill(e){return!0}__hitStroke(e,t){return!0}__hitPixel(e){return!0}__drawHitPath(e){}__updateHitCanvas(){}__render(e,t){}__drawFast(e,t){}__draw(e,t,i){}__clip(e,t){}__renderShape(e,t){}__drawShape(e,t){}__updateWorldOpacity(){}__updateChange(){}__drawPath(e){}__drawRenderPath(e){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Zt.need("path")}getMotionPoint(e){return Zt.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(e,t){}__updateSortChildren(){}add(e,t){}remove(e,t){this.parent&&this.parent.remove(this,t)}dropTo(e,t,i){Tf(this,e,t,i)}on(e,t,i){}off(e,t,i){}on_(e,t,i,s){}off_(e){}once(e,t,i,s){}emit(e,t,i){}emitEvent(e,t){}hasEvent(e,t){return!1}static changeAttr(e,t,i){i?this.addAttr(e,t,i):Vh(this.prototype,e,t)}static addAttr(e,t,i,s){i||(i=tt),i(t,s)(this.prototype,e)}__emitLifeEvent(e){this.hasEvent(e)&&this.emitEvent(new Rt(e,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(Rt.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};rs=W([ke(Up),ke(tf),ke(nf),ke(Gp),ke(af)],rs);const{setListWithFn:Pn}=I,{sort:Ef}=Vs,{localBoxBounds:Cf,localStrokeBounds:Bf,localRenderBounds:Pf,maskLocalBoxBounds:Rf,maskLocalStrokeBounds:Lf,maskLocalRenderBounds:Of}=qr,Mf=new yt("Branch");let pa=class extends rs{__updateStrokeSpread(){const{children:e}=this;for(let t=0,i=e.length;t<i;t++)if(e[t].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:e}=this;for(let t=0,i=e.length;t<i;t++)if(e[t].__layout.renderSpread)return 1;return 0}__updateBoxBounds(e,t){Pn(t||this.__layout.boxBounds,this.children,this.__hasMask?Rf:Cf)}__updateStrokeBounds(e){Pn(e||this.__layout.strokeBounds,this.children,this.__hasMask?Lf:Bf)}__updateRenderBounds(e){Pn(e||this.__layout.renderBounds,this.children,this.__hasMask?Of:Pf)}__updateSortChildren(){let e;const{children:t}=this;if(t.length>1){for(let i=0,s=t.length;i<s;i++)t[i].__tempNumber=i,t[i].__.zIndex&&(e=!0);t.sort(Ef),this.__layout.affectChildrenSort=e}}add(e,t){if(e===this||e.destroyed)return Mf.warn("add self or destroyed");const i=G(t);if(!e.__){if(Lt(e))return e.forEach(r=>{this.add(r,t),i||t++});e=Ys.get(e.tag,e)}e.parent&&e.parent.remove(e),e.parent=this,i?this.children.push(e):this.children.splice(t,0,e),e.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const s=e.__layout;s.boxChanged||s.boxChange(),s.matrixChanged||s.matrixChange(),e.__bubbleMap&&e.__emitLifeEvent(Rt.ADD),this.leafer&&(e.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Rt.ADD,e)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...e){this.add(e)}remove(e,t){e?e.__?e.animationOut?e.__runAnimation("out",()=>this.__remove(e,t)):this.__remove(e,t):this.find(e).forEach(i=>this.remove(i,t)):G(e)&&super.remove(null,t)}removeAll(e){const{children:t}=this;t.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,t.forEach(i=>{this.__realRemoveChild(i),e&&i.destroy()}))}clear(){this.removeAll(!0)}__remove(e,t){const i=this.children.indexOf(e);i>-1&&(this.children.splice(i,1),e.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(e),t&&e.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(e){e.__emitLifeEvent(Rt.REMOVE),e.parent=null,this.leafer&&(e.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Rt.REMOVE,e),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(e,t){const i=new Rt(e,t,this);this.hasEvent(e)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}};pa=W([ke(lf)],pa);class bt{get length(){return this.list.length}constructor(t){this.reset(),t&&(Lt(t)?this.addList(t):this.add(t))}has(t){return t&&!G(this.keys[t.innerId])}indexAt(t){return this.list[t]}indexOf(t){const i=this.keys[t.innerId];return G(i)?-1:i}add(t){const{list:i,keys:s}=this;G(s[t.innerId])&&(i.push(t),s[t.innerId]=i.length-1)}addAt(t,i=0){const{keys:s}=this;if(G(s[t.innerId])){const{list:r}=this;for(let n=i,a=r.length;n<a;n++)s[r[n].innerId]++;i===0?r.unshift(t):(i>r.length&&(i=r.length),r.splice(i,0,t)),s[t.innerId]=i}}addList(t){for(let i=0;i<t.length;i++)this.add(t[i])}remove(t){const{list:i}=this;let s;for(let r=0,n=i.length;r<n;r++)G(s)?i[r].innerId===t.innerId&&(s=r,delete this.keys[t.innerId]):this.keys[i[r].innerId]=r-1;G(s)||i.splice(s,1)}sort(t){const{list:i}=this;t?i.sort((s,r)=>r.__level-s.__level):i.sort((s,r)=>s.__level-r.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new bt;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:i}=this;for(let s=0,r=t.length;s<r;s++)i[t[s].innerId]=s}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Af{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(Lt(t)?this.addList(t):this.add(t))}has(t){return!G(this.keys[t.innerId])}without(t){return G(this.keys[t.innerId])}sort(t){const{levels:i}=this;t?i.sort((s,r)=>r-s):i.sort((s,r)=>s-r)}addList(t){t.forEach(i=>{this.add(i)})}add(t){const{keys:i,levelMap:s}=this;i[t.innerId]||(i[t.innerId]=1,s[t.__level]?s[t.__level].push(t):(s[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let i;this.levels.forEach(s=>{i=this.levelMap[s];for(let r=0,n=i.length;r<n;r++)t(i[r])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}function f(e,t,i,s){var r,n=arguments.length,a=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}function Vi(e){return Ct(e,t=>({set(i){this.__setAttr(t,i),i&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function vs(e){return Ct(e,t=>({set(i){this.__setAttr(t,i),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function $f(){return(e,t)=>{const i="_"+t;as(e,t,{set(s){this.isLeafer&&(this[i]=s)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}const Xh={},te={hasTransparent:function(e){if(!e||e.length===7||e.length===4)return!1;if(e==="transparent")return!0;const t=e[0];if(t==="#")switch(e.length){case 5:return e[4]!=="f"&&e[4]!=="F";case 9:return e[7]!=="f"&&e[7]!=="F"||e[8]!=="f"&&e[8]!=="F"}else if((t==="r"||t==="h")&&e[3]==="a"){const i=e.lastIndexOf(",");if(i>-1)return parseFloat(e.slice(i+1))<1}return!1}},nl=Eh,If={},it={},Mt={},Ar={},di={},Gh={apply(){Zt.need("filter")}},Df={},al={setStyleName:()=>Zt.need("state"),set:()=>Zt.need("state")},{parse:Wf,objectToCanvasData:Nf}=Oi,{stintSet:xs}=gt,{hasTransparent:ol}=te,ll={originPaint:{}},hl=yt.get("UIData");let pi=class extends wh{get scale(){const{scaleX:t,scaleY:i}=this;return t!==i?{x:t,y:i}:t}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const t=this;return t.__hasMultiStrokeStyle?Math.max(t.__hasMultiStrokeStyle,t.strokeWidth):t.strokeWidth}get __hasMultiPaint(){const t=this;return t.fill&&this.__useStroke||t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect}get __clipAfterFill(){const t=this;return t.cornerRadius||t.innerShadow||t.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:i}=this.__leaf;i&&(i.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,hl.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,hl.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),Et(t)||!t?(xs(this,"__isTransparentFill",ol(t)),this.__isFills&&this.__removePaint("fill",!0),this._fill=t):_t(t)&&this.__setPaint("fill",t)}setStroke(t){Et(t)||!t?(xs(this,"__isTransparentStroke",ol(t)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=t):_t(t)&&this.__setPaint("stroke",t)}setPath(t){const i=Et(t);i||t&&_t(t[0])?(this.__setInput("path",t),this._path=i?Wf(t):Nf(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){Rn(this,"shadow",t)}setInnerShadow(t){Rn(this,"innerShadow",t)}setFilter(t){Rn(this,"filter",t)}__computePaint(){const{fill:t,stroke:i}=this.__input;t&&it.compute("fill",this.__leaf),i&&it.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(t){let{strokeWidth:i,strokeWidthFixed:s}=this;if(t&&(t.strokeWidth&&(i=t.strokeWidth),G(t.strokeWidthFixed)||(s=t.strokeWidthFixed)),s){const r=this.__leaf.getClampRenderScale();return r>1?i/r:i}return i}__setPaint(t,i){this.__setInput(t,i);const s=this.__leaf.__layout;s.boxChanged||s.boxChange(),Lt(i)&&!i.length?this.__removePaint(t):t==="fill"?(this.__isFills=!0,this._fill||(this._fill=ll)):(this.__isStrokes=!0,this._stroke||(this._stroke=ll))}__removePaint(t,i){i&&this.__removeInput(t),Mt.recycleImage(t,this),t==="fill"?(xs(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(xs(this,"__isAlphaPixelStroke",void 0),xs(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}};function Rn(e,t,i){e.__setInput(t,i),Lt(i)?(i.some(s=>s.visible===!1)&&(i=i.filter(s=>s.visible!==!1)),i.length||(i=void 0)):i=i&&i.visible!==!1?[i]:void 0,e["_"+t]=i}let Xr=class extends pi{},jh=class extends Xr{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const t=this;return t.overflow!=="show"&&t.__leaf.children.length&&(t.__leaf.isOverflow||super.__clipAfterFill)}},zf=class extends Xr{__getInputData(t,i){const s=super.__getInputData(t,i);return be.forEach(r=>delete s[r]),s}},Ff=class extends jh{},Uh=class extends pi{get __usePathBox(){return this.points||this.__pathInputed}},Pa=class extends pi{get __boxStroke(){return!this.__pathInputed}},Hf=class extends pi{get __boxStroke(){return!this.__pathInputed}},Yf=class extends Uh{},Vf=class extends pi{},qf=class extends pi{get __pathInputed(){return 2}},Xf=class extends Xr{};const Gf={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};let jf=class extends pi{get __useNaturalRatio(){return!1}setFontWeight(t){Et(t)?(this.__setInput("fontWeight",t),t=Gf[t]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t}setBoxStyle(t){let i=this.__leaf,s=i.__box;if(t){const{boxStyle:r}=this;if(s)for(let o in r)s[o]=void 0;else s=i.__box=Ys.get("Rect",0);const n=i.__layout,a=s.__layout;r||(s.parent=i,s.__world=i.__world,a.boxBounds=n.boxBounds),s.set(t),a.strokeChanged&&n.strokeChange()}else s&&(i.__box=s.parent=null,s.destroy());this._boxStyle=t}__getInputData(t,i){const s=super.__getInputData(t,i);return s.textEditing&&delete s.textEditing,s}},Uf=class extends Pa{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return t.url&&delete t.fill,t}__getInputData(t,i){const s=super.__getInputData(t,i);return s.url&&delete s.fill,s}},Kf=class extends Pa{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,i){const s=super.__getInputData(t,i);return s.url=this.__leaf.canvas.toDataURL("image/png"),s}};const{max:ws,add:Ln}=Fr,Qf={__updateStrokeSpread(){let e=0,t=0;const i=this.__,{strokeAlign:s,__maxStrokeWidth:r}=i,n=this.__box;if((i.stroke||i.hitStroke==="all")&&r&&s!=="inside"&&(t=e=s==="center"?r/2:r,!i.__boxStroke)){const a=i.__isLinePath?0:10*e,o=i.strokeCap==="none"?0:r;e+=Math.max(a,o)}return i.__useArrow&&(e+=5*r),n&&(e=ws(e,n.__layout.strokeSpread=n.__updateStrokeSpread()),t=Math.max(t,n.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=t,e},__updateRenderSpread(){let e=0;const{shadow:t,innerShadow:i,blur:s,backgroundBlur:r,filter:n,renderSpread:a}=this.__,{strokeSpread:o}=this.__layout,l=this.__box;t&&(e=di.getShadowRenderSpread(this,t)),s&&(e=ws(e,s)),n&&(e=Ln(e,Gh.getSpread(n))),a&&(e=Ln(e,a)),o&&(e=Ln(e,o));let h=e;return i&&(h=ws(h,di.getInnerShadowSpread(this,i))),r&&(h=ws(h,r)),this.__layout.renderShapeSpread=h,l?ws(l.__updateRenderSpread(),e):e}},{stintSet:mr}=gt,Jf={__updateChange(){const e=this.__;if(e.__useStroke){const t=e.__useStroke=!(!e.stroke||!e.strokeWidth);mr(this.__world,"half",t&&e.strokeAlign==="center"&&e.strokeWidth%2),mr(e,"__fillAfterStroke",t&&e.strokeAlign==="outside"&&e.fill&&!e.__isTransparentFill)}if(e.__useEffect){const{shadow:t,fill:i,stroke:s}=e,r=e.innerShadow||e.blur||e.backgroundBlur||e.filter;mr(e,"__isFastShadow",t&&!r&&t.length<2&&!t[0].spread&&!di.isTransformShadow(t[0])&&i&&!e.__isTransparentFill&&!(Lt(i)&&i.length>1)&&(this.useFastShadow||!s||s&&e.strokeAlign==="inside")),e.__useEffect=!(!t&&!r)}e.__checkSingle(),mr(e,"__complex",e.__isFills||e.__isStrokes||e.cornerRadius||e.__useEffect)},__drawFast(e,t){cl(this,e,t)},__draw(e,t,i){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:r,stroke:n,__drawAfterFill:a,__fillAfterStroke:o,__isFastShadow:l}=s;if(this.__drawRenderPath(e),s.__useEffect&&!l){const h=it.shape(this,e,t);this.__nowWorld=this.__getNowWorld(t);const{shadow:d,innerShadow:c,filter:u}=s;d&&di.shadow(this,e,h),o&&(s.__isStrokes?it.strokes(n,this,e,t):it.stroke(n,this,e,t)),r&&(s.__isFills?it.fills(r,this,e,t):it.fill(r,this,e,t)),a&&this.__drawAfterFill(e,t),c&&di.innerShadow(this,e,h),n&&!o&&(s.__isStrokes?it.strokes(n,this,e,t):it.stroke(n,this,e,t)),u&&Gh.apply(u,this,this.__nowWorld,e,i,h),h.worldCanvas&&h.worldCanvas.recycle(),h.canvas.recycle()}else{if(o&&(s.__isStrokes?it.strokes(n,this,e,t):it.stroke(n,this,e,t)),l){const h=s.shadow[0],{scaleX:d,scaleY:c}=this.getRenderScaleData(!0,h.scaleFixed);e.save(),e.setWorldShadow(h.x*d,h.y*c,h.blur*d,te.string(h.color))}r&&(s.__isFills?it.fills(r,this,e,t):it.fill(r,this,e,t)),l&&e.restore(),a&&this.__drawAfterFill(e,t),n&&!o&&(s.__isStrokes?it.strokes(n,this,e,t):it.stroke(n,this,e,t))}}else s.__pathForRender?cl(this,e,t):this.__drawFast(e,t)},__drawShape(e,t){this.__drawRenderPath(e);const i=this.__,{fill:s,stroke:r}=i;s&&!t.ignoreFill&&(i.__isAlphaPixelFill?it.fills(s,this,e,t):it.fill("#000000",this,e,t)),i.__isCanvas&&this.__drawAfterFill(e,t),r&&!t.ignoreStroke&&(i.__isAlphaPixelStroke?it.strokes(r,this,e,t):it.stroke("#000000",this,e,t))},__drawAfterFill(e,t){this.__.__clipAfterFill?(e.save(),e.clipUI(this),this.__drawContent(e,t),e.restore()):this.__drawContent(e,t)}};function cl(e,t,i){const{fill:s,stroke:r,__drawAfterFill:n,__fillAfterStroke:a}=e.__;e.__drawRenderPath(t),a&&it.stroke(r,e,t,i),s&&it.fill(s,e,t,i),n&&e.__drawAfterFill(t,i),r&&!a&&it.stroke(r,e,t,i)}const Zf={__drawFast(e,t){let{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;const{fill:a,stroke:o,__drawAfterFill:l}=this.__;if(a&&(e.fillStyle=a,e.fillRect(i,s,r,n)),l&&this.__drawAfterFill(e,t),o){const{strokeAlign:h,__strokeWidth:d}=this.__;if(!d)return;e.setStroke(o,d,this.__);const c=d/2;switch(h){case"center":e.strokeRect(0,0,r,n);break;case"inside":r-=d,n-=d,r<0||n<0?(e.save(),this.__clip(e,t),e.strokeRect(i+c,s+c,r,n),e.restore()):e.strokeRect(i+c,s+c,r,n);break;case"outside":e.strokeRect(i-c,s-c,r+d,n+d)}}}};var fa;let S=fa=class extends rs{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(e){Nt.assignScale(this,e)}get scale(){return this.__.scale}get isAutoWidth(){const e=this.__;return e.__autoWidth||e.autoWidth}get isAutoHeight(){const e=this.__;return e.__autoHeight||e.autoHeight}get pen(){const{path:e}=this.__;return gs.set(this.path=e||[]),e||this.__drawPathByBox(gs),gs}reset(e){}set(e,t){e&&Object.assign(this,e)}get(e){return Et(e)?this.__.__getInput(e):this.__.__getInputData(e)}createProxyData(){}find(e,t){return Zt.need("find")}findTag(e){return this.find({tag:e})}findOne(e,t){return Zt.need("find")}findId(e){return this.findOne({id:e})}getPath(e,t){this.__layout.update();let i=t?this.__.__pathForRender:this.__.path;return i||(gs.set(i=[]),this.__drawPathByBox(gs,!t)),e?Oi.toCanvasData(i,!0):i}getPathString(e,t,i){return Oi.stringify(this.getPath(e,t),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const e=this.__;!e.lazy||this.__inLazyBounds||Df.running?e.__computePaint():e.__needComputePaint=!0}}__updateRenderPath(){const e=this.__;e.path?(e.__pathForRender=e.cornerRadius?Qu.smooth(e.path,e.cornerRadius,e.cornerSmoothing):e.path,e.__useArrow&&If.addArrows(this)):e.__pathForRender&&(e.__pathForRender=void 0)}__drawRenderPath(e){e.beginPath(),this.__drawPathByData(e,this.__.__pathForRender)}__drawPath(e){e.beginPath(),this.__drawPathByData(e,this.__.path,!0)}__drawPathByData(e,t,i){t?Lu.drawPathByData(e,t):this.__drawPathByBox(e,i)}__drawPathByBox(e,t){const{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;if(this.__.cornerRadius&&!t){const{cornerRadius:a}=this.__;e.roundRect(i,s,r,n,St(a)?[a]:a)}else e.rect(i,s,r,n);e.closePath()}drawImagePlaceholder(e,t,i){it.fill(this.__.placeholderColor,this,t,i)}animate(e,t,i,s){return this.set(e),Zt.need("animate")}killAnimate(e,t){}export(e,t){return Zt.need("export")}syncExport(e,t){return Zt.need("export")}clone(e){const t=gt.clone(this.toJSON());return e&&Object.assign(t,e),fa.one(t)}static one(e,t,i,s,r){return Ys.get(e.tag||this.prototype.__tag,e,t,i,s,r)}static registerUI(){Ft()(this)}static registerData(e){zt(e)(this.prototype)}static setEditConfig(e){}static setEditOuter(e){}static setEditInner(e){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};f([zt(pi)],S.prototype,"__",void 0),f([$f()],S.prototype,"zoomLayer",void 0),f([Ut("")],S.prototype,"id",void 0),f([Ut("")],S.prototype,"name",void 0),f([Ut("")],S.prototype,"className",void 0),f([li("pass-through")],S.prototype,"blendMode",void 0),f([hp(1)],S.prototype,"opacity",void 0),f([cp(!0)],S.prototype,"visible",void 0),f([li(!1)],S.prototype,"locked",void 0),f([Ao(!1)],S.prototype,"dim",void 0),f([Ao(!1)],S.prototype,"dimskip",void 0),f([dp(0)],S.prototype,"zIndex",void 0),f([up(!1)],S.prototype,"mask",void 0),f([pp(!1)],S.prototype,"eraser",void 0),f([gr(0,!0)],S.prototype,"x",void 0),f([gr(0,!0)],S.prototype,"y",void 0),f([tt(100,!0)],S.prototype,"width",void 0),f([tt(100,!0)],S.prototype,"height",void 0),f([Mo(1,!0)],S.prototype,"scaleX",void 0),f([Mo(1,!0)],S.prototype,"scaleY",void 0),f([mn(0,!0)],S.prototype,"rotation",void 0),f([mn(0,!0)],S.prototype,"skewX",void 0),f([mn(0,!0)],S.prototype,"skewY",void 0),f([gr(0,!0)],S.prototype,"offsetX",void 0),f([gr(0,!0)],S.prototype,"offsetY",void 0),f([Lo(0,!0)],S.prototype,"scrollX",void 0),f([Lo(0,!0)],S.prototype,"scrollY",void 0),f([Oo()],S.prototype,"origin",void 0),f([Oo()],S.prototype,"around",void 0),f([Ut(!1)],S.prototype,"lazy",void 0),f([ap(1)],S.prototype,"pixelRatio",void 0),f([Ba(0)],S.prototype,"renderSpread",void 0),f([op()],S.prototype,"path",void 0),f([Vt()],S.prototype,"windingRule",void 0),f([Vt(!0)],S.prototype,"closed",void 0),f([tt(0)],S.prototype,"padding",void 0),f([tt(!1)],S.prototype,"lockRatio",void 0),f([tt()],S.prototype,"widthRange",void 0),f([tt()],S.prototype,"heightRange",void 0),f([Ut(!1)],S.prototype,"draggable",void 0),f([Ut()],S.prototype,"dragBounds",void 0),f([Ut("auto")],S.prototype,"dragBoundsType",void 0),f([Ut(!1)],S.prototype,"editable",void 0),f([Ti(!0)],S.prototype,"hittable",void 0),f([Ti("path")],S.prototype,"hitFill",void 0),f([Le("path")],S.prototype,"hitStroke",void 0),f([Ti(!1)],S.prototype,"hitBox",void 0),f([Ti(!0)],S.prototype,"hitChildren",void 0),f([Ti(!0)],S.prototype,"hitSelf",void 0),f([Ti()],S.prototype,"hitRadius",void 0),f([fp("")],S.prototype,"cursor",void 0),f([li()],S.prototype,"fill",void 0),f([Le(void 0,!0)],S.prototype,"stroke",void 0),f([Le("inside")],S.prototype,"strokeAlign",void 0),f([Le(1,!0)],S.prototype,"strokeWidth",void 0),f([Le(!1)],S.prototype,"strokeWidthFixed",void 0),f([Le("none")],S.prototype,"strokeCap",void 0),f([Le("miter")],S.prototype,"strokeJoin",void 0),f([Le()],S.prototype,"dashPattern",void 0),f([Le(0)],S.prototype,"dashOffset",void 0),f([Le(10)],S.prototype,"miterLimit",void 0),f([Vt(0)],S.prototype,"cornerRadius",void 0),f([Vt()],S.prototype,"cornerSmoothing",void 0),f([Vi()],S.prototype,"shadow",void 0),f([Vi()],S.prototype,"innerShadow",void 0),f([Vi()],S.prototype,"blur",void 0),f([Vi()],S.prototype,"backgroundBlur",void 0),f([Vi()],S.prototype,"grayscale",void 0),f([Vi()],S.prototype,"filter",void 0),f([li()],S.prototype,"placeholderColor",void 0),f([Ut(100)],S.prototype,"placeholderDelay",void 0),f([Ut({})],S.prototype,"data",void 0),f([Ke(rs.prototype.reset)],S.prototype,"reset",null),S=fa=f([ke(Qf),ke(Jf),Vr()],S);let Se=class extends S{get __tag(){return"Group"}get isBranch(){return!0}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,i){if(t)if(t.children){const{children:s}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,i),s.forEach(r=>this.add(r)),t.children=s}else super.set(t,i)}toJSON(t){const i=super.toJSON(t);return this.childlessJSON||(i.children=this.children.map(s=>s.toJSON(t))),i}pick(t,i){}addAt(t,i){this.add(t,i)}addAfter(t,i){this.add(t,this.children.indexOf(i)+1)}addBefore(t,i){this.add(t,this.children.indexOf(i))}add(t,i){}addMany(...t){}remove(t,i){}removeAll(t){}clear(){}};var $r;f([zt(Xr)],Se.prototype,"__",void 0),f([tt(0)],Se.prototype,"width",void 0),f([tt(0)],Se.prototype,"height",void 0),Se=f([ke(pa),Ft()],Se);const tg=yt.get("Leafer");let Qe=$r=class extends Se{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Pi.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||bh()}constructor(e,t){super(t),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=e,e&&(e.view||e.width)&&this.init(e),$r.list.add(this)}init(e,t){if(this.canvas)return;let i;const{config:s}=this;this.__setLeafer(this),t&&(this.parentApp=t,this.__bindApp(t),i=t.running),e&&(this.parent=t,this.initType(e.type),this.parent=void 0,gt.assign(s,e));const r=this.canvas=Tt.canvas(s);this.__controllers.push(this.renderer=Tt.renderer(this,r,s),this.watcher=Tt.watcher(this,s),this.layouter=Tt.layouter(this,s)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),t||(this.selector=Tt.selector(this),this.interaction=Tt.interaction(this,r,this.selector,s),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=Tt.hitCanvasManager()),this.canvasManager=new Bh,i=s.start),this.hittable=s.hittable,this.fill=s.fill,this.canvasManager.add(r),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),ms.run(this.__initWait),this.onInit()}onInit(){}initType(e){}set(e,t){this.waitInit(()=>{super.set(e,t)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(nt.RESTART):this.emitLeafer(nt.START),this.__controllers.forEach(e=>e.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(e=>e.stop()),this.running=!1,this.emitLeafer(nt.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(e){const t=gt.copyAttrs({},e,be);Object.keys(t).forEach(i=>this[i]=t[i])}forceRender(e,t){const{renderer:i}=this;i&&(i.addBlock(e?new Ot(e):this.canvas.bounds),this.viewReady&&(t?i.render():i.update()))}requestRender(e=!1){this.renderer&&this.renderer.update(e)}updateCursor(e){const t=this.interaction;t&&(e?t.setCursor(e):t.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(e){const{canvas:t}=this;if(!t||t.isSameSize(e))return;const i=gt.copyAttrs({},this.canvas,be);t.resize(e),this.updateLazyBounds(),this.__onResize(new ui(e,i))}__onResize(e){this.emitEvent(e),gt.copyAttrs(this.__,e,be),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(e){this.selector=e.selector,this.interaction=e.interaction,this.canvasManager=e.canvasManager,this.hitCanvasManager=e.hitCanvasManager}__setLeafer(e){this.leafer=e,this.__level=1}__checkAutoLayout(){const{config:e,parentApp:t}=this;t||(e.width&&e.height||(this.autoLayout=new Jc(e)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(e,t){return this.canvas&&(be.includes(e)?this.__changeCanvasSize(e,t):e==="fill"?this.__changeFill(t):e==="hittable"?this.parent||(this.canvas.hittable=t):e==="zIndex"?(this.canvas.zIndex=t,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):e==="mode"&&this.emit(nt.UPDATE_MODE,{mode:t})),super.__setAttr(e,t)}__getAttr(e){return this.canvas&&be.includes(e)?this.canvas[e]:super.__getAttr(e)}__changeCanvasSize(e,t){const{config:i,canvas:s}=this,r=gt.copyAttrs({},s,be);r[e]=i[e]=t,i.width&&i.height?s.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(r)}__changeFill(e){this.config.fill=e,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=e:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(nt.BEFORE_READY),this.emitLeafer(nt.READY),this.emitLeafer(nt.AFTER_READY),ms.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(nt.VIEW_READY),ms.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:e,width:t,height:i}=this.config;if(e){let{width:s,height:r,pixelRatio:n}=this;const a=e==="box"?this.worldBoxBounds:this.__world;t||(s=Math.max(1,a.x+a.width)),i||(r=Math.max(1,a.y+a.height)),this.__doResize({width:s,height:r,pixelRatio:n})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){ms.run(this.__nextRenderWait);const{imageReady:e}=this;e&&!this.viewCompleted&&this.__checkViewCompleted(),e||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(e=!0){this.nextRender(()=>{this.imageReady&&(e&&this.emitLeafer(nt.VIEW_COMPLETED),ms.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(e,t){t&&(e=e.bind(t)),this.__initWait||(this.__initWait=[]),this.canvas?e():this.__initWait.push(e)}waitReady(e,t){t&&(e=e.bind(t)),this.ready?e():this.__readyWait.push(e)}waitViewReady(e,t){t&&(e=e.bind(t)),this.viewReady?e():this.__viewReadyWait.push(e)}waitViewCompleted(e,t){t&&(e=e.bind(t)),this.__viewCompletedWait.push(e),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(e,t,i){t&&(e=e.bind(t));const s=this.__nextRenderWait;if(i){for(let r=0;r<s.length;r++)if(s[r]===e){s.splice(r,1);break}}else s.push(e);this.requestRender()}zoom(e,t,i,s){return Zt.need("view")}getValidMove(e,t,i){return{x:e,y:t}}getValidScale(e){return e}getWorldPointByClient(e,t){return this.interaction&&this.interaction.getLocal(e,t)}getPagePointByClient(e,t){return this.getPagePoint(this.getWorldPointByClient(e,t))}getClientPointByWorld(e){const{x:t,y:i}=this.clientBounds;return{x:t+e.x,y:i+e.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(e){}emitLeafer(e){this.emitEvent(new nt(e,this))}__listenEvents(){const e=Te.start("FirstCreate "+this.innerName);this.once([[nt.START,()=>Te.end(e)],[vt.START,this.updateLazyBounds,this],[ut.START,this.__onCreated,this],[ut.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[ci.DATA,this.__onWatchData,this],[vt.END,this.__onLayoutEnd,this],[ut.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(e){const t=()=>{if(!this.destroyed){$r.list.remove(this);try{this.stop(),this.emitLeafer(nt.END),this.__removeListenEvents(),this.__controllers.forEach(i=>!(this.parent&&i===this.interaction)&&i.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{Ee.clearRecycled()},100)}catch(i){tg.error(i)}}};e?t():setTimeout(t)}};Qe.list=new bt,f([zt(zf)],Qe.prototype,"__",void 0),f([tt()],Qe.prototype,"pixelRatio",void 0),f([Ut("normal")],Qe.prototype,"mode",void 0),Qe=$r=f([Ft()],Qe);let Dt=class extends S{get __tag(){return"Rect"}};f([zt(Pa)],Dt.prototype,"__",void 0),Dt=f([ke(Zf),Vr(),Ft()],Dt);const{add:dl,includes:eg,scroll:ig}=I,wi=Dt.prototype,sg=Se.prototype;let It=class extends Se{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){if(this.children.length&&!this.pathInputed){const i=this.__;if(i.__autoSide){i.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:s}=this.__layout;i.__autoSize||(i.__autoWidth?(s.width+=s.x,s.x=0,s.height=i.height,s.y=0):(s.height+=s.y,s.y=0,s.width=i.width,s.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t,i;if(this.children.length){const s=this.__,r=this.__layout,{renderBounds:n,boxBounds:a}=r,{overflow:o}=s,l=r.childrenRenderBounds||(r.childrenRenderBounds=bh());super.__updateRenderBounds(l),(i=o&&o.includes("scroll"))&&(dl(l,a),ig(l,s)),this.__updateRectRenderBounds(),t=!eg(a,l),t&&o==="show"&&dl(n,l)}else this.__updateRectRenderBounds();gt.stintSet(this,"isOverflow",t),this.__checkScroll(i)}__updateRectRenderBounds(){}__checkScroll(t){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,i){}__renderGroup(t,i){}__render(t,i){this.__.__drawAfterFill?this.__renderRect(t,i):(this.__renderRect(t,i),this.children.length&&this.__renderGroup(t,i)),this.hasScroller&&this.scroller.__render(t,i)}__drawContent(t,i){this.__renderGroup(t,i),(this.__.__useStroke||this.__.__useEffect)&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};f([zt(jh)],It.prototype,"__",void 0),f([tt(100)],It.prototype,"width",void 0),f([tt(100)],It.prototype,"height",void 0),f([Ut(!1)],It.prototype,"resizeChildren",void 0),f([Ba("show")],It.prototype,"overflow",void 0),f([Ke(wi.__updateStrokeSpread)],It.prototype,"__updateStrokeSpread",null),f([Ke(wi.__updateRenderSpread)],It.prototype,"__updateRectRenderSpread",null),f([Ke(wi.__updateBoxBounds)],It.prototype,"__updateRectBoxBounds",null),f([Ke(wi.__updateStrokeBounds)],It.prototype,"__updateStrokeBounds",null),f([Ke(wi.__updateRenderBounds)],It.prototype,"__updateRectRenderBounds",null),f([Ke(wi.__updateChange)],It.prototype,"__updateRectChange",null),f([Ke(wi.__render)],It.prototype,"__renderRect",null),f([Ke(sg.__render)],It.prototype,"__renderGroup",null),It=f([Vr(),Ft()],It);let bs=class extends It{get __tag(){return"Frame"}get isFrame(){return!0}};f([zt(Ff)],bs.prototype,"__",void 0),f([li("#FFFFFF")],bs.prototype,"fill",void 0),f([Ba("hide")],bs.prototype,"overflow",void 0),bs=f([Ft()],bs);const{moveTo:ul,closePath:rg,ellipse:qi}=Ai;let ne=class extends S{get __tag(){return"Ellipse"}__updatePath(){const{width:t,height:i,innerRadius:s,startAngle:r,endAngle:n}=this.__,a=t/2,o=i/2,l=this.__.path=[];let h;s?r||n?(s<1?qi(l,a,o,a*s,o*s,0,r,n,!1):h=!0,qi(l,a,o,a,o,0,n,r,!0)):(s<1&&(qi(l,a,o,a*s,o*s),ul(l,t,o)),qi(l,a,o,a,o,0,360,0,!0)):r||n?(ul(l,a,o),qi(l,a,o,a,o,0,r,n,!1)):qi(l,a,o,a,o),h||rg(l),A.ellipseToCurve&&(this.__.path=this.getPath(!0))}};f([zt(Hf)],ne.prototype,"__",void 0),f([Vt(0)],ne.prototype,"innerRadius",void 0),f([Vt(0)],ne.prototype,"startAngle",void 0),f([Vt(0)],ne.prototype,"endAngle",void 0),ne=f([Ft()],ne);const{sin:ng,cos:ag,PI:pl}=Math,{moveTo:og,lineTo:lg,closePath:hg,drawPoints:cg}=Ai;let Xi=class extends S{get __tag(){return"Polygon"}__updatePath(){const t=this.__,i=t.path=[];if(t.points)cg(i,t.points,t.curve,!0);else{const{width:s,height:r,sides:n}=t,a=s/2,o=r/2;og(i,a,0);for(let l=1;l<n;l++)lg(i,a+a*ng(2*l*pl/n),o-o*ag(2*l*pl/n));hg(i)}}};f([zt(Yf)],Xi.prototype,"__",void 0),f([Vt(3)],Xi.prototype,"sides",void 0),f([Vt()],Xi.prototype,"points",void 0),f([Vt(0)],Xi.prototype,"curve",void 0),Xi=f([Vr(),Ft()],Xi);const{sin:dg,cos:ug,PI:fl}=Math,{moveTo:pg,lineTo:fg,closePath:gg}=Ai;let ks=class extends S{get __tag(){return"Star"}__updatePath(){const{width:t,height:i,corners:s,innerRadius:r}=this.__,n=t/2,a=i/2,o=this.__.path=[];pg(o,n,0);for(let l=1;l<2*s;l++)fg(o,n+(l%2==0?n:n*r)*dg(l*fl/s),a-(l%2==0?a:a*r)*ug(l*fl/s));gg(o)}};f([zt(Vf)],ks.prototype,"__",void 0),f([Vt(5)],ks.prototype,"corners",void 0),f([Vt(.382)],ks.prototype,"innerRadius",void 0),ks=f([Ft()],ks);const{moveTo:_g,lineTo:yg,drawPoints:mg}=Ai,{rotate:vg,getAngle:xg,getDistance:wg,defaultPoint:gl}=Q;let ni=class extends S{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:i}=this.__,s=Vc();return t&&(s.x=t),i&&vg(s,i),s}set toPoint(t){this.width=wg(gl,t),this.rotation=xg(gl,t),this.height&&(this.height=0)}__updatePath(){const t=this.__,i=t.path=[];t.points?mg(i,t.points,t.curve,t.closed):(_g(i,0,0),yg(i,this.width,0))}};f([zt(Uh)],ni.prototype,"__",void 0),f([Yr("center")],ni.prototype,"strokeAlign",void 0),f([tt(0)],ni.prototype,"height",void 0),f([Vt()],ni.prototype,"points",void 0),f([Vt(0)],ni.prototype,"curve",void 0),f([Vt(!1)],ni.prototype,"closed",void 0),ni=f([Ft()],ni);let vr=class extends Dt{get __tag(){return"Image"}get ready(){const{image:t}=this;return t&&t.ready}get image(){const{fill:t}=this.__;return Lt(t)&&t[0].image}};f([zt(Uf)],vr.prototype,"__",void 0),f([tt("")],vr.prototype,"url",void 0),vr=f([Ft()],vr);let Ye=class extends Dt{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(t){super(t),this.canvas=Tt.canvas(this.__),t&&t.url&&this.drawImage(t.url)}drawImage(t){new Fh({url:t}).load(i=>{this.context.drawImage(i.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Ze(Ze.LOADED,{image:i}))})}draw(t,i,s,r){const n=new Li(t.worldTransform).invert(),a=new Li;i&&a.translate(i.x,i.y),s&&(St(s)?a.scale(s):a.scale(s.x,s.y)),r&&a.rotate(r),n.multiplyParent(a),t.__render(this.canvas,{matrix:n.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,i){const{width:s,height:r}=this.__,{view:n}=this.canvas;t.drawImage(n,0,0,n.width,n.height,0,0,s,r)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:i,safeResize:s}=this.__;t.resize(this.__,s),t.smooth!==i&&(t.smooth=i)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};f([zt(Kf)],Ye.prototype,"__",void 0),f([vs(100)],Ye.prototype,"width",void 0),f([vs(100)],Ye.prototype,"height",void 0),f([vs(1)],Ye.prototype,"pixelRatio",void 0),f([vs(!0)],Ye.prototype,"smooth",void 0),f([Ut(!1)],Ye.prototype,"safeResize",void 0),f([vs()],Ye.prototype,"contextSettings",void 0),Ye=f([Ft()],Ye);const{copyAndSpread:bg,includes:kg,spread:Sg,setList:Tg}=I,{stintSet:On}=gt;let Z=class extends S{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const t=this.__,{lineHeight:i,letterSpacing:s,fontFamily:r,fontSize:n,fontWeight:a,italic:o,textCase:l,textOverflow:h,padding:d,width:c,height:u}=t;t.__lineHeight=nl.number(i,n),t.__letterSpacing=nl.number(s,n),t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*n)/2,t.__font=`${o?"italic ":""}${l==="small-caps"?"small-caps ":""}${a!=="normal"?a+" ":""}${n||12}px ${r||"caption"}`,On(t,"__padding",d&&Nt.fourNumber(d)),On(t,"__clipText",h!=="show"&&!t.__autoSize),On(t,"__isCharMode",c||u||t.__letterSpacing||l!=="none"),t.__textDrawData=Xh.getDrawData((t.__isPlacehold=t.placeholder&&t.text==="")?t.placeholder:t.text,this.__)}__updateBoxBounds(){const t=this.__,i=this.__layout,{fontSize:s,italic:r,padding:n,__autoWidth:a,__autoHeight:o}=t;this.__updateTextDrawData();const{bounds:l}=t.__textDrawData,h=i.boxBounds;if(i.contentBounds=l,t.__lineHeight<s&&Sg(l,s/2),a||o){if(h.x=a?l.x:0,h.y=o?l.y:0,h.width=a?l.width:t.width,h.height=o?l.height:t.height,n){const[d,c,u,p]=t.__padding;a&&(h.x-=p,h.width+=c+p),o&&(h.y-=d,h.height+=u+d)}this.__updateNaturalSize()}else super.__updateBoxBounds();r&&(h.width+=.16*s),gt.stintSet(this,"isOverflow",!kg(h,l)),this.isOverflow?(Tg(t.__textBoxBounds={},[h,l]),i.renderChanged=!0):t.__textBoxBounds=h}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.isOverflow?1:0),t}__updateRenderBounds(){const{renderBounds:t,renderSpread:i}=this.__layout;bg(t,this.__.__textBoxBounds,i),this.__box&&(this.__box.__layout.renderBounds=t)}__updateChange(){super.__updateChange();const t=this.__box;t&&(t.__onUpdateSize(),t.__updateChange())}__drawRenderPath(t){t.font=this.__.__font}__draw(t,i,s){const r=this.__box;r&&(r.__nowWorld=this.__nowWorld,r.__draw(t,i,s)),this.textEditing&&!i.exporting||super.__draw(t,i,s)}__drawShape(t,i){i.shape&&this.__box&&this.__box.__drawShape(t,i),super.__drawShape(t,i)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};f([zt(jf)],Z.prototype,"__",void 0),f([tt(0)],Z.prototype,"width",void 0),f([tt(0)],Z.prototype,"height",void 0),f([li()],Z.prototype,"boxStyle",void 0),f([Ut(!1)],Z.prototype,"resizeFontSize",void 0),f([li("#000000")],Z.prototype,"fill",void 0),f([Yr("outside")],Z.prototype,"strokeAlign",void 0),f([Ti("all")],Z.prototype,"hitFill",void 0),f([tt("")],Z.prototype,"text",void 0),f([tt("")],Z.prototype,"placeholder",void 0),f([tt("caption")],Z.prototype,"fontFamily",void 0),f([tt(12)],Z.prototype,"fontSize",void 0),f([tt("normal")],Z.prototype,"fontWeight",void 0),f([tt(!1)],Z.prototype,"italic",void 0),f([tt("none")],Z.prototype,"textCase",void 0),f([tt("none")],Z.prototype,"textDecoration",void 0),f([tt(0)],Z.prototype,"letterSpacing",void 0),f([tt({type:"percent",value:1.5})],Z.prototype,"lineHeight",void 0),f([tt(0)],Z.prototype,"paraIndent",void 0),f([tt(0)],Z.prototype,"paraSpacing",void 0),f([tt("x")],Z.prototype,"writingMode",void 0),f([tt("left")],Z.prototype,"textAlign",void 0),f([tt("top")],Z.prototype,"verticalAlign",void 0),f([tt(!0)],Z.prototype,"autoSizeAlign",void 0),f([tt("normal")],Z.prototype,"textWrap",void 0),f([tt("show")],Z.prototype,"textOverflow",void 0),f([li(!1)],Z.prototype,"textEditing",void 0),Z=f([Ft()],Z);let Is=class extends S{get __tag(){return"Path"}};f([zt(qf)],Is.prototype,"__",void 0),f([Yr("center")],Is.prototype,"strokeAlign",void 0),Is=f([Ft()],Is);let xr=class extends Se{get __tag(){return"Pen"}setStyle(t){const i=this.pathElement=new Is(t);return this.pathStyle=t,this.__path=i.path||(i.path=[]),this.add(i),this}beginPath(){return this}moveTo(t,i){return this}lineTo(t,i){return this}bezierCurveTo(t,i,s,r,n,a){return this}quadraticCurveTo(t,i,s,r){return this}closePath(){return this}rect(t,i,s,r){return this}roundRect(t,i,s,r,n){return this}ellipse(t,i,s,r,n,a,o,l){return this}arc(t,i,s,r,n,a){return this}arcTo(t,i,s,r,n){return this}drawEllipse(t,i,s,r,n,a,o,l){return this}drawArc(t,i,s,r,n,a){return this}drawPoints(t,i,s){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};f([zt(Xf)],xr.prototype,"__",void 0),f([(e,t)=>{as(e,t,{get(){return this.__path}})}],xr.prototype,"path",void 0),xr=f([ke(Dh,["set","path","paint"]),Ft()],xr);function Ie(e,t,i,s){var r,n=arguments.length,a=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}let _l=class extends Qe{get __tag(){return"App"}get isApp(){return!0}constructor(e,t){super(e,t)}init(e,t){if(super.init(e,t),e){const{ground:i,tree:s,sky:r,editor:n}=e;i&&(this.ground=this.addLeafer(i)),(s||n)&&(this.tree=this.addLeafer(s||{type:e.type||"design"})),(r||n)&&(this.sky=this.addLeafer(r)),n&&Tt.editor(n,this)}}__setApp(){const{canvas:e}=this,{realCanvas:t,view:i}=this.config;t||i===this.canvas.view||!e.parentView?this.realCanvas=!0:e.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(e=>e.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(e=>e.start())}stop(){this.forEach(e=>e.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(e=>e.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(e=>e.lockLayout())}forceRender(e,t){this.forEach(i=>i.forceRender(e,t))}addLeafer(e){const t=new Qe(e);return this.add(t),t}add(e,t){if(!e.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(e,t),10);e.init(this.__getChildConfig(e.userConfig),this)}super.add(e,t),G(t)||(e.canvas.childIndex=t),this.__listenChildEvents(e)}forEach(e){this.children.forEach(e)}__onCreated(){this.created=this.children.every(e=>e.created)}__onReady(){this.children.every(e=>e.ready)&&super.__onReady()}__onViewReady(){this.children.every(e=>e.viewReady)&&super.__onViewReady()}__onChildRenderEnd(e){this.renderer.addBlock(e.renderBounds),this.viewReady&&this.renderer.update()}__render(e,t){e.context&&this.forEach(i=>t.matrix?i.__render(e,t):e.copyWorld(i.canvas,t.bounds))}__onResize(e){this.forEach(t=>t.resize(e)),super.__onResize(e)}updateLayout(){this.forEach(e=>e.updateLayout())}__getChildConfig(e){const t=Object.assign({},this.config);return t.hittable=t.realCanvas=void 0,e&&gt.assign(t,e),this.autoLayout&&gt.copyAttrs(t,this,be),t.view=this.realCanvas?void 0:this.view,t.fill=void 0,t}__listenChildEvents(e){e.once([[vt.END,this.__onReady,this],[ut.START,this.__onCreated,this],[ut.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(e.on_(ut.END,this.__onChildRenderEnd,this))}};_l=Ie([Ft()],_l);const wr={},ts={isHoldSpaceKey:()=>ts.isHold("Space"),isHold:e=>wr[e],isHoldKeys:(e,t)=>t?e(t):void 0,setDownCode(e){wr[e]||(wr[e]=!0)},setUpCode(e){wr[e]=!1}},xe={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(e){e.buttons||(e.buttons=1)},left:e=>e.buttons===1,right:e=>e.buttons===2,middle:e=>e.buttons===4};class Ra extends $e{get spaceKey(){return ts.isHoldSpaceKey()}get left(){return xe.left(this)}get right(){return xe.right(this)}get middle(){return xe.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}isHoldKeys(t){return ts.isHoldKeys(t,this)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,i){ss.changeName(t,i)}}const{min:yl,max:Mn,abs:ml}=Math,{float:Gt,sign:vl}=Nt,{minX:xl,maxX:wl,minY:bl,maxY:kl}=I,kt=new Ot,Ve=new Ot,ga={limitMove(e,t){const{dragBounds:i,dragBoundsType:s}=e;i&&qe.getValidMove(e.__localBoxBounds,qe.getDragBounds(e),s,t,!0),qe.axisMove(e,t)},limitScaleOf(e,t,i,s){const{dragBounds:r,dragBoundsType:n}=e;r&&qe.getValidScaleOf(e.__localBoxBounds,qe.getDragBounds(e),n,e.getLocalPointByInner(e.getInnerPointByBox(t)),i,s,!0)},axisMove(e,t){const{draggable:i}=e;i==="x"&&(t.y=0),i==="y"&&(t.x=0)},getDragBounds(e){const{dragBounds:t}=e;return t==="parent"?e.parent.boxBounds:t},isInnerMode:(e,t,i,s)=>i==="inner"||i==="auto"&&e[s]>t[s],getValidMove(e,t,i,s,r){const n=e.x+s.x,a=e.y+s.y,o=n+e.width,l=a+e.height,h=t.x+t.width,d=t.y+t.height;return r||(s=Object.assign({},s)),qe.isInnerMode(e,t,i,"width")?n>t.x?s.x+=t.x-n:o<h&&(s.x+=h-o):n<t.x?s.x+=t.x-n:o>h&&(s.x+=h-o),qe.isInnerMode(e,t,i,"height")?a>t.y?s.y+=t.y-a:l<d&&(s.y+=d-l):a<t.y?s.y+=t.y-a:l>d&&(s.y+=d-l),s.x=Gt(s.x),s.y=Gt(s.y),s},getValidScaleOf(e,t,i,s,r,n,a){a||(r=Object.assign({},r)),Ve.set(t),kt.set(e).scaleOf(s,r.x,r.y);const o=(s.x-e.x)/e.width,l=1-o,h=(s.y-e.y)/e.height,d=1-h;let c,u,p,_,m=1,v=1;return qe.isInnerMode(e,t,i,"width")?(r.x<0&&kt.scaleOf(s,m=1/r.x,1),p=Gt(kt.minX-Ve.minX),_=Gt(Ve.maxX-kt.maxX),c=o&&p>0?1+p/(o*kt.width):1,u=l&&_>0?1+_/(l*kt.width):1,m*=Mn(c,u)):(r.x<0&&((Gt(xl(e)-xl(t))<=0||Gt(wl(t)-wl(e))<=0)&&kt.scaleOf(s,m=1/r.x,1),kt.unsign()),p=Gt(Ve.minX-kt.minX),_=Gt(kt.maxX-Ve.maxX),c=o&&p>0?1-p/(o*kt.width):1,u=l&&_>0?1-_/(l*kt.width):1,m*=yl(c,u)),qe.isInnerMode(e,t,i,"height")?(r.y<0&&kt.scaleOf(s,1,v=1/r.y),p=Gt(kt.minY-Ve.minY),_=Gt(Ve.maxY-kt.maxY),c=h&&p>0?1+p/(h*kt.height):1,u=d&&_>0?1+_/(d*kt.height):1,v*=Mn(c,u),n&&(c=Mn(ml(m),ml(v)),m=vl(m)*c,v=vl(v)*c)):(r.y<0&&((Gt(bl(e)-bl(t))<=0||Gt(kl(t)-kl(e))<=0)&&kt.scaleOf(s,1,v=1/r.y),kt.unsign()),p=Gt(Ve.minY-kt.minY),_=Gt(kt.maxY-Ve.maxY),c=h&&p>0?1-p/(h*kt.height):1,u=d&&_>0?1-_/(d*kt.height):1,v*=yl(c,u)),r.x*=ia(m)?m:1,r.y*=ia(v)?v:1,r}},qe=ga;let q=class extends Ra{};q.POINTER="pointer",q.BEFORE_DOWN="pointer.before_down",q.BEFORE_MOVE="pointer.before_move",q.BEFORE_UP="pointer.before_up",q.DOWN="pointer.down",q.MOVE="pointer.move",q.UP="pointer.up",q.OVER="pointer.over",q.OUT="pointer.out",q.ENTER="pointer.enter",q.LEAVE="pointer.leave",q.TAP="tap",q.DOUBLE_TAP="double_tap",q.CLICK="click",q.DOUBLE_CLICK="double_click",q.LONG_PRESS="long_press",q.LONG_TAP="long_tap",q.MENU="pointer.menu",q.MENU_TAP="pointer.menu_tap",q=Ie([ei()],q);const Ss={};let dt=class extends q{static setList(t){this.list=t instanceof bt?t:new bt(t)}static setData(t){this.data=t}static getValidMove(t,i,s,r=!0){const n=t.getLocalPoint(s,null,!0);return Q.move(n,i.x-t.x,i.y-t.y),r&&this.limitMove(t,n),ga.axisMove(t,n),n}static limitMove(t,i){ga.limitMove(t,i)}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Ss,null,!0)}getInnerMove(t,i){return t||(t=this.current),this.assignMove(i),t.getInnerPoint(Ss,null,!0)}getLocalMove(t,i){return t||(t=this.current),this.assignMove(i),t.getLocalPoint(Ss,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),i=this.getPagePoint(),s={};return I.set(s,i.x-t.x,i.y-t.y,t.x,t.y),I.unsign(s),s}assignMove(t){Ss.x=t?this.totalX:this.moveX,Ss.y=t?this.totalY:this.moveY}};dt.BEFORE_DRAG="drag.before_drag",dt.START="drag.start",dt.DRAG="drag",dt.END="drag.end",dt.OVER="drag.over",dt.OUT="drag.out",dt.ENTER="drag.enter",dt.LEAVE="drag.leave",dt=Ie([ei()],dt);let Ws=class extends q{static setList(t){dt.setList(t)}static setData(t){dt.setData(t)}};Ws.DROP="drop",Ws=Ie([ei()],Ws);let re=class extends dt{};re.BEFORE_MOVE="move.before_move",re.START="move.start",re.MOVE="move",re.DRAG_ANIMATE="move.drag_animate",re.END="move.end",re.PULL_DOWN="move.pull_down",re.REACH_BOTTOM="move.reach_bottom",re=Ie([ei()],re);let Sl=class extends Ra{};Sl=Ie([ei()],Sl);let Gi=class extends q{};Gi.BEFORE_ROTATE="rotate.before_rotate",Gi.START="rotate.start",Gi.ROTATE="rotate",Gi.END="rotate.end",Gi=Ie([ei()],Gi);let we=class extends dt{};we.SWIPE="swipe",we.LEFT="swipe.left",we.RIGHT="swipe.right",we.UP="swipe.up",we.DOWN="swipe.down",we=Ie([ei()],we);let ji=class extends q{};ji.BEFORE_ZOOM="zoom.before_zoom",ji.START="zoom.start",ji.ZOOM="zoom",ji.END="zoom.end",ji=Ie([ei()],ji);let fe=class extends Ra{};fe.BEFORE_DOWN="key.before_down",fe.BEFORE_UP="key.before_up",fe.DOWN="key.down",fe.HOLD="key.hold",fe.UP="key.up",fe=Ie([ei()],fe);const Ce={getDragEventData:(e,t,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-t.x,moveY:i.y-t.y,totalX:i.x-e.x,totalY:i.y-e.y}),getDropEventData:(e,t,i)=>Object.assign(Object.assign({},e),{list:t,data:i}),getSwipeDirection:e=>e<-45&&e>-135?we.UP:e>45&&e<135?we.DOWN:e<=45&&e>=-45?we.RIGHT:we.LEFT,getSwipeEventData:(e,t,i)=>Object.assign(Object.assign({},i),{moveX:t.moveX,moveY:t.moveY,totalX:i.x-e.x,totalY:i.y-e.y,type:Eg.getSwipeDirection(Q.getAngle(e,i))}),getBase(e){const t=e.button===1?4:e.button;return{altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,time:Date.now(),buttons:G(e.buttons)?1:e.buttons===0?t:e.buttons,origin:e}},pathHasEventType(e,t){const{list:i}=e;for(let s=0,r=i.length;s<r;s++)if(i[s].hasEvent(t))return!0;return!1},filterPathByEventType(e,t){const i=new bt,{list:s}=e;for(let r=0,n=s.length;r<n;r++)s[r].hasEvent(t)&&i.add(s[r]);return i},pathCanDrag:e=>e&&e.list.some(t=>At.draggable(t)||!t.isLeafer&&t.hasEvent(dt.DRAG)),pathHasOutside:e=>e&&e.list.some(t=>t.isOutside)},Eg=Ce,Tl=new bt,{getDragEventData:An,getDropEventData:Cg,getSwipeEventData:Bg}=Ce;let Pg=class{constructor(t){this.dragDataList=[],this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=An(t,t,t),this.canAnimate=this.canDragOut=!0}getList(t,i){const{proxy:s}=this.interaction.selector,r=s&&s.list.length,n=dt.list||this.draggableList||Tl;return this.dragging&&(r?t?Tl:new bt(i?[...s.list,...s.dragHoverExclude]:s.list):n)}checkDrag(t,i){const{interaction:s}=this;if(this.moving&&t.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(re.START,this.dragData)),this.moving||this.dragStart(t,i),this.drag(t)}dragStart(t,i){this.dragging||(this.dragging=i&&xe.left(t),this.dragging&&(this.interaction.emit(dt.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(i=>this.dragStartPoints[i.innerId]={x:i.x,y:i.y})}getDraggableList(t){let i;for(let s=0,r=t.length;s<r;s++)if(i=t.list[s],At.draggable(i)){this.draggableList=new bt(i);break}}drag(t){const{interaction:i,dragData:s,downData:r}=this,{path:n,throughPath:a}=r;this.dragData=An(r,s,t),a&&(this.dragData.throughPath=a),this.dragData.path=n,this.dragDataList.push(this.dragData),this.moving?(t.moving=!0,this.dragData.moveType="drag",i.emit(re.BEFORE_MOVE,this.dragData),i.emit(re.MOVE,this.dragData)):this.dragging&&(t.dragging=!0,this.dragReal(),i.emit(dt.BEFORE_DRAG,this.dragData),i.emit(dt.DRAG,this.dragData))}dragReal(t){const{interaction:i}=this,{running:s}=i,r=this.realDraggableList;if(r.length&&s){const{totalX:n,totalY:a}=this.dragData,{dragLimitAnimate:o}=i.p,l=!o||!!t;r.forEach(h=>{if(h.draggable){const d=Et(h.draggable),c=dt.getValidMove(h,this.dragStartPoints[h.innerId],{x:n,y:a},l||d);o&&!d&&t?At.animateMove(h,c,St(o)?o:.3):h.move(c)}})}}dragOverOrOut(t){const{interaction:i}=this,{dragOverPath:s}=this,{path:r}=t;this.dragOverPath=r,s?r.indexAt(0)!==s.indexAt(0)&&(i.emit(dt.OUT,t,s),i.emit(dt.OVER,t,r)):i.emit(dt.OVER,t,r)}dragEnterOrLeave(t){const{interaction:i}=this,{dragEnterPath:s}=this,{path:r}=t;i.emit(dt.LEAVE,t,s,r),i.emit(dt.ENTER,t,r,s),this.dragEnterPath=r}dragEnd(t){(this.dragging||this.moving)&&(this.checkDragEndAnimate(t)||this.dragEndReal(t))}dragEndReal(t){const{interaction:i,downData:s,dragData:r}=this;t||(t=r);const{path:n,throughPath:a}=s,o=An(s,t,t);if(a&&(o.throughPath=a),o.path=n,this.moving&&(this.moving=!1,o.moveType="drag",i.emit(re.END,o)),this.dragging){const l=this.getList();this.dragging=!1,i.p.dragLimitAnimate&&this.dragReal(!0),i.emit(dt.END,o),this.swipe(t,s,r,o),this.drop(t,l,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(t,i,s,r){const{interaction:n}=this;if(Q.getDistance(i,t)>n.config.pointer.swipeDistance){const a=Bg(i,s,r);this.interaction.emit(a.type,a)}}drop(t,i,s){const r=Cg(t,i,dt.data);r.path=s,this.interaction.emit(Ws.DROP,r),this.interaction.emit(dt.LEAVE,t,s)}dragReset(){dt.list=dt.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate(t,i){return!1}animate(t,i){}stopAnimate(){}checkDragOut(t){}autoMoveOnDragOut(t){}autoMoveCancel(){}destroy(){this.dragReset()}};const Rg=yt.get("emit"),Lg=["move","zoom","rotate","key"];function El(e,t,i,s,r){if(Lg.some(n=>t.startsWith(n))&&e.__.hitChildren&&!Kh(e,r)){let n;for(let a=0,o=e.children.length;a<o;a++)n=e.children[a],!i.path.has(n)&&n.__.hittable&&_a(n,t,i,s,r)}}function _a(e,t,i,s,r){if(e.destroyed)return!1;if(e.__.hitSelf&&!Kh(e,r)&&(al.updateEventStyle&&!s&&al.updateEventStyle(e,t),e.hasEvent(t,s))){i.phase=s?1:e===i.target?2:3;const n=ss.get(t,i);if(e.emitEvent(n,s),n.isStop)return!0}return!1}function Kh(e,t){return t&&t.has(e)}const Og={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:$n,pathCanDrag:Mg,pathHasOutside:Cl}=Ce;let Ag=class{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&xe.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&xe.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&ts.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,i,s,r){this.config=gt.clone(Og),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=i,this.selector=s,this.defaultPath=new bt(t),this.createTransformer(),this.dragger=new Pg(this),r&&(this.config=gt.default(r,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,i){t||(t=this.hoverData),t&&(xe.defaultLeft(t),this.updateDownData(t),this.checkPath(t,i),this.downTime=Date.now(),this.emit(q.BEFORE_DOWN,t),this.emit(q.DOWN,t),xe.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitRightTap=xe.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:i}=this;i&&xe.defaultLeft(t),(this.canvas.bounds.hitPoint(t)||i)&&(this.pointerMoveReal(t),i&&this.dragger.checkDragOut(t))}pointerMoveReal(t){if(this.emit(q.BEFORE_MOVE,t,this.defaultPath),this.downData){const i=Q.getDistance(this.downData,t)>this.p.dragDistance;i&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(t,i)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(q.MOVE,t),this.pointerHover(t),this.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:i}=this;if(t||(t=i),!i)return;xe.defaultLeft(t),t.multiTouch=i.multiTouch,this.findPath(t);const s=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(i.path.list),this.checkPath(t),this.downData=null,this.emit(q.BEFORE_UP,t),this.emit(q.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}menu(t){this.findPath(t),this.emit(q.MENU,t),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(t)}menuTap(t){this.waitRightTap&&this.waitMenuTap&&(this.emit(q.MENU_TAP,t),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(t){}zoom(t){}rotate(t){}transformEnd(){}wheel(t){}multiTouch(t,i){}keyDown(t){if(!this.config.keyEvent)return;this.emit(fe.BEFORE_DOWN,t,this.defaultPath);const{code:i}=t;this.downKeyMap[i]||(this.downKeyMap[i]=!0,ts.setDownCode(i),this.emit(fe.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(fe.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;this.emit(fe.BEFORE_UP,t,this.defaultPath);const{code:i}=t;this.downKeyMap[i]=!1,ts.setUpCode(i),this.emit(fe.UP,t,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover(t){!this.canHover||this.dragging&&!this.p.dragHover||(t.path||(t.path=new bt),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:i}=t,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(q.OUT,t,s),this.emit(q.OVER,t,i)):this.emit(q.OVER,t,i)}pointerEnterOrLeave(t){let{path:i}=t;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach(r=>i.add(r)));const{enterPath:s}=this;this.enterPath=i,this.emit(q.LEAVE,t,s,i),this.emit(q.ENTER,t,i,s)}touchLeave(t){t.pointerType==="touch"&&this.enterPath&&(this.emit(q.LEAVE,t),this.dragger.dragging&&this.emit(Ws.LEAVE,t))}tap(t){const{pointer:i}=this.config,s=this.longTap(t);if(!i.tapMore&&s||!this.waitTap)return;i.tapMore&&this.emitTap(t);const r=Date.now()-this.downTime,n=[q.DOUBLE_TAP,q.DOUBLE_CLICK].some(a=>$n(t.path,a));r<i.tapTime+50&&n?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(t))},i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,i){const{hitRadius:s,through:r}=this.p,{bottomList:n,target:a}=this;A.backgrounder||t.origin||a&&a.updateLayout();const o=this.selector.getByPoint(t,s,Object.assign({bottomList:n,name:t.type},i||{through:r}));return o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,o.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const i=this.target.app;return!(!i||!i.isApp)&&i.editor&&!t.path.has(i.editor)&&t.path.has(i.tree)&&!t.target.syncEventer}checkPath(t,i){(i||this.moveMode&&!Cl(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||this.m.drag==="auto"&&!Mg(t.path))&&!Cl(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData(t,i,s){const{downData:r}=this;!t&&r&&(t=r),t&&(this.findPath(t,i),s&&r&&t.path.addList(r.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(!1,!0),name:q.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let i,s;const{path:r}=t;for(let n=0,a=r.length;n<a&&(i=r.list[n],s=i.syncEventer&&i.syncEventer.cursor||i.cursor,!s);n++);this.setCursor(s)}setCursor(t){this.cursor=t}getLocal(t,i){const s=this.canvas.getClientBounds(i),r={x:t.clientX-s.x,y:t.clientY-s.y},{bounds:n}=this.canvas;return r.x*=n.width/s.width,r.y*=n.height/s.height,this.p.snap&&Q.round(r),r}emitTap(t){this.emit(q.TAP,t),this.emit(q.CLICK,t)}emitDoubleTap(t){this.emit(q.DOUBLE_TAP,t),this.emit(q.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(q.LONG_PRESS,t)},this.p.longPressTime)}longTap(t){let i;return this.longPressed&&(this.emit(q.LONG_TAP,t),($n(t.path,q.LONG_TAP)||$n(t.path,q.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:t}=this.m;this.shrinkCanvasBounds=new Ot(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(St(t)?t:2))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(ui.RESIZE,this.__onResize,this)],t.once(nt.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,i,s,r){this.running&&(function(n,a,o,l){if(!o&&!a.path)return;let h;a.type=n,o?a=Object.assign(Object.assign({},a),{path:o}):o=a.path,a.target=o.indexAt(0);try{for(let d=o.length-1;d>-1;d--){if(h=o.list[d],_a(h,n,a,!0,l))return;h.isApp&&El(h,n,a,!0,l)}for(let d=0,c=o.length;d<c;d++)if(h=o.list[d],h.isApp&&El(h,n,a,!1,l),_a(h,n,a,!1,l))return}catch(d){Rg.error(d)}})(t,i,s,r)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}},Qh=class{static set(t,i){this.custom[t]=i}static get(t){return this.custom[t]}};Qh.custom={};let $g=class extends Bh{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new bt,this.pixelList=new bt}getPixelType(t,i){return this.__autoClear(),this.pixelList.add(t),Tt.hitCanvas(i)}getPathType(t){return this.__autoClear(),this.pathList.add(t),Tt.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(i=>{i.__hitCanvas&&(i.__hitCanvas.destroy(),i.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}};A.getSelector=function(e){return e.leafer?e.leafer.selector:A.selector||(A.selector=Tt.selector())};const{toInnerRadiusPointOf:Ig,copyRadiusPoint:Bl}=Q,{hitRadiusPoint:Dg,hitPoint:Wg}=I,Ts={},Es={},Ui=rs.prototype;Ui.hit=function(e,t=0){this.updateLayout(),Bl(Es,e,t);const i=this.__world;return!!(t?Dg(i,Es):Wg(i,Es))&&(this.isBranch?A.getSelector(this).hitPoint(Object.assign({},Es),t,{target:this}):this.__hitWorld(Es))},Ui.__hitWorld=function(e,t){const i=this.__;if(!i.hitSelf)return!1;const s=this.__world,r=this.__layout,n=s.width<10&&s.height<10;if(i.hitRadius&&(Bl(Ts,e,i.hitRadius),e=Ts),Ig(e,s,Ts),i.hitBox||n){if(I.hitRadiusPoint(r.boxBounds,Ts))return!0;if(n)return!1}return!r.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),r.boundsChanged||(r.hitCanvasChanged=!1)),this.__hit(Ts,t)},Ui.__hitFill=function(e){const t=this.__hitCanvas;return t&&t.hitFill(e,this.__.windingRule)},Ui.__hitStroke=function(e,t){const i=this.__hitCanvas;return i&&i.hitStroke(e,t)},Ui.__hitPixel=function(e){const t=this.__hitCanvas;return t&&t.hitPixel(e,this.__layout.renderBounds,t.hitScale)},Ui.__drawHitPath=function(e){e&&this.__drawRenderPath(e)};const Ng=new Li,Pl=S.prototype;Pl.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:e}=this.leafer||this.parent&&this.parent.leafer||{};if(!e)return;const t=this.__,i=(t.__isAlphaPixelFill||t.__isCanvas)&&t.hitFill==="pixel",s=t.__isAlphaPixelStroke&&t.hitStroke==="pixel",r=i||s;this.__hitCanvas||(this.__hitCanvas=r?e.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):e.getPathType(this));const n=this.__hitCanvas;if(r){const{renderBounds:a}=this.__layout,o=A.image.hitCanvasSize,l=n.hitScale=Bi.set(0,0,o,o).getFitMatrix(a).a,{x:h,y:d,width:c,height:u}=Bi.set(a).scale(l);n.resize({width:c,height:u,pixelRatio:1}),n.clear(),Ee.patternLocked=!0,this.__renderShape(n,{matrix:Ng.setWith(this.__world).scaleWith(1/l).invertWith().translate(-h,-d),snapshot:!0,ignoreFill:!i,ignoreStroke:!s}),Ee.patternLocked=!1,n.resetTransform(),t.__isHitPixel=!0}else t.__isHitPixel&&(t.__isHitPixel=!1);this.__drawHitPath(n),n.setStrokeOptions(t)},Pl.__hit=function(e,t){if(this.__box&&this.__box.__hit(e))return!0;const i=this.__;if(i.__isHitPixel&&this.__hitPixel(e))return!0;const{hitFill:s}=i,r=(i.fill||i.__isCanvas)&&(s==="path"||s==="pixel"&&!(i.__isAlphaPixelFill||i.__isCanvas))||s==="all"||t;if(r&&this.__hitFill(e))return!0;const{hitStroke:n,__maxStrokeWidth:a}=i,o=i.stroke&&(n==="path"||n==="pixel"&&!i.__isAlphaPixelStroke)||n==="all";if(!r&&!o)return!1;const l=2*e.radiusX;let h=l;if(o)switch(i.strokeAlign){case"inside":if(h+=2*a,!r&&this.__hitFill(e)&&this.__hitStroke(e,h))return!0;h=l;break;case"center":h+=a;break;case"outside":if(h+=2*a,!r){if(!this.__hitFill(e)&&this.__hitStroke(e,h))return!0;h=l}}return!!h&&this.__hitStroke(e,h)};const Rl=S.prototype,Ll=Dt.prototype,Ol=It.prototype;Ll.__updateHitCanvas=Ol.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?Rl.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},Ll.__hitFill=Ol.__hitFill=function(e){return this.__hitCanvas?Rl.__hitFill.call(this,e):I.hitRadiusPoint(this.__layout.boxBounds,e)},Z.prototype.__drawHitPath=function(e){const{__lineHeight:t,fontSize:i,__baseLine:s,__letterSpacing:r,__textDrawData:n}=this.__;e.beginPath(),r<0?this.__drawPathByBox(e):n.rows.forEach(a=>e.rect(a.x,a.y-s,a.width,t<i?i:t))},Se.prototype.pick=function(e,t){return t||(t=Dc),this.updateLayout(),A.getSelector(this).getByPoint(e,t.hitRadius||0,Object.assign(Object.assign({},t),{target:this}))};const In=Lh.prototype;In.hitFill=function(e,t){return t?this.context.isPointInPath(e.x,e.y,t):this.context.isPointInPath(e.x,e.y)},In.hitStroke=function(e,t){return this.strokeWidth=t,this.context.isPointInStroke(e.x,e.y)},In.hitPixel=function(e,t,i=1){let{x:s,y:r,radiusX:n,radiusY:a}=e;t&&(s-=t.x,r-=t.y),Bi.set(s-n,r-a,2*n,2*a).scale(i).ceil();const{data:o}=this.context.getImageData(Bi.x,Bi.y,Bi.width||1,Bi.height||1);for(let l=0,h=o.length;l<h;l+=4)if(o[l+3]>0)return!0;return o[3]>0};var Ml;(function(e){e[e.none=1]="none",e[e.free=2]="free",e[e.mirrorAngle=3]="mirrorAngle",e[e.mirror=4]="mirror"})(Ml||(Ml={}));const Al=yt.get("LeaferCanvas");class Jh extends Lh{set zIndex(t){const{style:i}=this.view;i.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:i,parentView:s}=this;if(i&&s){const r=s.children[t];r?(this.setAbsolute(r),s.insertBefore(i,r)):s.appendChild(r)}}init(){const{config:t}=this,i=t.view||t.canvas;i?this.__createViewFrom(i):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const r=this.parentView.style;r.webkitUserSelect=r.userSelect="none",this.view.classList.add("leafer-canvas-view")}A.syncDomFont&&!this.parentView&&(s.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let i=Et(t)?document.getElementById(t):t;if(i)if(i instanceof HTMLCanvasElement)this.view=i;else{let s=i;if(i===window||i===document){const n=document.createElement("div"),{style:a}=n;a.position="absolute",a.top=a.bottom=a.left=a.right="0px",document.body.appendChild(n),s=n}this.__createView();const r=this.view;s.hasChildNodes()&&(this.setAbsolute(r),s.style.position||(s.style.position="relative")),s.appendChild(r)}else Al.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:i}=t;i.position="absolute",i.top=i.left="0px"}updateViewSize(){const{width:t,height:i,pixelRatio:s}=this,{style:r}=this.view;r.width=t+"px",r.height=i+"px",this.unreal||(this.view.width=Math.ceil(t*s),this.view.height=Math.ceil(i*s))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(t,i){if(this.resizeListener=i,t){if(this.autoBounds=t,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(r=>{this.updateClientBounds();for(const n of r)this.checkAutoBounds(n.contentRect)});const s=this.parentView;s?(this.resizeObserver.observe(s),this.checkAutoBounds(s.getBoundingClientRect())):(this.checkAutoBounds(this.view),Al.warn("no parent"))}catch{this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),A.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const t=A.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==t){const{width:i,height:s}=this;this.emitResize({width:i,height:s,pixelRatio:t})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(t){const i=this.view,{x:s,y:r,width:n,height:a}=this.autoBounds.getBoundsFrom(t),o={width:n,height:a,pixelRatio:this.config.pixelRatio?this.pixelRatio:A.devicePixelRatio};if(!this.isSameSize(o)){const{style:l}=i;l.marginLeft=s+"px",l.marginTop=r+"px",this.emitResize(o)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(t){const i={};gt.copyAttrs(i,this,be),this.resize(t),this.resizeListener&&!G(this.width)&&this.resizeListener(new ui(t,i))}unrealCanvas(){if(!this.unreal&&this.parentView){let t=this.view;t&&t.remove(),t=this.view=document.createElement("div"),this.parentView.appendChild(this.view),t.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:t}=this;t&&(this.stopAutoLayout(),this.stopListenPixelRatio(),t.parentElement&&t.remove(),super.destroy())}}Ro(CanvasRenderingContext2D.prototype),Ro(Path2D.prototype);const{mineType:Dn,fileType:zg}=Ds;function Fg(e,t){A.origin={createCanvas(i,s){const r=document.createElement("canvas");return r.width=i,r.height=s,r},canvasToDataURL:(i,s,r)=>{const n=Dn(s),a=i.toDataURL(n,r);return n==="image/bmp"?a.replace("image/png;","image/bmp;"):a},canvasToBolb:(i,s,r)=>new Promise(n=>i.toBlob(n,Dn(s),r)),canvasSaveAs:(i,s,r)=>{const n=i.toDataURL(Dn(zg(s)),r);return A.origin.download(n,s)},download:(i,s)=>new Promise(r=>{let n=document.createElement("a");n.href=i,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),r()}),loadImage:i=>new Promise((s,r)=>{const n=new A.origin.Image,{crossOrigin:a}=A.image;a&&(n.setAttribute("crossOrigin",a),n.crossOrigin=a),n.onload=()=>{s(n)},n.onerror=o=>{r(o)},n.src=A.image.getRealURL(i)}),Image,PointerEvent,DragEvent},A.event={stopDefault(i){i.preventDefault()},stopNow(i){i.stopImmediatePropagation()},stop(i){i.stopPropagation()}},A.canvas=Tt.canvas(),A.conicGradientSupport=!!A.canvas.context.createConicGradient}Object.assign(Tt,{canvas:(e,t)=>new Jh(e,t),image:e=>new Fh(e)}),A.name="web",A.isMobile="ontouchstart"in window,A.requestRender=function(e){window.requestAnimationFrame(e)},as(A,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:br}=navigator;br.indexOf("Firefox")>-1?(A.conicGradientRotate90=!0,A.intWheelDeltaY=!0,A.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&(A.fullImageShadow=!0),br.indexOf("Windows")>-1?(A.os="Windows",A.intWheelDeltaY=!0):br.indexOf("Mac")>-1?A.os="Mac":br.indexOf("Linux")>-1&&(A.os="Linux");class Hg{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const t=new bt;return this.__updatedList.list.forEach(i=>{i.leafer&&t.add(i)}),t}return this.__updatedList}constructor(t,i){this.totalTimes=0,this.config={},this.__updatedList=new bt,this.target=t,i&&(this.config=gt.default(i,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(ut.REQUEST)}__onAttrChange(t){this.config.usePartLayout&&this.__updatedList.add(t.target),this.update()}__onChildEvent(t){this.config.usePartLayout&&(t.type===Rt.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent))),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:i}=t;for(let s=0,r=i.length;s<r;s++)this.__pushChild(i[s])}__onRquestData(){this.target.emitEvent(new ci(ci.DATA,{updatedList:this.updatedList})),this.__updatedList=new bt,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[hi.CHANGE,this.__onAttrChange,this],[[Rt.ADD,Rt.REMOVE],this.__onChildEvent,this],[ci.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:Yg,updateBounds:$l,updateChange:Vg}=At,{pushAllChildBranch:qg,pushAllParent:Il}=Vs,{worldBounds:Dl}=qr;class Wl{constructor(t){this.updatedBounds=new Ot,this.beforeBounds=new Ot,this.afterBounds=new Ot,Lt(t)&&(t=new bt(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,Dl)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,Dl),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Xg,updateAllChange:Gg}=At,Wn=yt.get("Layouter");class Nr{constructor(t,i){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new Af,this.target=t,i&&(this.config=gt.default(i,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:t}=this;this.times=0;try{t.emit(vt.START),this.layoutOnce(),t.emitEvent(new vt(vt.END,this.layoutedBlocks,this.times))}catch(i){Wn.error(i)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Wn.warn("layouting"):this.times>3?Wn.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(ci.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(!((t=this.__updatedList)===null||t===void 0)&&t.length))return;const i=Te.start("PartLayout"),{target:s,__updatedList:r}=this,{BEFORE:n,LAYOUT:a,AFTER:o}=vt,l=this.getBlocks(r);l.forEach(h=>h.setBefore()),s.emitEvent(new vt(n,l,this.times)),this.extraBlock=null,r.sort(),(function(h,d){let c;h.list.forEach(u=>{c=u.__layout,d.without(u)&&!c.proxyZoom&&(c.matrixChanged?(Yg(u,!0),d.add(u),u.isBranch&&qg(u,d),Il(u,d)):c.boundsChanged&&(d.add(u),u.isBranch&&(u.__tempNumber=0),Il(u,d)))})})(r,this.__levelList),(function(h){let d,c,u;h.sort(!0),h.levels.forEach(p=>{d=h.levelMap[p];for(let _=0,m=d.length;_<m;_++){if(c=d[_],c.isBranch&&c.__tempNumber){u=c.children;for(let v=0,T=u.length;v<T;v++)u[v].isBranch||$l(u[v])}$l(c)}})})(this.__levelList),(function(h){h.list.forEach(Vg)})(r),this.extraBlock&&l.push(this.extraBlock),l.forEach(h=>h.setAfter()),s.emitEvent(new vt(a,l,this.times)),s.emitEvent(new vt(o,l,this.times)),this.addBlocks(l),this.__levelList.reset(),this.__updatedList=null,Te.end(i)}fullLayout(){const t=Te.start("FullLayout"),{target:i}=this,{BEFORE:s,LAYOUT:r,AFTER:n}=vt,a=this.getBlocks(new bt(i));i.emitEvent(new vt(s,a,this.times)),Nr.fullLayout(i),a.forEach(o=>{o.setAfter()}),i.emitEvent(new vt(r,a,this.times)),i.emitEvent(new vt(n,a,this.times)),this.addBlocks(a),Te.end(t)}static fullLayout(t){Xg(t,!0),t.isBranch?Vs.updateBounds(t):At.updateBounds(t),Gg(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:i,beforeBounds:s}=this.extraBlock||(this.extraBlock=new Wl([]));i.length?s.add(t.__world):s.set(t.__world),i.add(t)}}createBlock(t){return new Wl(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[vt.REQUEST,this.layout,this],[vt.AGAIN,this.layoutAgain,this],[ci.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Ki=yt.get("Renderer");class Gr{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,i,s){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=t,this.canvas=i,s&&(this.config=gt.default(s,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(t=!0){this.changed||(this.changed=t),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit(vt.REQUEST)}checkRender(){if(this.running){const{target:t}=this;t.isApp&&(t.emit(ut.CHILD_START,t),t.children.forEach(i=>{i.renderer.FPS=this.FPS,i.renderer.checkRender()}),t.emit(ut.CHILD_END,t)),this.changed&&this.canvas.view&&this.render(),this.target.emit(ut.NEXT)}}render(t){if(!this.running||!this.canvas.view)return this.update();const{target:i}=this;this.times=0,this.totalBounds=new Ot,Ki.log(i.innerName,"--->");try{this.emitRender(ut.START),this.renderOnce(t),this.emitRender(ut.END,this.totalBounds),Ee.clearRecycled()}catch(s){this.rendering=!1,Ki.error(s)}Ki.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Ki.warn("rendering");if(this.times>3)return Ki.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Ot,this.renderOptions={},t)this.emitRender(ut.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(ut.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(ut.RENDER,this.renderBounds,this.renderOptions),this.emitRender(ut.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:i}=this;i&&(this.mergeBlocks(),i.forEach(s=>{t.bounds.hit(s)&&!s.isEmpty()&&this.clipRender(s)}))}clipRender(t){const i=Te.start("PartRender"),{canvas:s}=this,r=t.getIntersect(s.bounds),n=new Ot(r);s.save(),r.spread(Gr.clipSpread).ceil();const{ceilPartPixel:a}=this.config;s.clipWorld(r,a),s.clearWorld(r,a),this.__render(r,n),s.restore(),Te.end(i)}fullRender(){const t=Te.start("FullRender"),{canvas:i}=this;i.save(),i.clear(),this.__render(i.bounds),i.restore(),Te.end(t)}__render(t,i){const{canvas:s,target:r}=this,n=t.includes(r.__world),a=n?{includes:n}:{bounds:t,includes:n};this.needFill&&s.fillWorld(t,this.config.fill),yt.showRepaint&&yt.drawRepaint(s,t),this.config.useCellRender&&(a.cellList=this.getCellList()),A.render(r,s,a),this.renderBounds=i=i||t,this.renderOptions=a,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),s.updateRender(i)}getCellList(){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const i=new Ot;i.setList(t),t.length=0,t.push(i)}}__requestRender(){const t=this.target;if(this.requestTime||!t)return;if(t.parentApp)return t.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const i=()=>{const s=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:r}=this.config;if(r&&s>r)return A.requestRender(i);const{frames:n}=this;n.length>30&&n.shift(),n.push(s),this.FPS=Math.round(n.reduce((a,o)=>a+o,0)/n.length),this.requestTime=0,this.checkRender()};A.requestRender(i)}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:i,height:s}=t.old;if(!new Ot(0,0,i,s).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Ot(0,0,1,1)),this.update()}}__onLayoutEnd(t){t.data&&t.data.map(i=>{let s;i.updatedList&&i.updatedList.list.some(r=>(s=!r.__world.width||!r.__world.height,s&&(r.isLeafer||Ki.tip(r.innerName,": empty"),s=!r.isBranch||r.isBranchLeaf),s)),this.addBlock(s?this.canvas.bounds:i.updatedBounds)})}emitRender(t,i,s){this.target.emitEvent(new ut(t,this.times,i,s))}__listenEvents(){this.__eventIds=[this.target.on_([[ut.REQUEST,this.update,this],[vt.END,this.__onLayoutEnd,this],[ut.AGAIN,this.renderAgain,this],[ui.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}Gr.clipSpread=10;const jg={},{copyRadiusPoint:Ug}=Q,{hitRadiusPoint:Kg}=I;class Qg{constructor(t,i){this.target=t,this.selector=i}getByPoint(t,i,s){i||(i=0),s||(s={});const r=s.through||!1,n=s.ignoreHittable||!1,a=s.target||this.target;this.exclude=s.exclude||null,this.point={x:t.x,y:t.y,radiusX:i,radiusY:i},this.findList=new bt(s.findList),s.findList||this.hitBranch(a.isBranchLeaf?{children:[a]}:a);const{list:o}=this.findList,l=this.getBestMatchLeaf(o,s.bottomList,n,!!s.findList),h=n?this.getPath(l):this.getHitablePath(l);return this.clear(),r?{path:h,target:l,throughPath:o.length?this.getThroughPath(o):h}:{path:h,target:l}}hitPoint(t,i,s){return!!this.getByPoint(t,i,s).target}getBestMatchLeaf(t,i,s,r){const n=this.findList=new bt;if(t.length){let a;const{x:o,y:l}=this.point,h={x:o,y:l,radiusX:0,radiusY:0};for(let d=0,c=t.length;d<c;d++)if(a=t[d],(s||At.worldHittable(a))&&(this.hitChild(a,h),n.length)){if(a.isBranchLeaf&&t.some(u=>u!==a&&At.hasParent(u,a))){n.reset();break}return n.list[0]}}if(i){for(let a=0,o=i.length;a<o;a++)if(this.hitChild(i[a].target,this.point,i[a].proxy),n.length)return n.list[0]}return r?null:s?t[0]:t.find(a=>At.worldHittable(a))}getPath(t){const i=new bt,s=[],{target:r}=this;for(;t&&(t.syncEventer&&s.push(t.syncEventer),i.add(t),(t=t.parent)!==r););return s.length&&s.forEach(n=>{for(;n&&(n.__.hittable&&i.add(n),(n=n.parent)!==r););}),r&&i.add(r),i}getHitablePath(t){const i=this.getPath(t&&t.hittable?t:null);let s,r=new bt;for(let n=i.list.length-1;n>-1&&(s=i.list[n],s.__.hittable)&&(r.addAt(s,0),s.__.hitChildren&&(!s.isLeafer||s.mode!=="draw"));n--);return r}getThroughPath(t){const i=new bt,s=[];for(let o=t.length-1;o>-1;o--)s.push(this.getPath(t[o]));let r,n,a;for(let o=0,l=s.length;o<l;o++){r=s[o],n=s[o+1];for(let h=0,d=r.length;h<d&&(a=r.list[h],!n||!n.has(a));h++)i.add(a)}return i}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,i){let s,r,n;const{point:a}=this;for(let o=t.length-1;o>-1;o--)if(s=t[o],n=s.__,n.visible&&(!i||n.mask))if(r=Kg(s.__world,n.hitRadius?Ug(jg,a,n.hitRadius):a),s.isBranch){if(r||s.__ignoreHitWorld){if(s.isBranchLeaf&&n.__clipAfterFill&&!s.__hitWorld(a,!0))continue;s.topChildren&&this.eachFind(s.topChildren,!1),this.eachFind(s.children,s.__onlyHitMask),s.isBranchLeaf&&this.hitChild(s,a)}}else r&&this.hitChild(s,a)}hitChild(t,i,s){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(i)){const{parent:r}=t;if(r&&r.__hasMask&&!t.__.mask){let n,a=[];const{children:o}=r;for(let l=0,h=o.length;l<h;l++)if(n=o[l],n.__.mask&&a.push(n),n===t){if(a&&!a.every(d=>d.__hitWorld(i)))return;break}}this.findList.add(s||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class Jg{constructor(t,i){this.config={},i&&(this.config=gt.default(i,this.config)),this.picker=new Qg(this.target=t,this),this.finder=Tt.finder&&Tt.finder()}getByPoint(t,i,s){const{target:r,picker:n}=this;return A.backgrounder&&r&&r.updateLayout(),n.getByPoint(t,i,s)}hitPoint(t,i,s){return this.picker.hitPoint(t,i,s)}getBy(t,i,s,r){return this.finder?this.finder.getBy(t,i,s,r):Zt.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}Object.assign(Tt,{watcher:(e,t)=>new Hg(e,t),layouter:(e,t)=>new Nr(e,t),renderer:(e,t,i)=>new Gr(e,t,i),selector:(e,t)=>new Jg(e,t)}),A.layout=Nr.fullLayout,A.render=function(e,t,i){const s=Object.assign(Object.assign({},i),{topRendering:!0});i.topList=new bt,e.__render(t,i),i.topList.length&&i.topList.forEach(r=>r.__render(t,s))};const jt={convert(e,t){const i=Ce.getBase(e),{x:s,y:r}=t,n=Object.assign(Object.assign({},i),{x:s,y:r,width:e.width,height:e.height,pointerType:e.pointerType,pressure:e.pressure});return n.pointerType==="pen"&&(n.tangentialPressure=e.tangentialPressure,n.tiltX=e.tiltX,n.tiltY=e.tiltY,n.twist=e.twist),n},convertMouse(e,t){const i=Ce.getBase(e),{x:s,y:r}=t;return Object.assign(Object.assign({},i),{x:s,y:r,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(e,t){const i=jt.getTouch(e),s=Ce.getBase(e),{x:r,y:n}=t;return Object.assign(Object.assign({},s),{x:r,y:n,width:1,height:1,pointerType:"touch",multiTouch:e.touches.length>1,pressure:i.force})},getTouch:e=>e.targetTouches[0]||e.changedTouches[0]},Nl={convert(e){const t=Ce.getBase(e);return Object.assign(Object.assign({},t),{code:e.code,key:e.key})}},{pathCanDrag:Zg}=Ce;class t_ extends Ag{get notPointer(){const{p:t}=this;return t.type!=="pointer"||t.touch||this.useMultiTouch}get notTouch(){const{p:t}=this;return t.type==="mouse"||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:i,windowEvents:s}=this;for(let r in i)i[r]=i[r].bind(this),t.addEventListener(r,i[r]);for(let r in s)s[r]=s[r].bind(this),window.addEventListener(r,s[r])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:i}=this;for(let s in t)this.view.removeEventListener(s,t[s]),this.viewEvents={};for(let s in i)window.removeEventListener(s,i[s]),this.windowEvents={}}getTouches(t){const i=[];for(let s=0,r=t.length;s<r;s++)i.push(t[s]);return i}preventDefaultPointer(t){const{pointer:i}=this.config;i.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:i}=this.config;i.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(Nl.convert(t))}onKeyUp(t){this.keyUp(Nl.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(jt.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(jt.convert(t,this.getLocal(t))))}onPointerMove(t,i){if(this.notPointer||this.preventWindowPointer(t))return;this.usePointer||(this.usePointer=!0);const s=jt.convert(t,this.getLocal(t,!0));i?this.pointerHover(s):this.pointerMove(s)}onPointerLeave(t){this.onPointerMove(t,!0)}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.notPointer||this.preventWindowPointer(t)||this.pointerUp(jt.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.notMouse||this.pointerDown(jt.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.notMouse||this.preventWindowPointer(t)||this.pointerMove(jt.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.notMouse||this.preventWindowPointer(t)||this.pointerUp(jt.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(t){const i=jt.getTouch(t),s=this.getLocal(i,!0),{preventDefault:r}=this.config.touch;(r===!0||r==="auto"&&Zg(this.findPath(s)))&&t.preventDefault(),this.multiTouchStart(t),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(jt.convertTouch(t,s)))}onTouchMove(t){if(this.multiTouchMove(t),this.notTouch||this.preventWindowPointer(t))return;const i=jt.getTouch(t);this.pointerMove(jt.convertTouch(t,this.getLocal(i)))}onTouchEnd(t){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const i=jt.getTouch(t);this.pointerUp(jt.convertTouch(t,this.getLocal(i)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const i=this.getTouches(t.touches),s=this.getKeepTouchList(this.touches,i);s.length>1&&(this.multiTouch(Ce.getBase(t),s),this.touches=i)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,i){let s;const r=[];return t.forEach(n=>{s=i.find(a=>a.identifier===n.identifier),s&&r.push({from:this.getLocal(n),to:this.getLocal(s)})}),r}getLocalTouchs(t){return t.map(i=>this.getLocal(i))}onWheel(t){this.preventDefaultWheel(t),this.wheel(Object.assign(Object.assign(Object.assign({},Ce.getBase(t)),this.getLocal(t)),{deltaX:t.deltaX,deltaY:t.deltaY}))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const i=Ce.getBase(t);Object.assign(i,this.getLocal(t));const s=t.scale/this.lastGestureScale,r=(t.rotation-this.lastGestureRotation)/Math.PI*180*(Nt.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},i),{scale:s*s})),this.rotate(Object.assign(Object.assign({},i),{rotation:r})),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const i=[];this.eachCursor(t,i),_t(i[i.length-1])&&i.push("default"),this.canvas.view.style.cursor=i.map(s=>_t(s)?`url(${s.url}) ${s.x||0} ${s.y||0}`:s).join(",")}eachCursor(t,i,s=0){if(s++,Lt(t))t.forEach(r=>this.eachCursor(r,i,s));else{const r=Et(t)&&Qh.get(t);r&&s<2?this.eachCursor(r,i,s):i.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Cs(e,t,i){e.__.__font?it.fillText(e,t,i):e.__.windingRule?t.fill(e.__.windingRule):t.fill()}function kr(e,t,i,s,r){const n=i.__;_t(e)?it.drawStrokesStyle(e,t,!1,i,s,r):(s.setStroke(e,n.__strokeWidth*t,n),s.stroke()),n.__useArrow&&it.strokeArrow(e,i,s,r)}function ya(e,t,i,s,r){const n=i.__;_t(e)?it.drawStrokesStyle(e,t,!0,i,s,r):(s.setStroke(e,n.__strokeWidth*t,n),it.drawTextStroke(i,s,r))}function zl(e,t,i,s,r){const n=s.getSameCanvas(!0,!0);n.font=i.__.__font,ya(e,2,i,n,r),n.blendMode=t==="outside"?"destination-out":"destination-in",it.fillText(i,n,r),n.blendMode="normal",At.copyCanvasByWorld(i,s,n),n.recycle(i.__nowWorld)}const{getSpread:e_,copyAndSpread:i_,toOuterOf:s_,getOuterOf:Fl,getByMove:r_,move:n_,getIntersectData:a_}=I,Hl={};let ma;const{stintSet:Bs}=gt,{hasTransparent:o_}=te;function l_(e,t,i){if(!_t(t)||t.visible===!1||t.opacity===0)return;let s;const{boxBounds:r}=i.__layout;switch(t.type){case"image":if(!t.url)return;s=Mt.image(i,e,t,r,!ma||!ma[t.url]);break;case"linear":s=Ar.linearGradient(t,r);break;case"radial":s=Ar.radialGradient(t,r);break;case"angular":s=Ar.conicGradient(t,r);break;case"solid":const{type:n,color:a,opacity:o}=t;s={type:n,style:te.string(a,o)};break;default:G(t.r)||(s={type:"solid",style:te.string(t)})}if(s&&(s.originPaint=t,Et(s.style)&&o_(s.style)&&(s.isTransparent=!0),t.style)){if(t.style.strokeWidth===0)return;s.strokeStyle=t.style}return s}const h_={compute:function(e,t){const i=t.__,s=[];let r,n,a,o=i.__input[e];Lt(o)||(o=[o]),ma=Mt.recycleImage(e,i);for(let l,h=0,d=o.length;h<d;h++)(l=l_(e,o[h],t))&&(s.push(l),l.strokeStyle&&(a||(a=1),l.strokeStyle.strokeWidth&&(a=Math.max(a,l.strokeStyle.strokeWidth))));i["_"+e]=s.length?s:void 0,s.length?(s.every(l=>l.isTransparent)&&(s.some(l=>l.image)&&(r=!0),n=!0),e==="fill"?(Bs(i,"__isAlphaPixelFill",r),Bs(i,"__isTransparentFill",n)):(Bs(i,"__isAlphaPixelStroke",r),Bs(i,"__isTransparentStroke",n),Bs(i,"__hasMultiStrokeStyle",a))):i.__removePaint(e,!1)},fill:function(e,t,i,s){i.fillStyle=e,Cs(t,i,s)},fills:function(e,t,i,s){let r,n,a;for(let o=0,l=e.length;o<l;o++){if(r=e[o],n=r.originPaint,r.image){if(a?a++:a=1,Mt.checkImage(r,!t.__.__font,t,i,s))continue;if(!r.style){a===1&&r.image.isPlacehold&&t.drawImagePlaceholder(r,i,s);continue}}if(i.fillStyle=r.style,r.transform||n.scaleFixed){if(i.save(),r.transform&&i.transform(r.transform),n.scaleFixed){const{scaleX:h,scaleY:d}=t.getRenderScaleData(!0);(n.scaleFixed===!0||n.scaleFixed==="zoom-in"&&h>1&&d>1)&&i.scale(1/h,1/d)}n.blendMode&&(i.blendMode=n.blendMode),Cs(t,i,s),i.restore()}else n.blendMode?(i.saveBlendMode(n.blendMode),Cs(t,i,s),i.restoreBlendMode()):Cs(t,i,s)}},fillPathOrText:Cs,fillText:function(e,t,i){const s=e.__,{rows:r,decorationY:n}=s.__textDrawData;let a;s.__isPlacehold&&s.placeholderColor&&(t.fillStyle=s.placeholderColor);for(let o=0,l=r.length;o<l;o++)a=r[o],a.text?t.fillText(a.text,a.x,a.y):a.data&&a.data.forEach(h=>{t.fillText(h.char,h.x,a.y)});if(n){const{decorationColor:o,decorationHeight:l}=s.__textDrawData;o&&(t.fillStyle=o),r.forEach(h=>n.forEach(d=>t.fillRect(h.x,h.y+d,h.width,l)))}},stroke:function(e,t,i,s){const r=t.__;if(r.__strokeWidth)if(r.__font)it.strokeText(e,t,i,s);else switch(r.strokeAlign){case"center":kr(e,1,t,i,s);break;case"inside":(function(n,a,o,l){o.save(),o.clipUI(a),kr(n,2,a,o,l),o.restore()})(e,t,i,s);break;case"outside":(function(n,a,o,l){const h=a.__;if(h.__fillAfterStroke)kr(n,2,a,o,l);else{const{renderBounds:d}=a.__layout,c=o.getSameCanvas(!0,!0);a.__drawRenderPath(c),kr(n,2,a,c,l),c.clipUI(h),c.clearWorld(d),At.copyCanvasByWorld(a,o,c),c.recycle(a.__nowWorld)}})(e,t,i,s)}},strokes:function(e,t,i,s){it.stroke(e,t,i,s)},strokeText:function(e,t,i,s){switch(t.__.strokeAlign){case"center":ya(e,1,t,i,s);break;case"inside":zl(e,"inside",t,i,s);break;case"outside":t.__.__fillAfterStroke?ya(e,2,t,i,s):zl(e,"outside",t,i,s)}},drawTextStroke:function(e,t,i){let s,r=e.__.__textDrawData;const{rows:n,decorationY:a}=r;for(let o=0,l=n.length;o<l;o++)s=n[o],s.text?t.strokeText(s.text,s.x,s.y):s.data&&s.data.forEach(h=>{t.strokeText(h.char,h.x,s.y)});if(a){const{decorationHeight:o}=r;n.forEach(l=>a.forEach(h=>t.strokeRect(l.x,l.y+h,l.width,o)))}},drawStrokesStyle:function(e,t,i,s,r,n){let a;const o=s.__,{__hasMultiStrokeStyle:l}=o;l||r.setStroke(void 0,o.__strokeWidth*t,o);for(let h=0,d=e.length;h<d;h++)if(a=e[h],(!a.image||!Mt.checkImage(a,!1,s,r,n))&&a.style){if(l){const{strokeStyle:c}=a;c?r.setStroke(a.style,o.__getRealStrokeWidth(c)*t,o,c):r.setStroke(a.style,o.__strokeWidth*t,o)}else r.strokeStyle=a.style;a.originPaint.blendMode?(r.saveBlendMode(a.originPaint.blendMode),i?it.drawTextStroke(s,r,n):r.stroke(),r.restoreBlendMode()):i?it.drawTextStroke(s,r,n):r.stroke()}},shape:function(e,t,i){const s=t.getSameCanvas(),r=t.bounds,n=e.__nowWorld,a=e.__layout,o=e.__nowWorldShapeBounds||(e.__nowWorldShapeBounds={});let l,h,d,c,u,p;s_(a.strokeSpread?(i_(Hl,a.boxBounds,a.strokeSpread),Hl):a.boxBounds,n,o);let{scaleX:_,scaleY:m}=e.getRenderScaleData(!0);if(r.includes(o))p=s,l=u=o,h=n;else{let v;if(A.fullImageShadow)v=o;else{const X=a.renderShapeSpread?e_(r,Fr.swapAndScale(a.renderShapeSpread,_,m)):r;v=a_(X,o)}c=r.getFitMatrix(v);let{a:T,d:$}=c;c.a<1&&(p=t.getSameCanvas(),e.__renderShape(p,i),_*=T,m*=$),u=Fl(o,c),l=r_(u,-c.e,-c.f),h=Fl(n,c),n_(h,-c.e,-c.f);const B=i.matrix;B?(d=new Li(c),d.multiply(B),T*=B.scaleX,$*=B.scaleY):d=c,d.withScale(T,$),i=Object.assign(Object.assign({},i),{matrix:d})}return e.__renderShape(s,i),{canvas:s,matrix:d,fitMatrix:c,bounds:l,renderBounds:h,worldCanvas:p,shapeBounds:u,scaleX:_,scaleY:m}}};let Ps,c_=new Ot;const{isSame:d_}=I;function Yl(e,t,i,s,r,n){if(t==="fill"&&!e.__.__naturalWidth){const a=e.__;if(a.__naturalWidth=s.width/a.pixelRatio,a.__naturalHeight=s.height/a.pixelRatio,a.__autoSide)return e.forceUpdate("width"),e.__proxyData&&(e.setProxyAttr("width",a.width),e.setProxyAttr("height",a.height)),!1}return r.data||Mt.createData(r,s,i,n),!0}function Vl(e,t){La(e,Ze.LOAD,t)}function ql(e,t){La(e,Ze.LOADED,t)}function Xl(e,t,i){t.error=i,e.forceUpdate("surface"),La(e,Ze.ERROR,t)}function La(e,t,i){e.hasEvent(t)&&e.emitEvent(new Ze(t,i))}function Nn(e,t){const{leafer:i}=e;i&&i.viewReady&&(i.renderer.ignore=t)}const{get:u_,translate:p_}=K,f_=new Ot,zn={},$t={};function Gl(e,t,i,s){const r=Et(e)||s?(s?i-s*t:i%t)/((s||Math.floor(i/t))-1):e;return e==="auto"&&r<0?0:r}let Rs={},Fn=kh();const{get:Sr,set:g_,rotateOfOuter:jl,translate:Ei,scaleOfOuter:Hn,multiplyParent:__,scale:va,rotate:Zh,skew:y_}=K;function Ul(e,t,i,s,r,n,a,o){a&&Zh(e,a),o&&y_(e,o.x,o.y),r&&va(e,r,n),Ei(e,t.x+i,t.y+s)}function m_(e,t,i,s){return new(i||(i=Promise))(function(r,n){function a(h){try{l(s.next(h))}catch(d){n(d)}}function o(h){try{l(s.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof i?d:new i(function(c){c(d)})).then(a,o)}l((s=s.apply(e,[])).next())})}const{get:v_,scale:x_,copy:w_}=K,{getFloorScale:Kl}=Nt,{abs:Ql}=Math,b_={image:function(e,t,i,s,r){let n,a;const o=Ee.get(i);return Ps&&i===Ps.paint&&d_(s,Ps.boxBounds)?n=Ps.leafPaint:(n={type:i.type,image:o},o.hasAlphaPixel&&(n.isTransparent=!0),Ps=o.use>1?{leafPaint:n,paint:i,boxBounds:c_.set(s)}:null),(r||o.loading)&&(a={image:o,attrName:t,attrValue:i}),o.ready?(Yl(e,t,i,o,n,s),r&&(Vl(e,a),ql(e,a))):o.error?r&&Xl(e,a,o.error):(r&&(Nn(e,!0),Vl(e,a)),n.loadId=o.load(()=>{Nn(e,!1),e.destroyed||(Yl(e,t,i,o,n,s)&&(o.hasAlphaPixel&&(e.__layout.hitCanvasChanged=!0),e.forceUpdate("surface")),ql(e,a)),n.loadId=void 0},l=>{Nn(e,!1),Xl(e,a,l),n.loadId=void 0},i.lod&&o.getThumbSize(i.lod)),e.placeholderColor&&(e.placeholderDelay?setTimeout(()=>{o.ready||(o.isPlacehold=!0,e.forceUpdate("surface"))},e.placeholderDelay):o.isPlacehold=!0)),n},checkImage:function(e,t,i,s,r){const{scaleX:n,scaleY:a}=Mt.getImageRenderScaleData(e,i,s,r),{image:o,data:l,originPaint:h}=e,{exporting:d,snapshot:c}=r;return!(!l||e.patternId===n+"-"+a&&!d||c)&&(t&&(l.repeat?t=!1:h.changeful||A.name==="miniapp"&&ui.isResizing(i)||d||(t=A.image.isLarge(o,n,a)||o.width*n>8096||o.height*a>8096)),t?(i.__.__isFastShadow&&(s.fillStyle=e.style||"#000",s.fill()),Mt.drawImage(e,n,a,i,s,r),!0):(!e.style||h.sync||d?Mt.createPattern(e,i,s,r):Mt.createPatternTask(e,i,s,r),!1))},drawImage:function(e,t,i,s,r,n){const{data:a,image:o}=e,{blendMode:l}=e.originPaint,{opacity:h,transform:d}=a,c=o.getFull(a.filters),u=s.__;let p,{width:_,height:m}=o;(p=d&&!d.onlyScale||u.path||u.cornerRadius)||h||l?(r.save(),p&&r.clipUI(s),l&&(r.blendMode=l),h&&(r.opacity*=h),d&&r.transform(d),r.drawImage(c,0,0,_,m),r.restore()):(a.scaleX&&(_*=a.scaleX,m*=a.scaleY),r.drawImage(c,0,0,_,m))},getImageRenderScaleData:function(e,t,i,s){const r=t.getRenderScaleData(!0,e.originPaint.scaleFixed),{data:n}=e;if(i){const{pixelRatio:a}=i;r.scaleX*=a,r.scaleY*=a}return n&&n.scaleX&&(r.scaleX*=Math.abs(n.scaleX),r.scaleY*=Math.abs(n.scaleY)),r},recycleImage:function(e,t){const i=t["_"+e];if(Lt(i)){let s,r,n,a,o;for(let l=0,h=i.length;l<h;l++)s=i[l],r=s.image,o=r&&r.url,o&&(n||(n={}),n[o]=!0,Ee.recyclePaint(s),r.loading&&(a||(a=t.__input&&t.__input[e]||[],Lt(a)||(a=[a])),r.unload(i[l].loadId,!a.some(d=>d.url===o))));return n}return null},createPatternTask:function(e,t,i,s){e.patternTask||(e.patternTask=Ee.patternTasker.add(()=>m_(this,void 0,void 0,function*(){Mt.createPattern(e,t,i,s),t.forceUpdate("surface")}),0,()=>(e.patternTask=null,i.bounds.hit(t.__nowWorld))))},createPattern:function(e,t,i,s){let{scaleX:r,scaleY:n}=Mt.getImageRenderScaleData(e,t,i,s),a=r+"-"+n;if(e.patternId!==a&&!t.destroyed&&(!A.image.isLarge(e.image,r,n)||e.data.repeat)){const{image:o,data:l}=e,{transform:h,gap:d}=l,c=Mt.getPatternFixScale(e,r,n);let u,p,_,{width:m,height:v}=o;c&&(r*=c,n*=c),m*=r,v*=n,d&&(p=d.x*r/Ql(l.scaleX||1),_=d.y*n/Ql(l.scaleY||1)),(h||r!==1||n!==1)&&(r*=Kl(m+(p||0)),n*=Kl(v+(_||0)),u=v_(),h&&w_(u,h),x_(u,1/r,1/n));const T=o.getCanvas(m,v,l.opacity,l.filters,p,_,t.leafer&&t.leafer.config.smooth,l.interlace),$=o.getPattern(T,l.repeat||A.origin.noRepeat||"no-repeat",u,e);e.style=$,e.patternId=a}},getPatternFixScale:function(e,t,i){const{image:s}=e;let r,n=A.image.maxPatternSize,a=s.width*s.height;return s.isSVG?t>1&&(r=Math.ceil(t)/t):n>a&&(n=a),(a*=t*i)>n&&(r=Math.sqrt(n/a)),r},createData:function(e,t,i,s){e.data=Mt.getPatternData(i,s,t)},getPatternData:function(e,t,i){e.padding&&(t=f_.set(t).shrink(e.padding)),e.mode==="strench"&&(e.mode="stretch");const{width:s,height:r}=i,{opacity:n,mode:a,align:o,offset:l,scale:h,size:d,rotation:c,skew:u,clipSize:p,repeat:_,gap:m,filters:v,interlace:T}=e,$=t.width===s&&t.height===r,B={mode:a},X=o!=="center"&&(c||0)%180==90;let R,b;switch(I.set($t,0,0,X?r:s,X?s:r),a&&a!=="cover"&&a!=="fit"?((h||d)&&(Nt.getScaleData(h,d,i,zn),R=zn.scaleX,b=zn.scaleY),(o||m||_)&&(R&&I.scale($t,R,b,!0),o&&Th.toPoint(o,$t,t,$t,!0,!0))):$&&!c||(R=b=I.getFitScale(t,$t,a!=="fit"),I.put(t,i,o,R,!1,$t),I.scale($t,R,b,!0)),l&&Q.move($t,l),a){case"stretch":$?R&&(R=b=void 0):(R=t.width/s,b=t.height/r,Mt.stretchMode(B,t,R,b));break;case"normal":case"clip":if($t.x||$t.y||R||p||c||u){let P,C;p&&(P=t.width/p.width,C=t.height/p.height),Mt.clipMode(B,t,$t.x,$t.y,R,b,c,u,P,C),P&&(R=R?R*P:P,b=b?b*C:C)}break;case"repeat":(!$||R||c||u)&&Mt.repeatMode(B,t,s,r,$t.x,$t.y,R,b,c,u,o,e.freeTransform),_||(B.repeat="repeat");const E=_t(_);(m||E)&&(B.gap=(function(P,C,z,O,M){let D,H;return _t(P)?(D=P.x,H=P.y):D=H=P,{x:Gl(D,z,M.width,C&&C.x),y:Gl(H,O,M.height,C&&C.y)}})(m,E&&_,$t.width,$t.height,t));break;default:R&&Mt.fillOrFitMode(B,t,$t.x,$t.y,R,b,c)}return B.transform||(t.x||t.y)&&p_(B.transform=u_(),t.x,t.y),R&&(B.scaleX=R,B.scaleY=b),n&&n<1&&(B.opacity=n),v&&(B.filters=v),_&&(B.repeat=Et(_)?_==="x"?"repeat-x":"repeat-y":"repeat"),T&&(B.interlace=St(T)||T.type==="percent"?{type:"x",offset:T}:T),B},stretchMode:function(e,t,i,s){const r=Sr(),{x:n,y:a}=t;n||a?Ei(r,n,a):r.onlyScale=!0,va(r,i,s),e.transform=r},fillOrFitMode:function(e,t,i,s,r,n,a){const o=Sr();Ei(o,t.x+i,t.y+s),va(o,r,n),a&&jl(o,{x:t.x+t.width/2,y:t.y+t.height/2},a),e.transform=o},clipMode:function(e,t,i,s,r,n,a,o,l,h){const d=Sr();Ul(d,t,i,s,r,n,a,o),l&&(a||o?(g_(Fn),Hn(Fn,t,l,h),__(d,Fn)):Hn(d,t,l,h)),e.transform=d},repeatMode:function(e,t,i,s,r,n,a,o,l,h,d,c){const u=Sr();if(c)Ul(u,t,r,n,a,o,l,h);else{if(l)if(d==="center")jl(u,{x:i/2,y:s/2},l);else switch(Zh(u,l),l){case 90:Ei(u,s,0);break;case 180:Ei(u,i,s);break;case 270:Ei(u,0,i)}Rs.x=t.x+r,Rs.y=t.y+n,Ei(u,Rs.x,Rs.y),a&&Hn(u,Rs,a,o)}e.transform=u}},{toPoint:Jl}=Mi,{hasTransparent:k_}=te,Yn={},Vn={};function qn(e,t,i,s){if(i){let r,n,a,o;for(let l=0,h=i.length;l<h;l++)r=i[l],Et(r)?(a=l/(h-1),n=te.string(r,s)):(a=r.offset,n=te.string(r.color,s)),t.addColorStop(a,n),!o&&k_(n)&&(o=!0);o&&(e.isTransparent=!0)}}const{getAngle:S_,getDistance:T_}=Q,{get:E_,rotateOfOuter:Zl,scaleOfOuter:th}=K,{toPoint:eh}=Mi,bi={},Xn={};function Gn(e,t,i,s,r){let n;const{width:a,height:o}=e;if(a!==o||s){const l=S_(t,i);n=E_(),r?(th(n,t,a/o*(s||1),1),Zl(n,t,l+90)):(th(n,t,1,a/o*(s||1)),Zl(n,t,l))}return n}const{getDistance:C_}=Q,{toPoint:ih}=Mi,Xe={},jn={},B_={linearGradient:function(e,t){let{from:i,to:s,type:r,opacity:n}=e;Jl(i||"top",t,Yn),Jl(s||"bottom",t,Vn);const a=A.canvas.createLinearGradient(Yn.x,Yn.y,Vn.x,Vn.y),o={type:r,style:a};return qn(o,a,e.stops,n),o},radialGradient:function(e,t){let{from:i,to:s,type:r,opacity:n,stretch:a}=e;eh(i||"center",t,bi),eh(s||"bottom",t,Xn);const o=A.canvas.createRadialGradient(bi.x,bi.y,0,bi.x,bi.y,T_(bi,Xn)),l={type:r,style:o};qn(l,o,e.stops,n);const h=Gn(t,bi,Xn,a,!0);return h&&(l.transform=h),l},conicGradient:function(e,t){let{from:i,to:s,type:r,opacity:n,stretch:a}=e;ih(i||"center",t,Xe),ih(s||"bottom",t,jn);const o=A.conicGradientSupport?A.canvas.createConicGradient(0,Xe.x,Xe.y):A.canvas.createRadialGradient(Xe.x,Xe.y,0,Xe.x,Xe.y,C_(Xe,jn)),l={type:r,style:o};qn(l,o,e.stops,n);const h=Gn(t,Xe,jn,a||1,A.conicGradientRotate90);return h&&(l.transform=h),l},getTransform:Gn},{copy:P_,move:R_,toOffsetOutBounds:L_}=I,{max:Tr,abs:O_}=Math,Un={},sh=new Li,Ls={};function tc(e,t){let i,s,r,n,a=0,o=0,l=0,h=0;return t.forEach(d=>{i=d.x||0,s=d.y||0,n=1.5*(d.blur||0),r=O_(d.spread||0),a=Tr(a,r+n-s),o=Tr(o,r+n+i),l=Tr(l,r+n+s),h=Tr(h,r+n-i)}),a===o&&o===l&&l===h?a:[a,o,l,h]}function rh(e,t,i){const{shapeBounds:s}=i;let r,n;A.fullImageShadow?(P_(Un,e.bounds),R_(Un,t.x-s.x,t.y-s.y),r=e.bounds,n=Un):(r=s,n=t),e.copyWorld(i.canvas,r,n)}const{toOffsetOutBounds:M_}=I,Os={},A_=tc,$_={shadow:function(e,t,i){let s,r;const{__nowWorld:n}=e,{shadow:a}=e.__,{worldCanvas:o,bounds:l,renderBounds:h,shapeBounds:d,scaleX:c,scaleY:u}=i,p=t.getSameCanvas(),_=a.length-1;L_(l,Ls,h),a.forEach((m,v)=>{let T=1;if(m.scaleFixed){const $=Math.abs(n.scaleX);$>1&&(T=1/$)}p.setWorldShadow(Ls.offsetX+(m.x||0)*c*T,Ls.offsetY+(m.y||0)*u*T,(m.blur||0)*c*T,te.string(m.color)),r=di.getShadowTransform(e,p,i,m,Ls,T),r&&p.setTransform(r),rh(p,Ls,i),r&&p.resetTransform(),s=h,m.box&&(p.restore(),p.save(),o&&(p.copyWorld(p,h,n,"copy"),s=n),o?p.copyWorld(o,n,n,"destination-out"):p.copyWorld(i.canvas,d,l,"destination-out")),At.copyCanvasByWorld(e,t,p,s,m.blendMode),_&&v<_&&p.clearWorld(s)}),p.recycle(s)},innerShadow:function(e,t,i){let s,r;const{__nowWorld:n}=e,{innerShadow:a}=e.__,{worldCanvas:o,bounds:l,renderBounds:h,shapeBounds:d,scaleX:c,scaleY:u}=i,p=t.getSameCanvas(),_=a.length-1;M_(l,Os,h),a.forEach((m,v)=>{let T=1;if(m.scaleFixed){const $=Math.abs(n.scaleX);$>1&&(T=1/$)}p.save(),p.setWorldShadow(Os.offsetX+(m.x||0)*c*T,Os.offsetY+(m.y||0)*u*T,(m.blur||0)*c*T),r=di.getShadowTransform(e,p,i,m,Os,T,!0),r&&p.setTransform(r),rh(p,Os,i),p.restore(),o?(p.copyWorld(p,h,n,"copy"),p.copyWorld(o,n,n,"source-out"),s=n):(p.copyWorld(i.canvas,d,l,"source-out"),s=h),p.fillWorld(s,te.string(m.color),"source-in"),At.copyCanvasByWorld(e,t,p,s,m.blendMode),_&&v<_&&p.clearWorld(s)}),p.recycle(s)},blur:function(e,t,i){const{blur:s}=e.__;i.setWorldBlur(s*e.__nowWorld.a),i.copyWorldToInner(t,e.__nowWorld,e.__layout.renderBounds),i.filter="none"},backgroundBlur:function(e,t,i){},getShadowRenderSpread:tc,getShadowTransform:function(e,t,i,s,r,n,a){if(s.spread){const o=2*s.spread*n*(a?-1:1),{width:l,height:h}=e.__layout.strokeBounds;return sh.set().scaleOfOuter({x:(r.x+r.width/2)*t.pixelRatio,y:(r.y+r.height/2)*t.pixelRatio},1+o/l,1+o/h),sh}},isTransformShadow(e){},getInnerShadowSpread:A_},{excludeRenderBounds:nh}=qr;let xa;function Er(e,t,i,s,r,n,a,o){switch(t){case"grayscale":xa||(xa=!0,r.useGrayscaleAlpha(e.__nowWorld));case"alpha":(function(l,h,d,c,u,p){const _=l.__nowWorld;d.resetTransform(),d.opacity=1,d.useMask(c,_),p&&c.recycle(_),ah(l,h,d,1,u,p)})(e,i,s,r,a,o);break;case"opacity-path":ah(e,i,s,n,a,o);break;case"path":o&&i.restore()}}function Kn(e){return e.getSameCanvas(!1,!0)}function ah(e,t,i,s,r,n){const a=e.__nowWorld;t.resetTransform(),t.opacity=s,t.copyWorld(i,a,void 0,r),n?i.recycle(a):i.clearWorld(a)}Se.prototype.__renderMask=function(e,t){let i,s,r,n,a,o;const{children:l}=this;for(let h=0,d=l.length;h<d;h++){if(i=l[h],o=i.__.mask,o){a&&(Er(this,a,e,r,s,n,void 0,!0),s=r=null),o!=="clipping"&&o!=="clipping-path"||nh(i,t)||i.__render(e,t),n=i.__.opacity,xa=!1,o==="path"||o==="clipping-path"?(n<1?(a="opacity-path",r||(r=Kn(e))):(a="path",e.save()),i.__clip(r||e,t)):(a=o==="grayscale"?"grayscale":"alpha",s||(s=Kn(e)),r||(r=Kn(e)),i.__render(s,t));continue}const c=n===1&&i.__.__blendMode;c&&Er(this,a,e,r,s,n,void 0,!1),nh(i,t)||i.__render(r||e,t),c&&Er(this,a,e,r,s,n,c,!1)}Er(this,a,e,r,s,n,void 0,!0)};const ec=`>)]}%!?,.:;'"ã€‹ï¼‰ã€ã€‰ã€ã€—ã€‘ã€•ï½â”ï¼â€™â€ï¼ï¼Ÿï¼Œã€ã€‚ï¼šï¼›â€°`,I_=ec+"_#~&*+\\=|â‰®â‰¯â‰ˆâ‰ ï¼â€¦",D_=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([e,t])=>`[\\u${e.toString(16)}-\\u${t.toString(16)}]`).join("|"));function qs(e){const t={};return e.split("").forEach(i=>t[i]=!0),t}const W_=qs("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),N_=qs(`{[(<'"ã€Šï¼ˆã€Œã€ˆã€ã€–ã€ã€”ï½›â”Œï¼œâ€˜â€œï¼Â¥ï¿¥ï¼„â‚¬Â£ï¿¡Â¢ï¿ `),z_=qs(ec),F_=qs(I_),H_=qs("- â€”ï¼ï½ï½œâ”†Â·");var zr;(function(e){e[e.Letter=0]="Letter",e[e.Single=1]="Single",e[e.Before=2]="Before",e[e.After=3]="After",e[e.Symbol=4]="Symbol",e[e.Break=5]="Break"})(zr||(zr={}));const{Letter:oh,Single:Y_,Before:V_,After:q_,Symbol:X_,Break:G_}=zr;function j_(e){return W_[e]?oh:H_[e]?G_:N_[e]?V_:z_[e]?q_:F_[e]?X_:D_.test(e)?Y_:oh}const U_={trimRight(e){const{words:t}=e;let i,s=0,r=t.length;for(let n=r-1;n>-1&&(i=t[n].data[0],i.char===" ");n--)s++,e.width-=i.width;s&&t.splice(r-s,s)}};function K_(e,t,i){switch(t){case"title":return i?e.toUpperCase():e;case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();default:return e}}const{trimRight:Q_}=U_,{Letter:Qn,Single:Ms,Before:lh,After:Jn,Symbol:J_,Break:hh}=zr;let Ns,Me,Ht,Kt,Zn,me,Ge,zs,ns,ue,ai,ta,As,Zi,Fs,Ir,wa,Ji=[];function ea(e,t){ns&&!zs&&(zs=ns),Ns.data.push({char:e,width:t}),Ht+=t}function ki(){Kt+=Ht,Ns.width=Ht,Me.words.push(Ns),Ns={data:[]},Ht=0}function $s(){Zi&&(Fs.paraNumber++,Me.paraStart=!0,Zi=!1),ns&&(Me.startCharSize=zs,Me.endCharSize=ns,zs=0),Me.width=Kt,Ir.width?Q_(Me):wa&&ic(),Ji.push(Me),Me={words:[]},Kt=0}function ic(){Kt>(Fs.maxWidth||0)&&(Fs.maxWidth=Kt)}const{top:Cr,right:ch,bottom:dh,left:Br}=sa;function Pr(e,t,i){const{bounds:s,rows:r}=e;s[t]+=i;for(let n=0;n<r.length;n++)r[n][t]+=i}const Z_={getDrawData:function(e,t){Et(e)||(e=String(e));let i=0,s=0,r=t.__getInput("width")||0,n=t.__getInput("height")||0;const{__padding:a}=t;a&&(r?(i=a[Br],r-=a[ch]+a[Br],!r&&(r=.01)):t.autoSizeAlign||(i=a[Br]),n?(s=a[Cr],n-=a[Cr]+a[dh],!n&&(n=.01)):t.autoSizeAlign||(s=a[Cr]));const o={bounds:{x:i,y:s,width:r,height:n},rows:[],paraNumber:0,font:A.canvas.font=t.__font};return(function(l,h,d){Fs=l,Ji=l.rows,Ir=l.bounds,wa=!Ir.width&&!d.autoSizeAlign;const{__letterSpacing:c,paraIndent:u,textCase:p}=d,{canvas:_}=A,{width:m}=Ir;if(d.__isCharMode){const v=d.textWrap!=="none",T=d.textWrap==="break";Zi=!0,ai=null,zs=Ge=ns=Ht=Kt=0,Ns={data:[]},Me={words:[]},c&&(h=[...h]);for(let $=0,B=h.length;$<B;$++)me=h[$],me===`
`?(Ht&&ki(),Me.paraEnd=!0,$s(),Zi=!0):(ue=j_(me),ue===Qn&&p!=="none"&&(me=K_(me,p,!Ht)),Ge=_.measureText(me).width,c&&(c<0&&(ns=Ge),Ge+=c),ta=ue===Ms&&(ai===Ms||ai===Qn)||ai===Ms&&ue!==Jn,As=!(ue!==lh&&ue!==Ms||ai!==J_&&ai!==Jn),Zn=Zi&&u?m-u:m,v&&m&&Kt+Ht+Ge>Zn&&(T?(Ht&&ki(),Kt&&$s()):(As||(As=ue===Qn&&ai==Jn),(ta||As||ue===hh||ue===lh||ue===Ms||Ht+Ge>Zn)&&Ht&&ki(),Kt&&$s())),me===" "&&Zi!==!0&&Kt+Ht===0||(ue===hh?(me===" "&&Ht&&ki(),ea(me,Ge),ki()):((ta||As)&&Ht&&ki(),ea(me,Ge))),ai=ue);Ht&&ki(),Kt&&$s(),Ji.length>0&&(Ji[Ji.length-1].paraEnd=!0)}else h.split(`
`).forEach(v=>{Fs.paraNumber++,Kt=_.measureText(v).width,Ji.push({x:u||0,text:v,width:Kt,paraStart:!0}),wa&&ic()})})(o,e,t),a&&(function(l,h,d,c,u){if(!c&&d.autoSizeAlign)switch(d.textAlign){case"left":Pr(h,"x",l[Br]);break;case"right":Pr(h,"x",-l[ch])}if(!u&&d.autoSizeAlign)switch(d.verticalAlign){case"top":Pr(h,"y",l[Cr]);break;case"bottom":Pr(h,"y",-l[dh])}})(a,o,t,r,n),(function(l,h){const{rows:d,bounds:c}=l,u=d.length,{__lineHeight:p,__baseLine:_,__letterSpacing:m,__clipText:v,textAlign:T,verticalAlign:$,paraSpacing:B,autoSizeAlign:X}=h;let{x:R,y:b,width:E,height:P}=c,C=p*u+(B?B*(l.paraNumber-1):0),z=_;if(v&&C>P)C=Math.max(P,p),u>1&&(l.overflow=u);else if(P||X)switch($){case"middle":b+=(P-C)/2;break;case"bottom":b+=P-C}z+=b;let O,M,D,H=E||X?E:l.maxWidth;for(let U=0,lt=u;U<lt;U++){if(O=d[U],O.x=R,O.width<E||O.width>E&&!v)switch(T){case"center":O.x+=(H-O.width)/2;break;case"right":O.x+=H-O.width}O.paraStart&&B&&U>0&&(z+=B),O.y=z,z+=p,l.overflow>U&&z>C&&(O.isOverflow=!0,l.overflow=U+1),M=O.x,D=O.width,m<0&&(O.width<0?(D=-O.width+h.fontSize+m,M-=D,D+=h.fontSize):D-=m),M<c.x&&(c.x=M),D>c.width&&(c.width=D),v&&E&&E<D&&(O.isOverflow=!0,l.overflow||(l.overflow=d.length))}c.y=b,c.height=C})(o,t),t.__isCharMode&&(function(l,h,d){const{rows:c}=l,{textAlign:u,paraIndent:p,__letterSpacing:_}=h,m=d&&u.includes("both"),v=m||d&&u.includes("justify"),T=v&&u.includes("letter");let $,B,X,R,b,E,P,C,z,O;c.forEach(M=>{M.words&&(b=p&&M.paraStart?p:0,C=M.words.length,v&&(O=!M.paraEnd||m,B=d-M.width-b,T?R=B/(M.words.reduce((D,H)=>D+H.data.length,0)-1):X=C>1?B/(C-1):0),E=_||M.isOverflow||T?0:X?1:2,M.isOverflow&&!_&&(M.textMode=!0),E===2?(M.x+=b,(function(D){D.text="",D.words.forEach(H=>{H.data.forEach(U=>{D.text+=U.char})})})(M)):(M.x+=b,$=M.x,M.data=[],M.words.forEach((D,H)=>{E===1?(P={char:"",x:$},$=(function(U,lt,Bt){return U.forEach(et=>{Bt.char+=et.char,lt+=et.width}),lt})(D.data,$,P),(M.isOverflow||P.char!==" ")&&M.data.push(P)):$=(function(U,lt,Bt,et,ht){return U.forEach(at=>{(et||at.char!==" ")&&(at.x=lt,Bt.push(at)),lt+=at.width,ht&&(lt+=ht)}),lt})(D.data,$,M.data,M.isOverflow,O&&R),O&&(z=H===C-1,X?z||($+=X,M.width+=X):R&&(M.width+=R*(D.data.length-(z?1:0))))})),M.words=null)})})(o,t,r),o.overflow&&(function(l,h,d,c){if(!c)return;const{rows:u,overflow:p}=l;let{textOverflow:_}=h;if(u.splice(p),_&&_!=="show"){let m,v;_==="hide"?_="":_==="ellipsis"&&(_="...");const T=_?A.canvas.measureText(_).width:0,$=d+c-T;(h.textWrap==="none"?u:[u[p-1]]).forEach(B=>{if(B.isOverflow&&B.data){let X=B.data.length-1;for(let R=X;R>-1&&(m=B.data[R],v=m.x+m.width,!(R===X&&v<$));R--){if(v<$&&m.char!==" "||!R){B.data.splice(R+1),B.width-=m.width;break}B.width-=m.width}B.width+=T,B.data.push({char:_,x:v}),B.textMode&&(function(R){R.text="",R.data.forEach(b=>{R.text+=b.char}),R.data=null})(B)}})}})(o,t,i,r),t.textDecoration!=="none"&&(function(l,h){let d,c=0;const{fontSize:u,textDecoration:p}=h;switch(l.decorationHeight=u/11,_t(p)?(d=p.type,p.color&&(l.decorationColor=te.string(p.color)),p.offset&&(c=Math.min(.3*u,Math.max(p.offset,.15*-u)))):d=p,d){case"under":l.decorationY=[.15*u+c];break;case"delete":l.decorationY=[.35*-u];break;case"under-delete":l.decorationY=[.15*u+c,.35*-u]}})(o,t),o}},t0={string:function(e,t){if(!e)return"#000";const i=St(t)&&t<1;if(Et(e)){if(!i||!te.object)return e;e=te.object(e)}let s=G(e.a)?1:e.a;i&&(s*=t);const r=e.r+","+e.g+","+e.b;return s===1?"rgb("+r+")":"rgba("+r+","+s+")"}};Object.assign(Xh,Z_),Object.assign(te,t0),Object.assign(it,h_),Object.assign(Mt,b_),Object.assign(Ar,B_),Object.assign(di,$_),Object.assign(Tt,{interaction:(e,t,i,s)=>new t_(e,t,i,s),hitCanvas:(e,t)=>new Jh(e,t),hitCanvasManager:()=>new $g}),Fg();let je=null,se=null,ge=null,Dr=!1,Yt=[];function De(){return je||(je=new(window.AudioContext||window.webkitAudioContext),se=je.createGain(),se.gain.value=.18,se.connect(je.destination),ge=je.createGain(),ge.gain.value=.35,ge.connect(je.destination)),je.state==="suspended"&&je.resume(),je}function V(e,t,i="sine",s=.3,r=0){const n=De(),a=n.createOscillator(),o=n.createGain();a.type=i,a.frequency.value=e,o.gain.setValueAtTime(0,n.currentTime+r),o.gain.linearRampToValueAtTime(s,n.currentTime+r+.02),o.gain.exponentialRampToValueAtTime(.001,n.currentTime+r+t),a.connect(o),o.connect(ge),a.start(n.currentTime+r),a.stop(n.currentTime+r+t)}function sc(e,t=.1,i=0){const s=De(),r=s.sampleRate*e,n=s.createBuffer(1,r,s.sampleRate),a=n.getChannelData(0);for(let d=0;d<r;d++)a[d]=(Math.random()*2-1)*.5;const o=s.createBufferSource();o.buffer=n;const l=s.createGain();l.gain.setValueAtTime(t,s.currentTime+i),l.gain.exponentialRampToValueAtTime(.001,s.currentTime+i+e);const h=s.createBiquadFilter();h.type="bandpass",h.frequency.value=3e3,h.Q.value=.5,o.connect(h),h.connect(l),l.connect(ge),o.start(s.currentTime+i),o.stop(s.currentTime+i+e)}function e0(){for(let e=0;e<12;e++){const t=800+Math.random()*1200;V(t,.04,"square",.08,e*.06),sc(.03,.06,e*.06)}}function uh(){V(523,.15,"triangle",.25),V(659,.15,"triangle",.25,.1),V(784,.3,"triangle",.3,.2)}function ph(){const e=300+Math.random()*100;V(e,.08,"square",.1),sc(.05,.04)}function i0(){[1047,1319,1568,2093].forEach((t,i)=>{V(t,.2,"sine",.2,i*.08),V(t*1.5,.15,"sine",.06,i*.08)})}function s0(){[523,440,349,262].forEach((t,i)=>{V(t,.2,"sawtooth",.1,i*.12)})}function r0(){[523,659,784,1047,1319,1568,2093].forEach((t,i)=>{V(t,.3,"sine",.2,i*.07),V(t*2,.2,"sine",.08,i*.07+.03)});for(let t=0;t<6;t++)V(2093+Math.random()*500,.1,"sine",.1,.5+t*.05)}function n0(){V(330,.3,"triangle",.2),V(415,.3,"triangle",.2,.15),V(523,.4,"triangle",.25,.3),V(659,.5,"sine",.15,.45)}function a0(){[523,659,784,1047].forEach((t,i)=>{V(t,.25,"triangle",.2,i*.1),V(t*1.5,.2,"sine",.07,i*.1+.03)});for(let t=0;t<8;t++){const i=1200+Math.random()*1200;V(i,.1,"sine",.08,.45+t*.06)}V(1047,.4,"triangle",.12,.9),V(1319,.4,"sine",.08,.9),V(1568,.4,"sine",.06,.9)}function o0(){const e=De();[440,370,330,262,220].forEach((n,a)=>{V(n,.3,"sawtooth",.1,a*.14),V(n*.5,.25,"sine",.06,a*.14)});const i=e.createOscillator(),s=e.createGain(),r=e.createBiquadFilter();i.type="sawtooth",i.frequency.setValueAtTime(250,e.currentTime+.7),i.frequency.linearRampToValueAtTime(180,e.currentTime+1),i.frequency.linearRampToValueAtTime(220,e.currentTime+1.15),i.frequency.linearRampToValueAtTime(140,e.currentTime+1.5),r.type="lowpass",r.frequency.setValueAtTime(800,e.currentTime+.7),r.frequency.linearRampToValueAtTime(300,e.currentTime+1.5),r.Q.value=3,s.gain.setValueAtTime(0,e.currentTime+.7),s.gain.linearRampToValueAtTime(.12,e.currentTime+.75),s.gain.setValueAtTime(.12,e.currentTime+1.2),s.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.6),i.connect(r),r.connect(s),s.connect(ge),i.start(e.currentTime+.7),i.stop(e.currentTime+1.7)}function l0(){const e=De(),t=e.createOscillator(),i=e.createGain();t.type="sawtooth",t.frequency.setValueAtTime(200,e.currentTime),t.frequency.exponentialRampToValueAtTime(1200,e.currentTime+.2),t.frequency.exponentialRampToValueAtTime(400,e.currentTime+.5),i.gain.setValueAtTime(.15,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.6),t.connect(i),i.connect(ge),t.start(e.currentTime),t.stop(e.currentTime+.6),V(880,.1,"sine",.15,.1),V(1760,.15,"sine",.1,.2)}function h0(){[392,523,440,587].forEach((t,i)=>{V(t,.15,"triangle",.18,i*.12)}),V(1568,.1,"sine",.06,.1),V(2093,.1,"sine",.04,.25)}function c0(){[523,659,784,1047,784,1047,1319].forEach((t,i)=>{V(t,.18,"square",.12,i*.1),V(t/2,.15,"triangle",.06,i*.1)})}function d0(){[392,494,587,659,784].forEach((i,s)=>{V(i,.12,"square",.15,s*.07),V(i*1.5,.1,"triangle",.06,s*.07)});const t=.4;V(784,.5,"triangle",.18,t),V(988,.5,"triangle",.14,t),V(1175,.5,"sine",.1,t),V(1568,.4,"sine",.06,t),V(1047,.6,"triangle",.2,t+.25),V(1319,.6,"triangle",.15,t+.25),V(1568,.6,"sine",.1,t+.25),V(2093,.5,"sine",.06,t+.25);for(let i=0;i<10;i++)V(1500+Math.random()*1500,.08,"sine",.05,t+.5+i*.04)}function u0(){const e=[523,523,659,784,659,784,1047],t=[.12,.12,.12,.25,.12,.12,.5];let i=0;e.forEach((s,r)=>{V(s,t[r]+.1,"triangle",.2,i),V(s*1.5,t[r],"sine",.08,i),i+=t[r]})}function p0(){const e=[[523,659,784],[587,740,880],[392,494,587],[523,659,784,1047]];let t=0;e.forEach((i,s)=>{i.forEach(r=>{V(r,.6,"triangle",.12,t),V(r,.6,"sine",.06,t)}),t+=s===e.length-1?.8:.4});for(let i=0;i<8;i++)V(1047+Math.random()*1e3,.15,"sine",.06,t+i*.06)}function f0(){const e=De(),t=e.createOscillator(),i=e.createGain();t.type="sawtooth",t.frequency.setValueAtTime(300,e.currentTime),t.frequency.exponentialRampToValueAtTime(2e3,e.currentTime+.5),i.gain.setValueAtTime(.12,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.6),t.connect(i),i.connect(ge),t.start(e.currentTime),t.stop(e.currentTime+.6)}function g0(){const e=De(),t=e.createOscillator(),i=e.createGain();t.type="sawtooth",t.frequency.setValueAtTime(1500,e.currentTime),t.frequency.exponentialRampToValueAtTime(150,e.currentTime+.6),i.gain.setValueAtTime(.12,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.7),t.connect(i),i.connect(ge),t.start(e.currentTime),t.stop(e.currentTime+.7)}function _0(){const e=De(),t=e.createOscillator(),i=e.createGain();t.type="sine",t.frequency.setValueAtTime(300,e.currentTime),t.frequency.exponentialRampToValueAtTime(1500,e.currentTime+.2),i.gain.setValueAtTime(.15,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.3),t.connect(i),i.connect(ge),t.start(e.currentTime),t.stop(e.currentTime+.3);const s=e.createOscillator(),r=e.createGain();s.type="sine",s.frequency.setValueAtTime(1500,e.currentTime+.2),s.frequency.exponentialRampToValueAtTime(300,e.currentTime+.4),r.gain.setValueAtTime(.15,e.currentTime+.2),r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.5),s.connect(r),r.connect(ge),s.start(e.currentTime+.2),s.stop(e.currentTime+.5)}function fh(){const e=De();for(let t=0;t<8;t++){const i=e.createOscillator(),s=e.createGain();i.type="sine";const r=400+t*200;i.frequency.setValueAtTime(r,e.currentTime+t*.05),i.frequency.exponentialRampToValueAtTime(r*2,e.currentTime+t*.05+.1),s.gain.setValueAtTime(.1,e.currentTime+t*.05),s.gain.exponentialRampToValueAtTime(.001,e.currentTime+t*.05+.15),i.connect(s),s.connect(ge),i.start(e.currentTime+t*.05),i.stop(e.currentTime+t*.05+.15)}}function y0(){for(let e=0;e<20;e++){const t=e*(.04+e*.008),i=600+e%3*200;V(i,.05,"square",.06,t)}}function m0(){V(784,.15,"triangle",.2),V(1047,.15,"triangle",.25,.1),V(1568,.4,"sine",.2,.2)}function v0(){V(800,.06,"square",.08)}function x0(){if(Dr)return;Dr=!0;const e=De(),i=60/130,s=i/4,r=[146.8,165,185,220,246.9,293.7,330,370,440,493.9,587.3,659.3,740,880,987.8,1174.7,1318.5,1480,1760],n=[1,1,1,1,1.122,1.122,1.122,1.122,1.26,1.26,1.26,1.26,1,1,1,1];function a(b,E){return b<0?0:r[b]*E}const o=[[5,5,-1,7,7,-1,5,7,9,10,-1,-1,10,-1,-1,-1],[5,5,-1,7,7,-1,5,9,10,12,-1,-1,10,-1,-1,-1],[12,-1,10,9,-1,7,9,10,9,-1,7,5,-1,-1,5,-1],[12,-1,10,9,-1,7,5,7,5,-1,-1,-1,5,-1,-1,-1],[10,10,-1,12,12,-1,14,-1,14,12,-1,10,-1,10,-1,-1],[10,12,-1,14,14,-1,15,-1,15,14,-1,12,-1,10,-1,-1],[14,-1,12,10,-1,9,10,12,10,-1,9,7,-1,-1,5,-1],[9,10,-1,12,10,-1,9,7,9,-1,10,-1,-1,-1,-1,-1],[10,10,12,12,14,-1,15,14,12,10,-1,12,14,-1,-1,-1],[15,-1,14,12,14,-1,15,-1,15,14,12,10,-1,10,-1,-1],[5,7,-1,9,10,-1,12,10,9,7,-1,5,7,-1,9,-1],[10,-1,12,14,15,-1,14,12,10,-1,-1,-1,10,-1,-1,-1],[10,-1,10,-1,12,-1,10,9,10,-1,10,-1,12,-1,14,-1],[10,-1,10,-1,9,-1,7,9,10,-1,10,-1,12,-1,10,-1],[5,-1,7,-1,9,-1,10,-1,12,-1,10,-1,9,-1,7,-1],[10,12,14,12,10,9,10,-1,-1,-1,-1,-1,-1,-1,-1,-1]],l=["K.H.S.H.K.HOS.H.","K.H.S.HHK.H.S.HO","K.HHS.H.KKH.S.H.","K.H.S.HOK.HHS.HH","KKHHS.HHKKH.S.HO","K.HHS.HOKKHHS.HH","K.H.S.H.K.H.S.H.","K.H.S.H.K.H.S.HO"],h=[[5,-1,-1,5,-1,-1,0,-1,5,-1,-1,5,-1,7,-1,-1],[5,-1,-1,5,-1,7,-1,5,-1,-1,4,-1,5,-1,-1,-1],[5,-1,0,-1,5,-1,-1,7,-1,5,-1,-1,4,-1,5,-1],[0,-1,-1,5,-1,-1,7,-1,5,-1,-1,4,-1,5,-1,-1],[5,-1,5,7,-1,5,0,-1,5,-1,5,7,-1,9,5,-1],[5,0,-1,5,7,-1,5,-1,4,-1,5,-1,7,5,-1,-1]],d=[[[0,[5,7,10]],[4,[5,7,10]],[10,[7,9,12]]],[[0,[5,9,12]],[4,[5,9,12]],[10,[5,7,10]]],[[0,[5,7,10]],[2,[5,7,10]],[4,[7,9,12]],[8,[5,9,12]],[12,[5,7,10]]],[[0,[7,9,12]],[4,[5,7,10]],[8,[7,9,12]],[12,[9,12,14]]],[[0,[5,7,10]],[8,[7,9,12]]],[[0,[5,9,12]],[8,[5,7,10]]]];let c=0,u=0,p=0,_=0,m=0;function v(b,E,P,C,z){if(b<=0)return;const O=e.createOscillator(),M=e.createGain();O.type=P,O.frequency.value=b,M.gain.setValueAtTime(0,z),M.gain.linearRampToValueAtTime(C,z+.008),M.gain.setValueAtTime(C*.7,z+E*.4),M.gain.exponentialRampToValueAtTime(.001,z+E),O.connect(M),M.connect(se),O.start(z),O.stop(z+E+.02),Yt.push(O)}function T(b,E){b.forEach(P=>{const C=e.createOscillator(),z=e.createGain(),O=e.createBiquadFilter();C.type="square",C.frequency.value=P,O.type="lowpass",O.frequency.value=P*3,O.Q.value=1,z.gain.setValueAtTime(0,E),z.gain.linearRampToValueAtTime(.07,E+.01),z.gain.setValueAtTime(.06,E+.04),z.gain.exponentialRampToValueAtTime(.001,E+.12),C.connect(O),O.connect(z),z.connect(se),C.start(E),C.stop(E+.15),Yt.push(C)})}function $(b,E){if(b==="K"){const P=e.createOscillator(),C=e.createGain();P.type="sine",P.frequency.setValueAtTime(160,E),P.frequency.exponentialRampToValueAtTime(35,E+.12),C.gain.setValueAtTime(.28,E),C.gain.exponentialRampToValueAtTime(.001,E+.15),P.connect(C),C.connect(se),P.start(E),P.stop(E+.18),Yt.push(P);const z=Math.floor(e.sampleRate*.02),O=e.createBuffer(1,z,e.sampleRate),M=O.getChannelData(0);for(let lt=0;lt<z;lt++)M[lt]=(Math.random()*2-1)*Math.exp(-lt/(z*.15));const D=e.createBufferSource();D.buffer=O;const H=e.createGain(),U=e.createBiquadFilter();U.type="highpass",U.frequency.value=2e3,H.gain.setValueAtTime(.08,E),H.gain.exponentialRampToValueAtTime(.001,E+.03),D.connect(U),U.connect(H),H.connect(se),D.start(E),D.stop(E+.05),Yt.push(D)}else if(b==="S"){const P=Math.floor(e.sampleRate*.1),C=e.createBuffer(1,P,e.sampleRate),z=C.getChannelData(0);for(let lt=0;lt<P;lt++)z[lt]=(Math.random()*2-1)*Math.exp(-lt/(P*.2));const O=e.createBufferSource();O.buffer=C;const M=e.createGain(),D=e.createBiquadFilter();D.type="bandpass",D.frequency.value=1200,D.Q.value=.8,M.gain.setValueAtTime(.18,E),M.gain.exponentialRampToValueAtTime(.001,E+.1),O.connect(D),D.connect(M),M.connect(se),O.start(E),O.stop(E+.12),Yt.push(O);const H=e.createOscillator(),U=e.createGain();H.type="triangle",H.frequency.value=200,U.gain.setValueAtTime(.1,E),U.gain.exponentialRampToValueAtTime(.001,E+.06),H.connect(U),U.connect(se),H.start(E),H.stop(E+.08),Yt.push(H)}else if(b==="H"){const P=Math.floor(e.sampleRate*.03),C=e.createBuffer(1,P,e.sampleRate),z=C.getChannelData(0);for(let H=0;H<P;H++)z[H]=(Math.random()*2-1)*Math.exp(-H/(P*.2));const O=e.createBufferSource();O.buffer=C;const M=e.createGain(),D=e.createBiquadFilter();D.type="highpass",D.frequency.value=7e3,D.Q.value=.5,M.gain.setValueAtTime(.08,E),M.gain.exponentialRampToValueAtTime(.001,E+.03),O.connect(D),D.connect(M),M.connect(se),O.start(E),O.stop(E+.05),Yt.push(O)}else if(b==="O"){const P=Math.floor(e.sampleRate*.12),C=e.createBuffer(1,P,e.sampleRate),z=C.getChannelData(0);for(let H=0;H<P;H++)z[H]=(Math.random()*2-1)*Math.exp(-H/(P*.4));const O=e.createBufferSource();O.buffer=C;const M=e.createGain(),D=e.createBiquadFilter();D.type="highpass",D.frequency.value=5e3,D.Q.value=.3,M.gain.setValueAtTime(.07,E),M.gain.exponentialRampToValueAtTime(.001,E+.12),O.connect(D),D.connect(M),M.connect(se),O.start(E),O.stop(E+.15),Yt.push(O)}}function B(){if(!Dr)return;const b=e.currentTime+.05,E=n[c%n.length];for(let P=0;P<16;P++){const C=b+P*s,O=o[u%o.length][P];if(O>=0){const Bt=a(O,E),et=e.createOscillator(),ht=e.createGain(),at=e.createBiquadFilter();et.type="square",et.frequency.value=Bt,at.type="lowpass",at.frequency.value=Bt*4,at.Q.value=1.5,ht.gain.setValueAtTime(0,C),ht.gain.linearRampToValueAtTime(.09,C+.01),ht.gain.setValueAtTime(.07,C+s*.5),ht.gain.exponentialRampToValueAtTime(.001,C+s*1.6),et.connect(at),at.connect(ht),ht.connect(se),et.start(C),et.stop(C+s*1.8),Yt.push(et),v(Bt,s*1.5,"sine",.04,C),v(Bt*2,s*.8,"sine",.015,C)}const M=l[p%l.length],D=M[P%M.length];D!=="."&&$(D,C);const U=h[_%h.length][P];if(U>=0){const Bt=a(U,E)*.5,et=e.createOscillator(),ht=e.createGain(),at=e.createBiquadFilter();et.type="sawtooth",et.frequency.value=Bt,at.type="lowpass",at.frequency.value=400,at.Q.value=2,ht.gain.setValueAtTime(0,C),ht.gain.linearRampToValueAtTime(.1,C+.008),ht.gain.setValueAtTime(.08,C+s*.5),ht.gain.exponentialRampToValueAtTime(.001,C+i*.7),et.connect(at),at.connect(ht),ht.connect(se),et.start(C),et.stop(C+i*.8),Yt.push(et)}d[m%d.length].forEach(([Bt,et])=>{if(P===Bt){const ht=et.map(at=>a(at,E));T(ht,C)}})}c++,u=(u+1)%o.length,c%2===0&&(p=(p+1)%l.length,_=(_+1)%h.length,m=(m+1)%d.length)}const X=s*16*1e3;B();const R=setInterval(B,X);Yt._intervalId=R}function w0(){Dr=!1,Yt._intervalId&&clearInterval(Yt._intervalId),Yt.forEach(e=>{try{e.stop()}catch{}}),Yt=[]}function b0(){De()}const Oe=24,j=88,oi=102,pe=15,Ue=e=>new Promise(t=>setTimeout(t,e)),Ci=e=>`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="68" text-anchor="middle" font-size="52">${e}</text></svg>`)}`,gh=[{id:"sys_star_move",name:"â­ æ˜Ÿæ˜Ÿæ¢ä½ç½®",emoji:"â­",icon:Ci("â­"),description:"æ˜Ÿæ˜Ÿéšæœºç§»åŠ¨åˆ°æ–°ä½ç½®ï¼",color:"#ffd700"},{id:"sys_forward_10",name:"ğŸš€ å¾€å‰èµ°10æ ¼",emoji:"ğŸš€",icon:Ci("ğŸš€"),description:"å‘å‰å†²åˆº10æ ¼ï¼",color:"#00b894"},{id:"sys_backward_5",name:"ğŸ¢ å¾€åèµ°5æ ¼",emoji:"ğŸ¢",icon:Ci("ğŸ¢"),description:"åé€€5æ ¼...",color:"#e74c3c"},{id:"sys_swap_player",name:"ğŸ”„ å’Œéšæœºè§’è‰²æ¢ä½ç½®",emoji:"ğŸ”„",icon:Ci("ğŸ”„"),description:"ä¸ä¸€ä½éšæœºè§’è‰²äº’æ¢ä½ç½®ï¼",color:"#6c5ce7"},{id:"sys_near_star",name:"ğŸŒ  èµ°åˆ°æ˜Ÿæ˜Ÿå‰ä¸¤æ ¼",emoji:"ğŸŒ ",icon:Ci("ğŸŒ "),description:"ç¬ç§»åˆ°æ˜Ÿæ˜Ÿå‰ä¸¤æ ¼ï¼",color:"#fdcb6e"},{id:"sys_random_pos",name:"ğŸ² è·³åˆ°éšæœºä½ç½®",emoji:"ğŸ²",icon:Ci("ğŸ²"),description:"éšæœºä¼ é€åˆ°æ£‹ç›˜ä»»æ„ä½ç½®ï¼",color:"#00cec9"}],ba=[];for(let e=-3;e<=8;e++){const t=e>=0;ba.push({id:`coin_${e}`,name:t?`ğŸ’° è·å¾— ${e} é‡‘å¸`:`ğŸ’¸ å¤±å» ${Math.abs(e)} é‡‘å¸`,icon:Ci(t?"ğŸ’°":"ğŸ’¸"),amount:e})}function k0(e,t){const i=[];for(let s=0;s<=7;s++)i.push({x:e+s*oi,y:t});for(let s=1;s<=5;s++)i.push({x:e+7*oi,y:t+s*oi});for(let s=6;s>=0;s--)i.push({x:e+s*oi,y:t+5*oi});for(let s=4;s>=1;s--)i.push({x:e,y:t+s*oi});return i}const S0=[2,5,9,14,17,21],rc=[4,8,11,16,20,23],T0=[3,10,15,22],E0=[1,7,12,19];function Rr(e){return e===0?"start":S0.includes(e)?"event":rc.includes(e)?"npc":T0.includes(e)?"system":E0.includes(e)?"coin":"normal"}function C0(e){return e>=0&&e<=7?"top":e>=8&&e<=12?"right":e>=13&&e<=19?"bottom":"left"}function B0(e,t,i,s="auto"){const r=ot.getCharacters();if(r.length===0){alert("è¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä¸ªè§’è‰²ï¼"),t("menu");return}ot.resetMiniGameCounts();const n=ot.getEvents(),a=ot.getNpcEvents(),o=r.map(g=>({...g,coins:5,stars:0,position:0}));let l=1,h=0,d="waiting_dice";const c=[];for(let g=0;g<Oe;g++)Rr(g)==="normal"&&c.push(g);let u=c[Math.floor(Math.random()*c.length)];e.innerHTML=`
    <div class="game-screen">
      <div class="festive-lantern left">ğŸ®</div>
      <div class="festive-lantern right">ğŸ®</div>
      <div class="festive-particles" id="festive-particles"></div>
      <div id="game-canvas" class="game-canvas-container"></div>
      <div id="avatar-overlay" class="avatar-overlay"></div>
      <div id="all-players" class="all-players-panel"></div>
      <div id="game-info" class="game-info-panel"></div>
      <div id="game-hint" class="game-hint"></div>
    </div>`;const p=document.getElementById("festive-particles"),_=["ğŸ§§","âœ¨","ğŸŠ","ğŸ’°","ğŸ†","ğŸ‡","ğŸŒŸ"];for(let g=0;g<15;g++){const w=document.createElement("span");w.className="festive-particle",w.textContent=_[Math.floor(Math.random()*_.length)],w.style.left=Math.random()*100+"%",w.style.animationDelay=Math.random()*8+"s",w.style.animationDuration=6+Math.random()*6+"s",w.style.fontSize=12+Math.random()*14+"px",w.style.opacity=.3+Math.random()*.4,p.appendChild(w)}const m=window.innerWidth,v=window.innerHeight,T=7*oi+j,$=5*oi+j,B=Math.round((m-T)/2),X=Math.round((v-$)/2)-10,R=k0(B,X),b=new Qe({view:document.getElementById("game-canvas"),width:m,height:v,fill:"transparent"});for(let g=0;g<50;g++){const w=Math.random()*m,x=Math.random()*v,y=3+Math.random()*5;b.add(new ne({x:w,y:x,width:y,height:y,fill:`rgba(255,215,0,${.02+Math.random()*.06})`,shadow:{x:0,y:0,blur:4+Math.random()*6,color:`rgba(255,215,0,${.03+Math.random()*.05})`}}))}b.add(new Dt({x:B-30,y:X-30,width:T+60,height:$+60,fill:{type:"radial",stops:[{offset:0,color:"rgba(139,0,0,0.08)"},{offset:.6,color:"rgba(139,0,0,0.03)"},{offset:1,color:"rgba(0,0,0,0)"}]},cornerRadius:30}));for(let g=0;g<Oe;g++){const w=R[g],x=R[(g+1)%Oe],y=w.x+j/2,k=w.y+j/2,L=x.x+j/2,F=x.y+j/2;b.add(new Dt({x:Math.min(y,L)-4,y:Math.min(k,F)-4,width:Math.abs(L-y)+8||8,height:Math.abs(F-k)+8||8,fill:"rgba(255,215,0,0.04)",cornerRadius:4})),b.add(new Dt({x:Math.min(y,L)-1.5,y:Math.min(k,F)-1.5,width:Math.abs(L-y)+3||3,height:Math.abs(F-k)+3||3,fill:{type:"linear",stops:["rgba(255,215,0,0.06)","rgba(255,215,0,0.18)","rgba(255,215,0,0.06)"]},cornerRadius:2}))}const E={normal:{grad1:"#3a0e0e",grad2:"#1e0505",s:"#c0392b",s2:"#e74c3c",glow:"rgba(192,57,43,0.2)",glowOuter:"rgba(192,57,43,0.08)",innerGlow:"rgba(255,100,80,0.06)",highlight:"rgba(255,180,150,0.12)",icon:"",label:""},start:{grad1:"#4a2000",grad2:"#2a0e00",s:"#ffd700",s2:"#ffe44d",glow:"rgba(255,215,0,0.25)",glowOuter:"rgba(255,215,0,0.1)",innerGlow:"rgba(255,215,0,0.08)",highlight:"rgba(255,245,180,0.18)",icon:"ğŸ§§",label:"èµ·ç‚¹"},event:{grad1:"#4a1e00",grad2:"#2a0f00",s:"#e67e22",s2:"#f39c12",glow:"rgba(230,126,34,0.22)",glowOuter:"rgba(230,126,34,0.08)",innerGlow:"rgba(255,180,80,0.07)",highlight:"rgba(255,220,160,0.15)",icon:"â—",label:"äº‹ä»¶"},npc:{grad1:"#3a0030",grad2:"#1e0018",s:"#e84393",s2:"#fd79a8",glow:"rgba(232,67,147,0.22)",glowOuter:"rgba(232,67,147,0.08)",innerGlow:"rgba(255,120,180,0.07)",highlight:"rgba(255,180,220,0.15)",icon:"ğŸ‘¥",label:"NPC"},system:{grad1:"#0a1a3a",grad2:"#050e20",s:"#3498db",s2:"#74b9ff",glow:"rgba(52,152,219,0.25)",glowOuter:"rgba(52,152,219,0.1)",innerGlow:"rgba(100,180,255,0.08)",highlight:"rgba(180,220,255,0.16)",icon:"âš¡",label:"ç³»ç»Ÿ"},coin:{grad1:"#3a3000",grad2:"#201a00",s:"#f1c40f",s2:"#f9e547",glow:"rgba(241,196,15,0.25)",glowOuter:"rgba(241,196,15,0.1)",innerGlow:"rgba(255,220,50,0.08)",highlight:"rgba(255,240,150,0.18)",icon:"ğŸ’°",label:"é‡‘å¸"}};R.forEach((g,w)=>{const x=Rr(w),y=E[x]||E.normal;b.add(new Dt({x:g.x-8,y:g.y-8,width:j+16,height:j+16,fill:y.glowOuter,cornerRadius:20})),b.add(new Dt({x:g.x-4,y:g.y-4,width:j+8,height:j+8,fill:y.glow,cornerRadius:16,shadow:{x:0,y:0,blur:12,color:y.glow}})),b.add(new Dt({x:g.x,y:g.y,width:j,height:j,fill:{type:"linear",from:{x:0,y:0},to:{x:1,y:1},stops:[{offset:0,color:y.grad1},{offset:.5,color:y.grad2},{offset:1,color:y.grad1}]},stroke:y.s,strokeWidth:2.5,cornerRadius:12,shadow:[{x:0,y:4,blur:15,color:"rgba(0,0,0,0.5)"},{x:0,y:0,blur:8,color:y.glow}],innerShadow:[{x:0,y:2,blur:8,color:y.innerGlow},{x:0,y:-1,blur:4,color:"rgba(0,0,0,0.3)"}]})),b.add(new Dt({x:g.x+4,y:g.y+4,width:j-8,height:j-8,fill:"transparent",stroke:`${y.s}30`,strokeWidth:1,cornerRadius:9})),b.add(new Dt({x:g.x+7,y:g.y+7,width:j-14,height:j-14,fill:"transparent",stroke:`${y.s}18`,strokeWidth:.5,cornerRadius:7})),b.add(new Dt({x:g.x+6,y:g.y+3,width:j-12,height:j*.35,fill:{type:"linear",from:{x:.5,y:0},to:{x:.5,y:1},stops:[{offset:0,color:y.highlight},{offset:1,color:"rgba(255,255,255,0)"}]},cornerRadius:[8,8,20,20]}));const k=4,L=10,F=`${y.s}55`;b.add(new ne({x:g.x+L,y:g.y+L,width:k,height:k,fill:F})),b.add(new ne({x:g.x+j-L-k,y:g.y+L,width:k,height:k,fill:F})),b.add(new ne({x:g.x+L,y:g.y+j-L-k,width:k,height:k,fill:F})),b.add(new ne({x:g.x+j-L-k,y:g.y+j-L-k,width:k,height:k,fill:F})),y.icon&&b.add(new Z({x:g.x,y:g.y+8,width:j,text:y.icon,fill:y.s,fontSize:26,fontWeight:"bold",textAlign:"center"})),y.label&&b.add(new Z({x:g.x,y:g.y+j-24,width:j,text:y.label,fill:`${y.s}aa`,fontSize:11,fontWeight:"bold",textAlign:"center"})),x==="normal"&&(b.add(new Dt({x:g.x+j/2-8,y:g.y+j/2-8,width:16,height:16,fill:"transparent",stroke:`${y.s}25`,strokeWidth:1,rotation:45,around:"center",cornerRadius:2})),b.add(new ne({x:g.x+j/2-2.5,y:g.y+j/2-2.5,width:5,height:5,fill:`${y.s}30`}))),b.add(new Z({x:g.x+6,y:g.y+j-17,text:`${w}`,fill:"rgba(255,255,255,0.15)",fontSize:9,fontWeight:"600"}))});const P=document.getElementById("avatar-overlay"),C=ot.getNpcs(),z=48;rc.forEach((g,w)=>{if(C.length===0)return;const x=C[w%C.length],y=R[g],k=C0(g),L=document.createElement("div");L.className="tile-npc-avatar npc-side-"+k,L.style.width=z+"px",L.style.height=z+"px",k==="top"||k==="bottom"?(L.style.left=y.x+j/2-z/2+"px",L.style.top=y.y-z/2-2+"px"):k==="right"?(L.style.left=y.x+j-z/2+2+"px",L.style.top=y.y+j/2-z/2+"px"):(L.style.left=y.x-z/2-2+"px",L.style.top=y.y+j/2-z/2+"px"),L.innerHTML=`<img src="${x.avatar}" alt="${x.name}"/><span class="npc-name-tag">${x.name}</span>`,P.appendChild(L)}),Wt(P);const O=new Z({x:R[u].x,y:R[u].y+2,width:j,text:"â­",fontSize:28,textAlign:"center"});b.add(O);const M=new Z({x:R[u].x,y:R[u].y+34,width:j,text:"10ğŸ’°",fill:"#ffd700",fontSize:13,textAlign:"center"});b.add(M);function D(){const g=[];for(let w=0;w<Oe;w++)Rr(w)==="normal"&&w!==u&&g.push(w);g.length!==0&&(u=g[Math.floor(Math.random()*g.length)],O.x=R[u].x,O.y=R[u].y+2,M.x=R[u].x,M.y=R[u].y+28)}const H=40,U=o.map((g,w)=>{const{x,y}=lt(g.position,w),k=new ne({x,y,width:pe*2,height:pe*2,fill:g.color,stroke:"#fff",strokeWidth:2});b.add(k);const L=new Z({x,y:y+3,width:pe*2,text:g.name[0],fill:"#fff",fontSize:14,fontWeight:"bold",textAlign:"center"});b.add(L);const F=document.createElement("div");return F.className="tile-player-avatar",F.style.width=H+"px",F.style.height=H+"px",F.style.left=x+pe-H/2+"px",F.style.top=y-H+4+"px",F.style.borderColor=g.color,F.innerHTML=`<img src="${g.avatar}"/>`,P.appendChild(F),{el:k,tx:L,avatarEl:F}});Wt(P);function lt(g,w){const x=R[g],k=o.filter(F=>F.position===g).length<=1?[{dx:j/2-pe,dy:j-pe*2-4}]:[{dx:6,dy:j-pe*2-4},{dx:j/2-pe,dy:j-pe*2-4},{dx:j-pe*2-6,dy:j-pe*2-4}],L=k[w%k.length];return{x:x.x+L.dx,y:x.y+L.dy}}function Bt(){o.forEach((g,w)=>{const{x,y}=lt(g.position,w);U[w].el.x=x,U[w].el.y=y,U[w].tx.x=x,U[w].tx.y=y+3,U[w].avatarEl.style.left=x+pe-H/2+"px",U[w].avatarEl.style.top=y-H+4+"px"})}function et(){const g=o[h],w=document.getElementById("game-info");w.innerHTML=`
      <div class="round-info">ç¬¬ ${l} / ${i} è½®</div>
      <div class="current-player">
        <div class="player-avatar"><img src="${g.avatar}"/></div>
        <div class="player-stats">
          <div class="player-name" style="color:${g.color}">${g.name}</div>
          <div class="stat"><span class="coin">ğŸ’° ${g.coins}</span> &nbsp; <span class="star">â­ ${g.stars}</span></div>
        </div>
      </div>`,Wt(w)}function ht(){const g=document.getElementById("all-players"),w=o.map((k,L)=>({...k,origIdx:L})).sort((k,L)=>L.stars!==k.stars?L.stars-k.stars:L.coins-k.coins),x=["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"],y={};w.forEach((k,L)=>{y[k.origIdx]=L}),g.innerHTML=`
      <div class="ap-title">æ‰€æœ‰ç©å®¶</div>
      ${w.map((k,L)=>`
        <div class="ap-item ${k.origIdx===h?"active":""}">
          <span class="ap-rank">${L<3?x[L]:`<span class="ap-rank-num">${L+1}</span>`}</span>
          <div class="ap-avatar"><img src="${k.avatar}"/></div>
          <span>${k.name}</span>
          <span style="margin-left:auto">ğŸ’°${k.coins} â­${k.stars}</span>
        </div>`).join("")}`,Wt(g)}function at(g){document.getElementById("game-hint").textContent=g}function nc(){return s==="external"?ac():new Promise(g=>{const w=Math.floor(Math.random()*6)+1,x=document.createElement("div");x.className="dice-overlay",x.innerHTML='<div class="dice-display" id="dice-num">1</div>',document.body.appendChild(x),e0();const y=x.querySelector("#dice-num");let k=0;const L=setInterval(()=>{y.textContent=Math.floor(Math.random()*6)+1,k++,k>=22&&(clearInterval(L),y.textContent=w,y.classList.add("settled"),uh(),setTimeout(()=>{x.remove(),g(w)},900))},90)})}function ac(){return new Promise(g=>{const w=document.createElement("div");w.className="dice-overlay",w.innerHTML=`
        <div class="dice-display dice-rolling" id="dice-num">1</div>
        <div class="dice-input-area">
          <div class="dice-input-hint">ğŸ¯ è¯·è¾“å…¥åœºå¤–éª°å­ç‚¹æ•°</div>
          <div class="dice-number-buttons" id="dice-buttons">
            ${[1,2,3,4,5,6].map(L=>`<button class="dice-num-btn" data-num="${L}">${L}</button>`).join("")}
          </div>
        </div>`,document.body.appendChild(w);const x=w.querySelector("#dice-num"),y=setInterval(()=>{x.textContent=Math.floor(Math.random()*6)+1},90);w.querySelectorAll(".dice-num-btn").forEach(L=>{L.addEventListener("click",()=>{const F=parseInt(L.dataset.num);clearInterval(y),x.textContent=F,x.classList.remove("dice-rolling"),x.classList.add("settled"),uh();const ft=w.querySelector(".dice-input-area");ft&&(ft.style.display="none"),setTimeout(()=>{w.remove(),g(F)},900)})});const k=L=>{const F=parseInt(L.key);if(F>=1&&F<=6){document.removeEventListener("keydown",k),clearInterval(y),x.textContent=F,x.classList.remove("dice-rolling"),x.classList.add("settled");const ft=w.querySelector(".dice-input-area");ft&&(ft.style.display="none"),setTimeout(()=>{w.remove(),g(F)},900)}};document.addEventListener("keydown",k)})}function Xs(g,w,x=6){return new Promise(y=>{if(w.length===0){y(null);return}y0();const k=[],L=new Set;for(;k.length<Math.min(x,w.length);){const Ne=Math.floor(Math.random()*w.length);L.has(Ne)||(L.add(Ne),k.push(w[Ne]))}const F=Math.floor(Math.random()*k.length),ft=60,_e=5,We=[];for(let Ne=0;Ne<_e;Ne++)We.push(...k);const gi=(1*k.length+F)*ft-130,yc=(_e-1)*k.length*ft-130,$i=document.createElement("div");$i.className="roller-overlay",$i.innerHTML=`
        <div class="roller-title">${g}</div>
        <div class="roller-container">
          <div class="roller-highlight"></div>
          <div class="roller-items" id="roller-track">
            ${We.map(Ne=>`<div class="roller-item"><img src="${Ne.icon}"/><span class="item-label">${Ne.name}</span></div>`).join("")}
          </div>
        </div>`,document.body.appendChild($i),Wt($i);const js=$i.querySelector("#roller-track");js.style.transform=`translateY(-${yc}px)`,js.getBoundingClientRect(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{js.style.transition="transform 3s cubic-bezier(0.15,0.85,0.25,1)",js.style.transform=`translateY(-${gi}px)`})}),setTimeout(()=>{m0(),setTimeout(()=>{$i.remove(),y(k[F])},1200)},3100)})}function Oa(g){return new Promise(w=>{const x=g.type==="reward";x?a0():o0();const y=document.createElement("div");y.className="event-result-overlay",y.innerHTML=`
        <div class="event-result">
          <div class="event-icon"><img src="${g.icon}"/></div>
          <div class="event-name">${g.name}</div>
          <div class="event-effect ${x?"reward":"punishment"}">
            ${x?"âœ¨ å¥–åŠ±äº‹ä»¶":"ğŸ˜¤ æƒ©ç½šäº‹ä»¶"}
          </div>
          <div style="color:rgba(255,255,255,0.7);margin-top:10px;font-size:1.1em">${g.description||""}</div>
          <div class="continue-hint" style="margin-top:20px">æŒ‰ç©ºæ ¼é”®ç»§ç»­</div>
        </div>`,document.body.appendChild(y),Wt(y);const k=L=>{L.code==="Space"&&(document.removeEventListener("keydown",k),y.remove(),w())};document.addEventListener("keydown",k)})}function oc(g){return new Promise(w=>{r0();const x=document.createElement("div");x.className="star-popup",x.innerHTML=`<div class="star-icon">â­</div><div class="star-text">${g.name} è·å¾—ä¸€é¢—æ˜Ÿï¼<br/><span style="font-size:0.8em;color:#aaa">-10 é‡‘å¸</span></div>`,document.body.appendChild(x),setTimeout(()=>{x.remove(),w()},2e3)})}function lc(g,w){return new Promise(x=>{const y=w>=0;y?i0():s0();const k=document.createElement("div");k.className="star-popup",k.innerHTML=`
        <div class="star-icon" style="font-size:60px">${y?"ğŸ’°":"ğŸ’¸"}</div>
        <div class="star-text">
          ${g.name} ${y?"è·å¾—":"å¤±å»"}äº† <span style="color:${y?"#f1c40f":"#e74c3c"};font-weight:bold">${Math.abs(w)}</span> ä¸ªé‡‘å¸ï¼
          <br/><span style="font-size:0.8em;color:#aaa">å½“å‰é‡‘å¸: ${g.coins}</span>
        </div>`,document.body.appendChild(k),setTimeout(()=>{k.remove(),x()},2e3)})}function hc(){const g=ot.getMiniGames(),w=g.filter(y=>y.probability===100&&y.remainingCount>0);let x;if(w.length>0)x=w[Math.floor(Math.random()*w.length)];else{const y=g.filter(F=>F.remainingCount>0);if(y.length===0)return x=g[Math.floor(Math.random()*g.length)],{selected:x,games:g};const k=y.reduce((F,ft)=>F+ft.probability,0);let L=Math.random()*k;x=y[0];for(const F of y)if(L-=F.probability,L<=0){x=F;break}}return ot.updateMiniGame(x.id,{remainingCount:Math.max(0,x.remainingCount-1)}),{selected:x,games:g}}function cc(g,w){const x=[w],y=g.filter(ft=>ft.remainingCount<=0&&ft.id!==w.id).slice(0,2);x.push(...y);const k=g.filter(ft=>ft.id!==w.id&&!y.find(_e=>_e.id===ft.id)).sort(()=>Math.random()-.5);for(;x.length<8&&k.length>0;)x.push(k.pop());const L=x.sort(()=>Math.random()-.5),F=L.findIndex(ft=>ft.id===w.id);return{items:L,selectedIndex:F}}function dc(g){return new Promise(w=>{const x=document.createElement("div");x.className="minigame-overlay",x.innerHTML=`
        <div class="minigame-result">
          <div class="mg-icon"><img src="${g.icon}"/></div>
          <div class="mg-name">${g.name}</div>
          <div class="mg-condition">ğŸ† èƒœåˆ©æ¡ä»¶: <span>${g.winCondition}</span></div>
          <div style="color:rgba(255,255,255,0.4);margin-bottom:15px">ğŸ‘† ç‚¹å‡»é€‰æ‹©èƒœåˆ©è€…ï¼ˆèƒœè€… +5ğŸ’°ï¼Œå…¶ä½™ +2ğŸ’°ï¼‰</div>
          <div class="player-rank-area" id="rank-area">
            ${o.map((y,k)=>`
              <div class="rank-player" data-idx="${k}">
                <div class="rank-avatar"><img src="${y.avatar}"/></div>
                <div class="rank-name">${y.name}</div>
                <div class="rank-badge" id="badge-${k}"></div>
              </div>`).join("")}
          </div>
          <div class="rank-instruction" id="rank-inst">ğŸ‘† ç‚¹å‡»èƒœåˆ©è€…</div>
        </div>`,document.body.appendChild(x),Wt(x),x.querySelectorAll(".rank-player").forEach(y=>{y.addEventListener("click",()=>{const k=parseInt(y.dataset.idx);u0(),o[k].coins+=5,o.forEach((F,ft)=>{ft!==k&&(F.coins+=2)}),o.forEach((F,ft)=>{const _e=x.querySelector(`#badge-${ft}`);ft===k?(_e.textContent="ğŸ† èƒœåˆ©! +5ğŸ’°",_e.style.color="#ffd700",x.querySelector(`.rank-player[data-idx="${ft}"]`).classList.add("ranked","winner")):(_e.textContent="+2ğŸ’°",_e.style.color="#aaa",x.querySelector(`.rank-player[data-idx="${ft}"]`).classList.add("ranked"))}),x.querySelector("#rank-inst").textContent="é€‰æ‹©å®Œæˆï¼æŒ‰ç©ºæ ¼é”®ç»§ç»­";const L=F=>{F.code==="Space"&&(document.removeEventListener("keydown",L),x.remove(),w())};document.addEventListener("keydown",L)})})})}async function Ma(g,w){const x=o[g];for(let y=0;y<w;y++)x.position=(x.position+1)%Oe,Bt(),et(),ph(),await Ue(350),x.position===u&&x.coins>=10&&(x.coins-=10,x.stars++,et(),ht(),await oc(x),D())}async function uc(g,w){const x=o[g];for(let y=0;y<w;y++)x.position=(x.position-1+Oe)%Oe,Bt(),et(),ph(),await Ue(350)}async function Aa(g,w){const x=o[g];x.position=w,Bt(),et(),ht(),await Ue(500)}function fi(g,w=""){return new Promise(x=>{const y=document.createElement("div");y.className="event-result-overlay",y.innerHTML=`
        <div class="event-result">
          <div style="font-size:80px;margin-bottom:15px">${g.emoji}</div>
          <div class="event-name" style="color:${g.color}">${g.name}</div>
          <div style="color:rgba(255,255,255,0.8);font-size:1.2em;margin:15px 0">${g.description}</div>
          ${w?`<div style="color:${g.color};font-size:1.1em;margin-bottom:10px">${w}</div>`:""}
          <div class="continue-hint" style="margin-top:20px">æŒ‰ç©ºæ ¼é”®ç»§ç»­</div>
        </div>`,document.body.appendChild(y);const k=L=>{L.code==="Space"&&(document.removeEventListener("keydown",k),y.remove(),x())};document.addEventListener("keydown",k)})}async function pc(g,w){const x=o[g];switch(w.id){case"sys_star_move":{await fi(w,"æ˜Ÿæ˜Ÿé£èµ°äº†..."),D();break}case"sys_forward_10":{await fi(w,`${x.name} å‘å‰å†²åˆº10æ ¼ï¼`),f0(),await Ma(g,10);break}case"sys_backward_5":{await fi(w,`${x.name} è¢«è¿«åé€€5æ ¼...`),g0(),await uc(g,5);break}case"sys_swap_player":{const y=o.filter((F,ft)=>ft!==g);if(y.length===0){await fi(w,"æ²¡æœ‰å…¶ä»–è§’è‰²å¯ä»¥äº¤æ¢ï¼");break}const k=y[Math.floor(Math.random()*y.length)];o.indexOf(k);const L=x.position;await fi(w,`${x.name} å’Œ ${k.name} äº’æ¢ä½ç½®ï¼`),_0(),x.position=k.position,k.position=L,Bt(),et(),ht(),await Ue(500);break}case"sys_near_star":{const y=(u-2+Oe)%Oe;await fi(w,`${x.name} ç¬ç§»åˆ°æ˜Ÿæ˜Ÿå‰ä¸¤æ ¼ï¼`),fh(),await Aa(g,y);break}case"sys_random_pos":{const y=Math.floor(Math.random()*Oe);await fi(w,`${x.name} è¢«ä¼ é€åˆ°äº†ç¬¬ ${y} æ ¼ï¼`),fh(),await Aa(g,y);break}}}async function fc(g){const w=o[g],x=Rr(w.position);if(x==="event"&&n.length>0){at("éšæœºäº‹ä»¶è§¦å‘ï¼"),n0();const y=await Xs("â— éšæœºäº‹ä»¶æŠ½å–ä¸­...",n,Math.min(6,n.length));y&&await Oa(y)}else if(x==="system"){at("âš¡ ç³»ç»Ÿäº‹ä»¶è§¦å‘ï¼"),l0();const y=await Xs("âš¡ ç³»ç»Ÿäº‹ä»¶æŠ½å–ä¸­...",gh,gh.length);y&&await pc(g,y)}else if(x==="coin"){at("ğŸ’° é‡‘å¸äº‹ä»¶è§¦å‘ï¼");const y=await Xs("ğŸ’° é‡‘å¸æŠ½å–ä¸­...",ba,Math.min(6,ba.length));if(y){const k=y.amount;w.coins+=k,w.coins<0&&(w.coins=0),et(),ht(),await lc(w,k)}}else if(x==="npc"&&a.length>0){const y=ot.getNpcs(),k=y.length>0?y[Math.floor(Math.random()*y.length)]:null,L=k?`ğŸ‘¥ ä¸${k.name}äº’åŠ¨ä¸­...`:"ğŸ‘¥ NPCäº‹ä»¶æŠ½å–ä¸­...";at("NPCäº‹ä»¶è§¦å‘ï¼"),h0();const F=await Xs(L,a,6);F&&await Oa(F)}}async function gc(){at("ğŸ® å°æ¸¸æˆæ—¶é—´ï¼"),c0(),await Ue(800);const{selected:g,games:w}=hc(),{items:x,selectedIndex:y}=cc(w,g);if(x.length>0){const F=[];for(let gi=0;gi<5;gi++)F.push(...x);const _e=(3*x.length+y)*60-130,We=document.createElement("div");We.className="roller-overlay",We.innerHTML=`
        <div class="roller-title">ğŸ® æŠ½å–å°æ¸¸æˆä¸­...</div>
        <div class="roller-container">
          <div class="roller-highlight"></div>
          <div class="roller-items" id="mg-track">
            ${F.map(gi=>`<div class="roller-item"><img src="${gi.icon}"/><span class="item-label">${gi.name}</span></div>`).join("")}
          </div>
        </div>`,document.body.appendChild(We),Wt(We);const Gs=We.querySelector("#mg-track");Gs.getBoundingClientRect(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Gs.style.transition="transform 3.5s cubic-bezier(0.12,0.88,0.22,1)",Gs.style.transform=`translateY(-${_e}px)`})}),await Ue(3600),await Ue(1e3),We.remove()}d0(),await dc(g),et(),ht()}async function _c(){et(),ht(),at(`è½®åˆ° ${o[h].name}ï¼ŒæŒ‰ Enter æ‘‡éª°å­ ğŸ²`),d="waiting_dice"}async function $a(g){if(d==="waiting_dice"&&g.code==="Enter"){d="rolling",v0(),at("æ‘‡éª°å­ä¸­...");const w=await nc();if(at(`${o[h].name} æ‘‡åˆ°äº† ${w}ï¼ç§»åŠ¨ä¸­...`),await Ue(300),d="moving",await Ma(h,w),d="event",await fc(h),h++,h>=o.length&&(h=0,d="minigame",await gc(),l++,l>i)){d="gameover",w0(),p0(),await Ue(500),document.removeEventListener("keydown",$a),t("results",{players:o});return}d="waiting_dice",et(),ht(),at(`è½®åˆ° ${o[h].name}ï¼ŒæŒ‰ Enter æ‘‡éª°å­ ğŸ²`)}}document.addEventListener("keydown",$a),b0(),x0(),_c()}const Qt=document.getElementById("app");function ae(e,t={}){switch(Qt.innerHTML="",e){case"menu":_h();break;case"character-editor":Lc(Qt,ae);break;case"npc-editor":Oc(Qt,ae);break;case"minigame-editor":Mc(Qt,ae);break;case"event-editor":Ac(Qt,ae);break;case"npc-event-editor":$c(Qt,ae);break;case"prize-editor":Ic(Qt,ae);break;case"round-setup":P0();break;case"game":B0(Qt,ae,t.rounds,t.diceMode);break;case"results":R0(t);break;default:_h()}}function _h(){Qt.innerHTML=`
    <div class="menu-screen">
      <div class="menu-super-title">ğŸ§§ çº¢åŒ…é›¨3.0 ğŸ§§</div>
      <div class="menu-title">ğŸ‰ æ–°æ˜¥æ´¾å¯¹å¤§å¯Œç¿ ğŸ‰</div>
      <div class="menu-subtitle">ğŸ§§ æ­å–œå‘è´¢ Â· ä¸‡äº‹å¦‚æ„ ğŸ§§</div>
      <div class="menu-buttons">
        <button class="menu-btn primary" data-action="start">
          <span class="menu-btn-icon">ğŸ²</span>
          å¼€å§‹æ¸¸æˆ
        </button>
        <button class="menu-btn" data-action="character-editor">
          <span class="menu-btn-icon">ğŸ‘¤</span>
          è§’è‰²ç¼–è¾‘
        </button>
        <button class="menu-btn" data-action="npc-editor">
          <span class="menu-btn-icon">ğŸ§“</span>
          NPCç¼–è¾‘
        </button>
        <button class="menu-btn" data-action="minigame-editor">
          <span class="menu-btn-icon">ğŸ®</span>
          å°æ¸¸æˆç¼–è¾‘
        </button>
        <button class="menu-btn" data-action="event-editor">
          <span class="menu-btn-icon">â—</span>
          éšæœºäº‹ä»¶ç¼–è¾‘
        </button>
        <button class="menu-btn" data-action="npc-event-editor">
          <span class="menu-btn-icon">ğŸ‘¥</span>
          NPCäº‹ä»¶ç¼–è¾‘
        </button>
        <button class="menu-btn" data-action="prize-editor">
          <span class="menu-btn-icon">ğŸ†</span>
          æœ€ç»ˆå¤§å¥–è®¾å®š
        </button>
      </div>
    </div>
  `,Qt.querySelectorAll(".menu-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.action;ae(t==="start"?"round-setup":t)})})}function P0(){Qt.innerHTML=`
    <div class="round-setup">
      <h2>ğŸ² è®¾ç½®æ¸¸æˆè½®æ•°</h2>
      <input type="number" id="round-input" min="1" max="50" value="5" />
      <div class="dice-mode-selector">
        <div class="dice-mode-label">ğŸ² éª°å­æ¨¡å¼</div>
        <div class="dice-mode-options">
          <button class="dice-mode-btn active" data-mode="auto" id="mode-auto">
            <span class="mode-icon">ğŸ¤–</span>
            <span class="mode-text">è‡ªåŠ¨æ‘‡éª°å­</span>
            <span class="mode-desc">ç³»ç»Ÿéšæœºæ‘‡å‡ºç‚¹æ•°</span>
          </button>
          <button class="dice-mode-btn" data-mode="external" id="mode-external">
            <span class="mode-icon">ğŸ¯</span>
            <span class="mode-text">åœºå¤–æ‘‡éª°å­</span>
            <span class="mode-desc">æ‰‹åŠ¨è¾“å…¥éª°å­ç‚¹æ•°</span>
          </button>
        </div>
      </div>
      <button class="btn-start" id="btn-start-game">å¼€å§‹æ¸¸æˆ ğŸ‰</button>
      <button class="btn-back" style="margin-top:15px" id="btn-back-menu">è¿”å›èœå•</button>
    </div>
  `;let e="auto";const t=Qt.querySelectorAll(".dice-mode-btn");t.forEach(i=>{i.addEventListener("click",()=>{t.forEach(s=>s.classList.remove("active")),i.classList.add("active"),e=i.dataset.mode})}),document.getElementById("btn-start-game").addEventListener("click",()=>{const i=parseInt(document.getElementById("round-input").value)||5;if(i<1||i>50){alert("è¯·è¾“å…¥1-50ä¹‹é—´çš„è½®æ•°");return}ae("game",{rounds:i,diceMode:e})}),document.getElementById("btn-back-menu").addEventListener("click",()=>{ae("menu")})}function R0(e={}){const{players:t=[]}=e,i=ot.getFinalPrize(),s=[...t].sort((r,n)=>n.stars!==r.stars?n.stars-r.stars:n.coins-r.coins);Qt.innerHTML=`
    <div class="result-screen">
      <h1>ğŸ† æ¸¸æˆç»“æŸ ğŸ†</h1>
      <div class="result-list">
        ${s.map((r,n)=>`
          <div class="result-item">
            <div class="rank-num">${n===0?"ğŸ¥‡":n===1?"ğŸ¥ˆ":n===2?"ğŸ¥‰":n+1}</div>
            <div class="result-avatar"><img src="${r.avatar}" alt="${r.name}"/></div>
            <div class="result-info">
              <div class="result-name">${r.name}</div>
              <div class="result-stats">â­ ${r.stars} æ˜Ÿ  |  ğŸ’° ${r.coins} é‡‘å¸</div>
            </div>
            ${n===0?`<div class="result-prize"><img src="${i.icon}" title="${i.name}"/><div style="font-size:0.75em;color:#ffd700;margin-top:4px">${i.name}</div></div>`:""}
          </div>
        `).join("")}
      </div>
      <button class="btn-home" id="btn-go-home">è¿”å›ä¸»èœå•</button>
    </div>
  `,Wt(Qt),document.getElementById("btn-go-home").addEventListener("click",()=>{ae("menu")})}ae("menu");
